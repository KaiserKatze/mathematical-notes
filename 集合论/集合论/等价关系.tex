\section{等价关系}
\subsection{关系的性质}
\begin{definition}
%@see: 《Elements of Set Theory》 P56
设\(\rel{R}\)是集合\(A\)上的二元关系.
\begin{enumerate}
	\item 若\begin{equation*}
		(\forall x \in A)
		[x\rel{R}x],
	\end{equation*}
	则称“关系\(\rel{R}\)具有\DefineConcept{自反性}（\(\rel{R}\) is \emph{reflexive}）”；
	否则称“关系\(\rel{R}\)不具有自反性（\(\rel{R}\) is \emph{irreflexive}）”
	或“关系\(\rel{R}\)具有\DefineConcept{反自反性}”.

	\item 若\begin{equation*}
		(\forall x,y \in A)
		[x\rel{R}y \implies y\rel{R}x],
	\end{equation*}
	则称“关系\(\rel{R}\)具有\DefineConcept{对称性}（\(\rel{R}\) is \emph{symmetric}）”.

	\item 若\begin{equation*}
		(\forall x,y \in A)
		[x\rel{R}y \land y\rel{R}x \implies x = y],
	\end{equation*}
	则称“关系\(\rel{R}\)具有\DefineConcept{反对称性}（antisymmetric）”.

	\item 若\begin{equation*}
		(\forall x,y,z \in A)
		[x\rel{R}y \land y\rel{R}z \implies x\rel{R}z],
	\end{equation*}
	则称“关系\(\rel{R}\)具有\DefineConcept{传递性}（\(\rel{R}\) is \emph{transitive}）”.
\end{enumerate}
\end{definition}

\begin{proposition}
设集合\(A\)上的二元关系\(\rel{R}\)同时具有对称性和传递性，
则\(\rel{R}\)具有自反性.
\begin{proof}
假设\(x\rel{R}y\).
由于\(\rel{R}\)具有对称性，
所以\(y\rel{R}x\).
又因为\(\rel{R}\)具有传递性，
那么由\(x\rel{R}y\)和\(y\rel{R}x\)可以推得\(x\rel{R}x\)，
这就说明\(\rel{R}\)具有自反性.
\end{proof}
\end{proposition}

\begin{example}
%@see: 《Elements of Set Theory》 P61 Exercise 32.
设\(\rel{R}\)是集合\(A\)上的二元关系.
证明：\begin{enumerate}
	\item \(\rel{R}\)具有对称性的充分必要条件是
	\(\rel{R}^{-1} \subseteq \rel{R}\).
	\item \(\rel{R}\)具有传递性的充分必要条件是
	\(\rel{R}\circ\rel{R} \subseteq \rel{R}\).
	%@see: https://math.stackexchange.com/q/1386714/591741
\end{enumerate}
\begin{proof}
易见
\begin{align*}
	\rel{R}^{-1} \subseteq \rel{R}
	&\iff
	(\forall x,y \in A)[
		x\rel{R}^{-1}y \implies x\rel{R}y
	] \\
	&\iff
	(\forall x,y \in A)[
		y\rel{R}x \implies x\rel{R}y
	] \\
	&\iff
	\text{\(\rel{R}\)具有对称性}. \\
	\rel{R}\circ\rel{R} \subseteq \rel{R}
	&\iff
	(\forall x,z \in A)
	[
		x(\rel{R}\circ\rel{R})z
		\implies
		x\rel{R}z
	] \\
	&\iff
	(\forall x,z \in A)
	[
		(\exists y \in A)[x\rel{R}y \land y\rel{R}z]
		\implies
		x\rel{R}z
	] \\
	&\iff%FIXME 这里我还不太理解怎样才能把(\exists y \in A)改写成(\forall y \in A)
	(\forall x,y,z \in A)
	[
		x\rel{R}y \land y\rel{R}z
		\implies
		x\rel{R}z
	] \\
	&\iff
	\text{\(\rel{R}\)具有传递性}.
	\qedhere
\end{align*}
\end{proof}
\end{example}
实际上，由\cref{theorem:集合论.与逆相等的充分必要条件} 可知，
\(\rel{R}^{-1} = \rel{R}\)也是\(\rel{R}\)具有对称性的充分必要条件.

\begin{example}
%@see: 《Elements of Set Theory》 P61 Exercise 33.
设\(\rel{R}\)是集合\(A\)上的二元关系.
证明：\(\rel{R}\)同时具有对称性和传递性的充分必要条件是
\(\rel{R} = \rel{R}^{-1}\circ\rel{R}\).
\begin{proof}
先证充分性.
由\cref{theorem:集合论.复合的逆.推论1}
可知\((\rel{R}^{-1}\circ\rel{R})^{-1}=\rel{R}^{-1}\circ\rel{R}\)，
即\(\rel{R}^{-1}\circ\rel{R}\)具有对称性，
那么由\(\rel{R}=\rel{R}^{-1}\circ\rel{R}\)
推得\(\rel{R}\)具有对称性，
从而有\(\rel{R}^{-1}=\rel{R}\)，
所以\(\rel{R}=\rel{R}^{-1}\circ\rel{R}
=\rel{R}\circ\rel{R}\)，
这就说明\(\rel{R}\)还具有传递性.

再证必要性.
假设\(\rel{R}\)同时具有对称性和传递性，
那么有\(\rel{R}^{-1}=\rel{R}\)且\(\rel{R}\circ\rel{R}\subseteq\rel{R}\)，
于是有\(\rel{R}^{-1}\circ\rel{R}\subseteq\rel{R}\).
接下来，任取\(\opair{x,y}\in\rel{R}\).
因为\(\rel{R}\)具有对称性，
所以\(y\rel{R}x\)，
从而\(x\rel{R}^{-1}y\).
又因为\(\rel{R}\)具有传递性，
于是\(\rel{R}\)具有自反性，
即\(y\rel{R}y\).
于是由\(x\rel{R}^{-1}y\)和\(y\rel{R}y\)
可得\(x(\rel{R}^{-1}\circ\rel{R})y\).
根据外延公理可知\(\rel{R}\subseteq\rel{R}^{-1}\circ\rel{R}\).
因此\(\rel{R}^{-1}\circ\rel{R}=\rel{R}\).
\end{proof}
%@see: https://math.stackexchange.com/a/3978349/591741
\end{example}

\subsection{等价关系}
\begin{definition}
设\(\rel{R}\)是集合\(A\)上的二元关系，即\(\rel{R} \subseteq A^2\).
如果\(\rel{R}\)同时具有自反性、对称性、传递性，
则称“\(\rel{R}\)是\(A\)上的\DefineConcept{等价关系}（equivalence relation）”.
\end{definition}

\subsection{等价类划分}
\begin{theorem}\label{theorem:集合论.划分集合获得等价关系}
%@see: 《Elements of Set Theory》 P56 Theorem 3M
如果关系\(\rel{R}\)具有对称性和传递性，
那么\(\rel{R}\)是\(\fld \rel{R}\)上的等价关系.
\begin{proof}
任意关系\(\rel{R}\)（不论它是三元的还是四元的）都是它的域上的二元关系，
这是因为\begin{equation*}
	\rel{R}
	\subseteq \dom \rel{R} \times \ran \rel{R}
	\subseteq \fld \rel{R} \times \fld \rel{R}.
\end{equation*}
已知\(\rel{R}\)具有对称性和传递性，
要证\(\rel{R}\)是\(\fld \rel{R}\)上的等价关系，
只需证\(\rel{R}\)在\(\fld \rel{R}\)上具有自反性.
由于\begin{align*}
	x \in \dom \rel{R}
	&\implies
	(\exists y)[x\rel{R}y] \\
	&\implies
	(\exists y)[x\rel{R}y \land y\rel{R}x]
		\tag{对称性} \\
	&\implies
	x \rel{R} x,
		\tag{传递性}
\end{align*}
可知\(\rel{R}\)在\(\dom \rel{R}\)上具有自反性；
同理，\(x \in \ran \rel{R} \implies x \rel{R} x\)，
即\(\rel{R}\)在\(\ran \rel{R}\)上具有自反性；
所以，\(\rel{R}\)在\(\dom \rel{R} \cup \ran \rel{R} = \fld \rel{R}\)上具有自反性.
\end{proof}
\end{theorem}
一般而言，如果\(\rel{R}\)是一个在\(A\)上兼具对称性和传递性的关系，
它可能不是在\(A\)上的等价关系.
根据\cref{theorem:集合论.划分集合获得等价关系} 我们知道，
这样的\(\rel{R}\)在\(\fld \rel{R}\)上具有自反性，
但\(\fld \rel{R}\)可能只是\(A\)的一个小小的子集.

利用\cref{theorem:集合论.划分集合获得等价关系}，
我们学会通过对集合\(A\)的划分诱导出一个等价关系.
接下来我们来研究怎么逆转这个过程，
也就是说，已知\(A\)上的等价关系，求\(A\)的划分.

\begin{definition}
%@see: 《Elements of Set Theory》 P57 Definition
%@see: [Functional Analysis Lecture Notes - Quotient Spaces - Christopher Heil](https://heil.math.gatech.edu/handouts/quotient.pdf)
已知\(\rel{R}\)是一个等价关系.
对于\(x \in \fld \rel{R}\)，集合\begin{equation*}
	\Set{ y \given x \rel{R} y }
\end{equation*}
称为“\(x\)（在关系\(\rel{R}\)下）的\DefineConcept{等价类}%
（the \emph{equivalence class} of \(x\) (under the relation \(\rel{R}\))，
the \emph{equivalence class} of \(x\) (modulo \(\rel{R}\))）”，
记作\(\EquivalenceClassBH{x}[\rel{R}]\)
或\(\EquivalenceClassBT{x}[\rel{R}]\).
把等价类\(\EquivalenceClassBH{x}[\rel{R}]\)中的任意一个元素\(y\)
称为“\(\EquivalenceClassBH{x}[\rel{R}]\)的\DefineConcept{代表}（representative）”.

对不强调关系\(\rel{R}\)时，
也可将上述等价类
简记为\(\EquivalenceClassO{x}\)
或\(\EquivalenceClassB{x}\).
\end{definition}

虽然这里把\(\EquivalenceClassBH{x}[\rel{R}]\)叫做等价“类”，
实际上它是实实在在的集合，
这一地位可以由子集公理确保无虞，
这是因为\(\EquivalenceClassBH{x}[\rel{R}] \subseteq \ran \rel{R}\).

我们还可以进一步构造等价类的集合，例如\begin{equation*}
	\Set{ \EquivalenceClassBH{x}[\rel{R}] \given x \in A },
\end{equation*}
因为这个集合包含于\(\Powerset(\ran \rel{R})\).

根据等价类的定义，容易得到以下性质.
\begin{property}
设\(\rel{R}\)是\(A\)上的一个等价关系，则有：
\begin{enumerate}
	\item \(x \in A
	\implies \EquivalenceClassBH{x}[\rel{R}] \neq \emptyset\).

	\item \(x,y \in A
	\implies \EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]
	\lor \EquivalenceClassBH{x}[\rel{R}] \cap \rel{R}[y] = \emptyset\).

	\item \((\forall x,y \in A)
	[
		\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]
		\implies
		x \rel{R} y
		\iff
		x \in \rel{R}[y] \land y \in \EquivalenceClassBH{x}[\rel{R}]
	]\).

	\item \((\forall x,y \in A)
	[
		\EquivalenceClassBH{x}[\rel{R}] \neq \rel{R}[y]
		\implies
		\EquivalenceClassBH{x}[\rel{R}] \cap \rel{R}[y] = \emptyset
	]\).
\end{enumerate}
\end{property}

\begin{lemma}\label{theorem:集合论.相等的等价类的代表等价}
%@see: 《Elements of Set Theory》 P57 Lemma 3N
设\(\rel{R}\)是\(A\)上的一个等价关系，\(x,y \in A\)，
那么\begin{equation*}
	\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]
	\iff
	x \rel{R} y.
\end{equation*}
\begin{proof}
先证“\(
	\EquivalenceClassBH{x}[\rel{R}] = \EquivalenceClassBH{y}[\rel{R}]
	\implies
	x \rel{R} y
\)”.
首先，设\(\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]\).
由于等价关系\(\rel{R}\)具有自反性，\(y \rel{R} y\)，\(y \in \rel{R}[y]\)；
那么由\(\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]\)就有\(y \in \EquivalenceClassBH{x}[\rel{R}]\)；
根据等价类\(\EquivalenceClassBH{x}[\rel{R}]\)的定义，便得\(x \rel{R} y\).

再证“\(
	x \rel{R} y
	\implies
	\EquivalenceClassBH{x}[\rel{R}] = \EquivalenceClassBH{y}[\rel{R}]
\)”.
然后，设\(x \rel{R} y\).
任取\(t\)，若有\(t \in \rel{R}[y]\)，
根据等价类\(\rel{R}[y]\)的定义，
必有\(y \rel{R} t\)；
再根据假设条件\(x \rel{R} y\)，以及等价关系\(\rel{R}\)具有传递性，
立即可得\(x \rel{R} t\)；
那么根据等价类\(\EquivalenceClassBH{x}[\rel{R}]\)的定义，
就有\(t \in \EquivalenceClassBH{x}[\rel{R}]\)；
因此，\(\rel{R}[y] \subseteq \EquivalenceClassBH{x}[\rel{R}]\).
又因为\(\rel{R}\)具有对称性，
从\(x \rel{R} y\)还可得到\(y \rel{R} x\)，
参照上面的推导过程，交换\(x\)和\(y\)符号，
不难得到\(\EquivalenceClassBH{x}[\rel{R}] \subseteq \rel{R}[y]\)，
所以\(\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]\).
\end{proof}
\end{lemma}
从\cref{theorem:集合论.相等的等价类的代表等价} 可以看出，
相等等价类的代表等价，代表等价的等价类相等.

\begin{definition}\label{definition:集合论.划分的定义}
%@see: 《Elements of Set Theory》 P57 Definition
设\(A,\Pi\)都是集合.
若\begin{itemize}
	\item \(\Pi\)中的元素都是\(A\)的非空子集，即\begin{equation*}
		(\forall p \in \Pi)
		[
			p \neq \emptyset
			\land
			p \subseteq A
		];
	\end{equation*}

	\item \(\Pi\)中的元素两两互斥，即\begin{equation*}
		(\forall p,q \in \Pi)
		[
			p \cap q = \emptyset
		];
	\end{equation*}

	\item \(A\)中的元素是\(\Pi\)中某个元素的元素，即\begin{equation*}
		(\forall a \in A)
		(\exists p \in \Pi)
		[
			a \in p
		],
		\quad\text{或}\quad
		\bigcup\Pi = A,
	\end{equation*}
\end{itemize}
则称“\(\Pi\)是\(A\)的一个\DefineConcept{划分}（partition）”.
\end{definition}

\begin{theorem}
%@see: 《Elements of Set Theory》 P57 Theorem 3P
设\(\rel{R}\)是\(A\)上的一个等价关系，
那么由所有等价类组成的集合\begin{equation*}
	\Pi \defeq \Set{ \EquivalenceClassBH{x}[\rel{R}] \given x \in A }
\end{equation*}
就是\(A\)的一个划分.
\begin{proof}
对于任一等价类\(\EquivalenceClassBH{x}[\rel{R}]\)，
由于总有\(x \in \EquivalenceClassBH{x}[\rel{R}]\)，
它永远不可能是空集；
又因为\(\rel{R}\)是\(A\)上的二元关系，\(\rel{R} \subseteq A^2\)，
\(\EquivalenceClassBH{x}[\rel{R}] \subseteq \ran \rel{R}\)，
所以\(\EquivalenceClassBH{x}[\rel{R}]\)一定是\(A\)的子集.
因此，\(\Pi\)满足\cref{definition:集合论.划分的定义} 中的第1条和第3条，
也就是说，在这里我们只需要证明第2条：\(\Pi\)中的元素是互不重叠的.
用反证法，设\(\EquivalenceClassBH{x}[\rel{R}] \neq \rel{R}[y]\ (x,y \in A)\)，
而且存在\(t \in \EquivalenceClassBH{x}[\rel{R}] \cap \rel{R}[y]\)，
于是有\begin{equation*}
	x \rel{R} t \land y \rel{R} t,
	\quad\text{即}\quad
	x \rel{R} y,
\end{equation*}
再根据\cref{theorem:集合论.相等的等价类的代表等价}，
必有\(\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]\)，
即\(\EquivalenceClassBH{x}[\rel{R}],\rel{R}[y]\)是同一个元素，矛盾！
\end{proof}
\end{theorem}

\begin{definition}\label{definition:集合论.商集的定义}
%@see: 《Elements of Set Theory》 P58
设\(\rel{R}\)是\(A\)上的一个等价关系.
集合\begin{equation*}
	\Set{ \EquivalenceClassBH{x}[\rel{R}] \given x \in A }
\end{equation*}
称为“\(A\)在\(\rel{R}\)下的\DefineConcept{划分}”，
或称为“\(A\)对\(\rel{R}\)的\DefineConcept{商集}（quotient set）”，
记作\(A/\rel{R}\)，
读作“\(A\)余\(\rel{R}\)
（\(A\) modulo \(\rel{R}\)）”.
把映射\begin{equation*}
	\phi\colon A \to A/\rel{R}, x \mapsto \EquivalenceClassBH{x}[\rel{R}]
\end{equation*}
称为\DefineConcept{自然映射}（natural map）
% \DefineConcept{标准映射}
或\DefineConcept{典范映射}（canonical map）.
\end{definition}
对于一个非空集合\(A\)，通过建立\(A\)上的一个等价关系\(\rel{R}\)，
得到\(A\)对于\(\rel{R}\)的商集\(A/\rel{R}\)，
进而研究商集\(A/\rel{R}\)的性质，
这就是抽象代数的基本方法之一.

\begin{proposition}\label{theorem:集合论.典范映射是满射}
典范映射是满射.
%TODO proof
% \begin{proof}
% 设\(\rel{R}\)是\(A\)上的一个等价关系.
% 要证典范映射\(
% 	\phi\colon A \to A/\rel{R}, x \mapsto \EquivalenceClassBH{x}[\rel{R}]
% \)是满射，
% 只需证\(\ran\phi = A/\rel{R}\)，
% 即证\(
% 	(\forall x)
% 	[
% 		x \in A/\rel{R}
% 		\iff
% 		(\exists t)
% 		[
% 			\opair{t,x} \in \rel{R}
% 		]
% 	]
% \).
% \end{proof}
\end{proposition}

%@see: 《Elements of Set Theory》 P59
现在我们来研究如何在商集上定义映射.
具体而言，设\(\rel{R}\)是\(A\)上的一个等价关系，
映射\(F\colon A \to A\).
我们想知道是否存在一个对应的映射\(\hat{F}\colon A/\rel{R} \to A/\rel{R}\)，
使得对于任意\(x \in A\)，总有\begin{equation*}
	\hat{F}(\EquivalenceClassBH{x}[\rel{R}]) = \rel{R}[F(x)].
\end{equation*}
这里我们可以尝试依靠在等价类\(\EquivalenceClassBH{x}[\rel{R}]\)中选择某个特定的元素\(x\)，
定义等价类\(\EquivalenceClassBH{x}[\rel{R}]\)在映射\(\hat{F}\)下的值.
不过，假如\(x_1,x_2\)都在同一个等价类中，
那么除非\(F(x_1),F(x_2)\)也都在同一个等价类中，
否则映射\(\hat{F}\)就不是良定的！

%@see: 《Elements of Set Theory》 P60
为了给出一个一般性结论，我们先了解这样一个概念：
如果\begin{equation*}
	(\forall x,y \in A)
	[
		x \rel{R} y
		\implies
		\opair{F(x),F(y)} \in \rel{R}
	],
\end{equation*}
那么我们称“\(F\)和\(\rel{R}\) \DefineConcept{兼容}%
（\(F\) is \emph{compatible} with \(\rel{R}\)）”.

\begin{theorem}\label{theorem:集合论.与等价关系兼容的映射的性质}
%@see: 《Elements of Set Theory》 P60 Theorem 3Q
设\(\rel{R}\)是\(A\)上的一个等价关系，映射\(F\colon A \to A\).
如果\(F\)和\(\rel{R}\)兼容，
那么存在一个唯一的映射\(\hat{F}\colon A/\rel{R} \to A/\rel{R}\)，使得\begin{equation*}
	(\forall x \in A)
	[
		\hat{F}(\EquivalenceClassBH{x}[\rel{R}]) = \rel{R}[F(x)]
	].
\end{equation*}
如果\(F\)和\(\rel{R}\)不兼容，
那么不存在映射\(\hat{F}\)满足上述条件.
\begin{proof}
首先假设\(F\)和\(\rel{R}\)不兼容，即\begin{equation*}
	(\exists x,y \in A)
	[
		x \rel{R} y
		\land
		\opair{F(x),F(y)} \notin \rel{R}
	],
\end{equation*}
也即\begin{equation*}
	(\exists x,y \in A)
	[
		\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]
		\land
		\rel{R}[F(x)] \neq \rel{R}[F(y)]
	].
\end{equation*}
而要使\begin{equation*}
	(\forall x \in A)
	[
		\hat{F}(\EquivalenceClassBH{x}[\rel{R}]) = \rel{R}[F(x)]
	]
\end{equation*}成立，
必须有\begin{equation*}
	\hat{F}(\EquivalenceClassBH{x}[\rel{R}])
	= \rel{R}[F(x)]
	\quad\text{和}\quad
	\hat{F}(\rel{R}[y])
	= \rel{R}[F(y)]
\end{equation*}同时成立，
但这是不可能的，
毕竟上面两式的左边相等而右边不等.

接下来，我们假设\(F\)和\(\rel{R}\)兼容.
由于结论要求\(\opair{\EquivalenceClassBH{x}[\rel{R}],\rel{R}[F(x)]} \in \hat{F}\)，
所以我们可以令\begin{equation*}
	\hat{F} = \Set{ \opair{\EquivalenceClassBH{x}[\rel{R}],\rel{R}[F(x)]} \given x \in A }.
\end{equation*}
现在就需要证明关系\(\hat{F}\)是一个映射.
考虑\(\opair{\EquivalenceClassBH{x}[\rel{R}],\rel{R}[F(x)]},
\opair{\rel{R}[y],\rel{R}[F(y)]} \in \hat{F}\)，
由于\begin{align*}
	\EquivalenceClassBH{x}[\rel{R}] = \rel{R}[y]
	&\implies
	x \rel{R} y
	\tag{\cref{theorem:集合论.相等的等价类的代表等价}} \\
	&\implies
	\opair{F(x),F(y)} \in \rel{R} \\
	&\implies
	\rel{R}[F(x)] = \rel{R}[F(y)],
	\tag{\cref{theorem:集合论.相等的等价类的代表等价}}
\end{align*}
\(\hat{F}\)是单值的，
可见\(\hat{F}\)确实是一个映射.
显然有\(\dom \hat{F} = A/\rel{R}\)，\(\ran \hat{F} \subseteq A/\rel{R}\)，
因此\(\hat{F}\)是从\(A/\rel{R}\)到\(A/\rel{R}\)的映射.
%TODO 没有给出唯一性的证明
\end{proof}
\end{theorem}
上述结论还可以推广到映射是\(F\colon A \times A \to A\)的情形.
