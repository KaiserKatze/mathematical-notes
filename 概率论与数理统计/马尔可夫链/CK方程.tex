\section{查普曼--柯尔莫哥洛夫方程}
%@see: 《应用随机过程：概率模型导论（第11版）》（Sheldon M. Ross，龚光鲁译） P153
%@see: https://encyclopediaofmath.org/wiki/Kolmogorov-Chapman_equation
现在，我们用\(P^n_{ij}\)表示“处于状态\(i\)的过程，在经过\(n\)次转移后，处于状态\(j\)”的概率，
即\begin{equation*}
	P^n_{ij}
	\defeq
	P(
		X_{n+k} = j
		\vert
		X_k = i
	),
	\quad(n,i,j=0,1,2,\dotsc).
\end{equation*}
显然\(P^1_{ij} = P_{ij}\).

容易看出：\begin{align}
	P^{n+m}_{ij}
	&= P(X_{n+m} = j \vert X_0 = i) \notag\\
	&= \sum_k P(X_{n+m} = j, X_n = k \vert X_0 = i) \notag\\
	&= \sum_k P(X_{n+m} = j \vert X_n = k, X_0 = i) P(X_n = k \vert X_0 = i) \notag\\
	%@see: 《应用随机过程：概率模型导论（第11版）》（Sheldon M. Ross，龚光鲁译） P153 (4.2)
	&= \sum_k P^m_{kj} P^n_{ik}.
		\label{equation:马尔可夫链.CK方程}
\end{align}
我们把方程组 \labelcref{equation:马尔可夫链.CK方程}
称为\DefineConcept{查普曼--柯尔莫哥洛夫方程}（Chapman-Kolmogorov equation）.

我们把矩阵\begin{equation*}
	\vb{P}^{(n)}
	\defeq \begin{bmatrix}
		P^n_{00} & P^n_{01} & \dots \\
		P^n_{10} & P^n_{11} & \dots \\
		\vdots & \vdots & \\
	\end{bmatrix}
\end{equation*}
称为“马尔可夫链\(\{X_n\}_{n \in T}\)的 \DefineConcept{\(n\)步转移概率矩阵}（probability transition matrix，stochastic matrix）”
或“马尔可夫链\(\{X_n\}_{n \in T}\)的 \DefineConcept{\(n\)步马尔可夫矩阵}（Markov matrix）”.
于是\hyperref[equation:马尔可夫链.CK方程]{查普曼--柯尔莫哥洛夫方程}表明：\begin{equation}
	\vb{P}^{(n+m)}
	= \vb{P}^{(n)} \vb{P}^{(m)}.
\end{equation}
因此，\(
	\vb{P}^{(2)}
	= \vb{P}^{(1+1)}
	= \vb{P} \vb{P}
	= (\vb{P})^2
\)，
利用数学归纳法可得\begin{equation}
	\vb{P}^{(n)}
	= (\vb{P})^n,
\end{equation}
也就是说，\(n\)步转移概率矩阵就是矩阵\(\vb{P}\)的\(n\)次幂.

\begin{example}
%@see: 《应用随机过程：概率模型导论（第11版）》（Sheldon M. Ross，龚光鲁译） P156 例4.10
在一个瓮中放入两颗红球.
每隔一分钟，从瓮中取出一颗球，同时放回一颗新球
（新球的颜色有\(0.8\)的概率与刚刚取出的球同色，有\(0.2\)的概率与之反色）.
求第五次取到的球是红色的概率.
\begin{solution}
首先定义一个合适的马尔可夫链，
注意到取到红球的概率是由抽取时瓮中的球的组成决定，
于是我们将\(X_n\)定义为“经过\(n\)次抽取、放回后瓮中红球的个数”，
那么\(\{X_n\}_{n\geq0}\)是一个以\(\{0,1,2\}\)为状态的马尔可夫链，
它的转移矩阵为\begin{equation*}
	\vb{P} \defeq \begin{bmatrix}
		0.8 & 0.2 & 0.0 \\
		0.1 & 0.8 & 0.1 \\
		0.0 & 0.2 & 0.8
	\end{bmatrix}.
\end{equation*}
% 可以这样理解上述转移矩阵：考虑“瓮中红球从\(1\)个变为\(0\)个”这种情形，
% 这表明已经取出的球必定是红球（它发生的概率是\(0.5\)），
% 同时必须放回一个颜色相反的球（它发生的概率是\(0.2\)），
% 即\(P_{10} = (0.5)(0.2) = 0.1\).
因为\begin{equation*}
	\vb{P}^4
	\approx \begin{bmatrix}
		0.4872 & 0.4352 & 0.0776 \\
		0.2176 & 0.5648 & 0.2176 \\
		0.0776 & 0.4352 & 0.4872 \\
	\end{bmatrix}.
\end{equation*}
%@Mathematica: P = {{0.8, 0.2, 0.0}, {0.1, 0.8, 0.1}, {0.0, 0.2, 0.8}};
%@Mathematica: P4 = MatrixPower[P, 4];
%@Mathematica: (0.5) * P4[[3, 2]] + (1.0) * P4[[3, 3]]
于是\begin{align*}
	&\hspace{-20pt}
	P(\text{第五次取到的是红球}) \\
	&= \sum_{i=0}^2 P(\text{第五次取到的是红球} \vert X_4 = i) P(X_4 = i \vert X_0 = 2) \\
	&= (0.0) P_{20}^4 + (0.5) P_{21}^4 + (1.0) P_{22}^4 \\
	&\approx (0.5)(0.4352) + (1.0)(0.4872)
	= 0.7048.
\end{align*}
\end{solution}
\end{example}
