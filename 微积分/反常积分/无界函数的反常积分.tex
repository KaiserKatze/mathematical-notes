\section{无界函数的反常积分}
本节我们讨论第二类反常积分 --- “无界函数的反常积分”.

%@see: 《数学分析教程（第3版 上册）》（史济怀） P281
先看一个具体的例子.
表达式\begin{equation*}
	\int_0^1 \frac{\dd{x}}{\sqrt{x}}
\end{equation*}在黎曼积分的意义下是没有意义的，
因为被积函数\(\frac{1}{\sqrt{x}}\)在\(0\)的右邻域无界，
于是我们把点\(x=0\)称为这个积分的“瑕点”.
但是，对于\(\forall\epsilon\in(0,1)\)，积分\begin{equation*}
	\int_\epsilon^1 \frac{\dd{x}}{\sqrt{x}}
\end{equation*}是有意义的，
它是一个带有变动下限\(\epsilon\)的积分.
由于极限\begin{equation*}
	\lim_{\epsilon\to0^+} \int_\epsilon^1 \frac{\dd{x}}{\sqrt{x}}
	= \lim_{\epsilon\to0^+} 2\sqrt{x}\eval_\epsilon^1
	= 2 \lim_{\epsilon\to0^+} (1-\sqrt\epsilon)
	= 2
\end{equation*}存在且有限，
我们就定义\begin{equation*}
	\int_0^1 \frac{\dd{x}}{\sqrt{x}}=2.
\end{equation*}
接下来，我们把这个定义推广.

\subsection{无界函数的反常积分的概念}
\begin{definition}\label{definition:定积分.无界函数的反常积分的定义1}
%@see: 《数学分析（第二版 上册）》（陈纪修） P361 定义8.1.2
设函数\(f\colon(a,b]\to\mathbb{R}\).
点\(a\)是\(f\)的\DefineConcept{瑕点}，
即\begin{equation*}
	\lim_{x \to a^+} f(x) = \infty.
\end{equation*}
设对于\(\forall\epsilon\in(0,b-a)\)，
函数\(f\)在\([a+\epsilon,b]\)上可积.
如果极限\begin{equation*}
	\lim_{\epsilon\to0^+} \int_{a+\epsilon}^b f(x) \dd{x}
\end{equation*}存在且有限，
那么称“反常积分\(\int_a^b f(x) \dd{x}\)~\DefineConcept{收敛}”，
并把这个极限称为
“函数\(f\)在\((a,b]\)上的\DefineConcept{反常积分}”，
记作\begin{equation*}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P282 (5)
	\int_a^b f(x) \dd{x},
\end{equation*}
即\begin{equation*}
	\int_a^b f(x) \dd{x}
	\defeq
	\lim_{\epsilon\to0^+} \int_{a+\epsilon}^b f(x) \dd{x}.
\end{equation*}

如果极限\begin{equation*}
	\lim_{\epsilon\to0^+} \int_{a+\epsilon}^b f(x) \dd{x}
\end{equation*}不存在，
则称“反常积分\(\int_a^b f(x) \dd{x}\)~\DefineConcept{发散}”.
\end{definition}

类似地，当\(b\)是瑕点时，
我们也可以定义反常积分\begin{equation*}
	\int_a^b f(x) \dd{x}
	\defeq
	\lim_{\epsilon\to0^+} \int_a^{b-\epsilon} f(x) \dd{x}.
\end{equation*}
当\(a\)和\(b\)都是瑕点时，
那么任取一点\(c\in(a,b)\)，我们定义\begin{align*}
	\int_a^b f(x) \dd{x}
	&\defeq
	\int_a^c f(x) \dd{x}
	+ \int_c^b f(x) \dd{x} \\
	&= \lim_{\epsilon\to0^+} \int_{a+\epsilon}^c f(x) \dd{x}
	+ \lim_{\epsilon\to0^+} \int_c^{b-\epsilon} f(x) \dd{x}.
\end{align*}
当开区间\((a,b)\)内一点\(d\)是瑕点时，
我们定义\begin{align*}
	\int_a^b f(x) \dd{x}
	&\defeq \int_a^d f(x) \dd{x}
		+ \int_d^b f(x) \dd{x} \\
	&= \lim_{\epsilon\to0^+} \int_a^{d-\epsilon} f(x) \dd{x}
		+ \lim_{\epsilon\to0^+} \int_{d+\epsilon}^b f(x) \dd{x}.
\end{align*}

%@see: 《数学分析（第二版 上册）》（陈纪修） P362
容易看出，无穷限的反常积分与无界函数的反常积分是可以互相转换的.
假设\(a>0\)，那么\begin{align*}
	\int_a^{+\infty} f(x) \dd{x}
	&\xlongequal{x=1/t}
	-\int_{1/a}^0 \frac1{t^2} f\left(\frac1t\right) \dd{t} \\
	&\xlongequal{g(t) \defeq \frac1{t^2} f\left(\frac1t\right)}
	\int_0^{1/a} g(t) \dd{t},
\end{align*}
这里我们就把无穷限的反常积分化成了无界函数的反常积分.

\subsection{无界函数的反常积分的计算法}
计算无界函数的反常积分，也可借助于牛顿--莱布尼茨公式.
\begin{theorem}\label{theorem:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1}
设函数\(f \in C(a,b]\)，点\(a\)是\(f\)的瑕点，
函数\(F\)是\(f\)在区间\((a,b]\)上的一个原函数.
若极限\(F(a^+) = \lim_{x \to a^+} F(x)\)存在，
则有
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1'}
	\int_a^b f(x) \dd{x}
	= F(b) - F(a^+);
\end{equation}
若极限\(F(a^+)\)不存在，则反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{theorem}
我们仍用记号\([F(x)]_a^b\)来表示\(F(b) - F(a^+)\)，
这样就可以简化\cref{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1'}，
从而形式上仍有
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1}
	\int_a^b f(x) \dd{x} = [F(x)]_a^b.
\end{equation}

对于\(f\)在\([a,b)\)上连续、\(b\)为瑕点的反常积分，也有类似的计算公式.
这里不再详述.

\begin{theorem}\label{theorem:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2}
设函数\(f \in C[a,b]\)，点\(c\in(a,b)\)是\(f\)的瑕点，
函数\(F\)是\(f\)在区间\((a,b]\)上的一个原函数.
若极限\(F(c^+),F(c^-)\)都存在，
则有
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2}
	\int_a^b f(x) \dd{x}
	= [F(b) - F(c^+)] + [F(c^-) - F(a)];
\end{equation}
否则，反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{theorem}
在\cref{theorem:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2} 中，
由于\(F(c^+)\)与\(F(c^-)\)不一定相等（例如，点\(c\)可能是函数\(F\)的跳跃间断点），
所以\begin{equation*}
	\int_a^b f(x) \dd{x}
	\neq [F(x)]_a^b = F(b) - F(a).
\end{equation*}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P258 例4
计算反常积分\begin{equation*}
	\int_0^a \frac{\dd{x}}{\sqrt{a^2-x^2}}
	\quad(a>0).
\end{equation*}
\begin{solution}
因为\begin{equation*}
	\lim_{x \to a^-} \frac{1}{\sqrt{a^2-x^2}} = +\infty,
\end{equation*}
所以点\(a\)是瑕点，于是\begin{equation*}
	\int_0^a \frac{\dd{x}}{\sqrt{a^2-x^2}}
	= \left[ \arcsin\frac{x}{a} \right]_0^a
	= \lim_{x \to a^-} \arcsin\frac{x}{a} - 0 = \frac{\pi}{2}.
\end{equation*}
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P259 例5
讨论反常积分\(\int_{-1}^1 \frac{\dd{x}}{x^2}\)的收敛性.
\begin{solution}
被积函数\(f(x) = \frac{1}{x^2}\)在积分区间\([-1,1]\)上除\(x=0\)外连续，
且\begin{equation*}
	\lim_{x\to0} \frac{1}{x^2} = +\infty.
\end{equation*}

由于\begin{equation*}
	\int_{-1}^0 \frac{\dd{x}}{x^2}
	= \left[-\frac{1}{x}\right]_{-1}^0
	= \lim_{x\to0^-} \left(-\frac{1}{x}\right) - 1
	= +\infty,
\end{equation*}
即反常积分\(\int_{-1}^0 \frac{\dd{x}}{x^2}\)发散，
所以反常积分\(\int_{-1}^1 \frac{\dd{x}}{x^2}\)发散.
\end{solution}
\end{example}
\begin{remark}
如果疏忽了\(x=0\)是被积函数的瑕点，就可能得到以下错误结果：\begin{equation*}
	\int_{-1}^1 \frac{\dd{x}}{x^2}
	= \left[ -\frac{1}{x} \right]_{-1}^1
	= -1 - 1 = -2.
\end{equation*}
\end{remark}

\begin{example}
%@see: 《数学分析（第二版 上册）》（陈纪修） P361 例8.1.6
讨论反常积分\(\int_{-1}^1 \frac{e^{1/x}}{x^2} \dd{x}\)的敛散性.
\begin{solution}
注意到\(x=0\)是被积函数的瑕点，
由于\begin{equation*}
	\int_0^1 \frac{e^{1/x}}{x^2} \dd{x}
	= \eval{-e^{1/x}}_0^1
	= +\infty,
\end{equation*}
所以\(\int_{-1}^1 \frac{e^{1/x}}{x^2} \dd{x}\)发散.
\end{solution}
\end{example}

\begin{proposition}[\(q\)积分]\label{example:定积分.q积分}
%@see: 《高等数学（第六版 上册）》 P259 例6
%@see: 《数学分析（第二版 上册）》（陈纪修） P361 例8.1.5
%@see: 《数学分析教程（第3版 上册）》（史济怀） P282 例4
反常积分\begin{equation*}
	\int_a^b \frac{\dd{x}}{(x-a)^q}
	\quad(a \neq b)
\end{equation*}
当\(0 < q < 1\)时收敛；
当\(q \geq 1\)时发散.
\begin{proof}
当\(q=1\)时，\begin{equation*}
	\int_a^b \frac{\dd{x}}{(x-a)^q}
	= \int_a^b \frac{\dd{x}}{x-a}
	= \eval{\ln(x-a)}_a^b
	= \ln(b-a) - \lim_{x \to a^+} \ln(x-a)
	= +\infty.
\end{equation*}

当\(q\neq1\)时，\begin{equation*}
	\frac{\dd{x}}{(x-a)^q}
	= \frac{1}{1-q} \dd((x-a)^{1-q}),
\end{equation*}
于是，当\(0<q<1\)时，
\(\int_a^b \frac{\dd{x}}{(x-a)^q}
= \frac{(b-a)^{1-q}}{1-q}\)；
当\(q>1\)时，
\(\int_a^b \frac{\dd{x}}{(x-a)^q}
= +\infty\).

综上，当\(0<q<1\)时，这反常积分收敛于\(\frac{(b-a)^{1-q}}{1-q}\)；
当\(q\geq1\)时，这反常积分发散.
\end{proof}
\end{proposition}

如果收敛的反常积分\(\int_a^b f(x) \dd{x}\)的
被积函数\(f \in C(a,b)\)（\(a\)可以是\(-\infty\)，
\(b\)可以是\(+\infty\)，\(a\)、\(b\)也可以是\(f(x)\)的瑕点），
且应用的换元函数在\((a,b)\)内单调增加（或减少），
那么可以像定积分一样换元.

\begin{example}
%@see: 《高等数学（第六版 上册）》 P260 例7
求反常积分\(\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}\).
\begin{solution}\let\qed\relax
\begin{proof}[解法一]
这里，积分上限为\(+\infty\)，且下限\(x=0\)为被积函数的瑕点.

令\(\sqrt{x} = t\)，
则\(x = t^2\)，
\(x\to0^+\)时\(t\to0\)，
\(x\to+\infty\)时\(t\to+\infty\).
于是\begin{equation*}
	\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}
	= \int_0^{+\infty} \frac{2t\dd{t}}{t(t^2+1)^{\frac32}}
	= 2 \int_0^{+\infty} \frac{\dd{t}}{(t^2+1)^{\frac32}}.
\end{equation*}
再令\(t = \tan u\)，
则\(u = \arctan t\)，
\(t=0\)时\(u=0\)，
\(t\to+\infty\)时，
\(u\to\frac\pi2\).
于是\begin{equation*}
	\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}
	= 2 \int_0^{\frac\pi2} \frac{\sec^2 u \dd{u}}{\sec^3 u}
	= 2 \int_0^{\frac\pi2} \cos u \dd{u}
	= 2.
\end{equation*}
\end{proof}
\begin{proof}[解法二]
令\(t = \frac1x\)，则\(x=\frac1t\)，\(\dd{x} = -\frac{\dd{t}}{t^2}\).
% 本例也可令\(t = \frac{1}{x+1}\).
当\(x\to0^+\)时\(t\to+\infty\).
当\(x\to+\infty\)时\(t\to0\).
于是\begin{align*}
	\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}
	&= \int_0^{+\infty} \frac1{\sqrt{(1/t)(1/t+1)^3}} \cdot \frac{\dd{t}}{t^2} \\
	&= \int_0^{+\infty} \frac{\dd{t}}{(1+t)^{3/2}} \\
	&= -2 \eval{(1+t)^{-1/2}}_0^{+\infty}
	= 2.
\end{align*}
\end{proof}
\end{solution}
\end{example}

\begin{example}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P283 例5
%@see: 《数学分析（第二版 上册）》（陈纪修） P364 例8.1.9
计算\(\int_0^1 \ln x \dd{x}\).
\begin{solution}
因为\(\lim_{x\to0^+} \ln x = -\infty\)，
所以\(x=0\)是一个瑕点.
用分部积分法，
同时利用\cref{example:微分中值定理.洛必达法则.零乘无穷大型1} 的结论\begin{equation*}
	\lim_{x\to0^+} x \ln x = 0,
\end{equation*}
得\begin{equation*}
	\int_0^1 \ln x \dd{x}
	= \eval{x \ln x}_0^1
	- \int_0^1 \dd{x}
	= -1.
\end{equation*}
\end{solution}
\end{example}
\begin{remark}
从这个例子中我们可以归纳出一个结论：\begin{equation}
	\int_0^1 x^n \ln x \dd{x}
	= -\frac1{(n+1)^2}
	\quad(n\geq0).
\end{equation}
%@Mathematica: Integrate[x^n Log[x], {x, 0, 1}, Assumptions -> {n >= 0}]
\end{remark}

\begin{example}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P283 例6
计算\(\int_a^b \frac{\dd{x}}{\sqrt{(x-a)(b-x)}}\).
\begin{solution}
这里\(a\)与\(b\)都是瑕点.
容易看出，这个反常积分是收敛的.
我们用换元法，
考虑到当\(a<x<b\)时，分式\begin{equation*}
	\frac{x-a}{b-a}
	\quad\text{和}\quad
	\frac{b-x}{b-a}
\end{equation*}都是正数，
并且两者之和等于\(1\)，
因此可令\begin{equation*}
	\frac{x-a}{b-a} = \sin^2\theta
	\quad(0\leq\theta\leq\pi/2),
\end{equation*}
则\begin{gather*}
	x = a + (b-a) \sin^2\theta
	= a \cos^2\theta + b \sin^2\theta, \\
	\dd{x} = 2(b-a) \cos\theta \sin\theta \dd{\theta}.
\end{gather*}
于是\begin{equation*}
	\int_a^b \frac{\dd{x}}{\sqrt{(x-a)(b-x)}}
	= \int_0^{\pi/2} \frac{2(b-a) \cos\theta \sin\theta \dd{\theta}}
		{\sqrt{(b-a) \sin^2\theta \cdot (b-a) \cos^2\theta}}
	= 2 \int_0^{\pi/2} \dd{\theta}
	= \pi.
\end{equation*}
\end{solution}
\end{example}

\begin{example}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P284 例7
%@see: 《数学分析（第二版 上册）》（陈纪修） P365 例8.1.11
计算反常积分\begin{equation*}
	\int_0^{\pi/2} \ln\sin x \dd{x}
	\quad\text{和}\quad
	\int_0^{\pi/2} \ln\cos x \dd{x}.
\end{equation*}
\begin{solution}
易知点\(x=0\)是瑕点.
令\(x=\pi/2-t\)，
那么\begin{equation*}
	\int_0^{\pi/2} \ln\sin x \dd{x}
	= -\int_{\pi/2}^0 \ln\sin\left(\frac\pi2-t\right) \dd{t}
	= \int_0^{\pi/2} \ln\cos t \dd{t}.
\end{equation*}
记\(I \defeq \int_0^{\pi/2} \ln\sin x \dd{x}\).
于是\begin{align*}
	2I &= \int_0^{\pi/2} (\ln\sin x + \ln\cos x) \dd{x} \\
	&= \int_0^{\pi/2} \ln(\sin x \cos x) \dd{x} \\
	&= \int_0^{\pi/2} \ln\left(\frac12 \sin2x\right) \dd{x} \\
	&= -\frac\pi2 \ln2 + \int_0^{\pi/2} \ln\sin2x \dd{x}.
\end{align*}
考虑\begin{align*}
	\int_0^{\pi/2} \ln\sin2x \dd{x}
	&\xlongequal{2x=t}
	\frac12 \int_0^\pi \ln\sin t \dd{t} \\
	&= \frac12 \left(
		\int_0^{\pi/2} \ln\sin t \dd{t}
		+ \int_{\pi/2}^\pi \ln\sin t \dd{t}
	\right) \\
	&= \frac12 I + \frac12 \int_{\pi/2}^\pi \ln\sin t \dd{t},
\end{align*}
其中\begin{align*}
	\int_{\pi/2}^\pi \ln\sin t \dd{t}
	&\xlongequal{t=u+\pi/2}
	\int_0^{\pi/2} \ln\sin\left(u+\frac\pi2\right) \dd{u} \\
	&= \int_0^{\pi/2} \ln\cos u \dd{u}
	= I,
\end{align*}
于是有\begin{equation*}
	2I = -\frac\pi2 \ln2 + \frac12 I + \frac12 I,
\end{equation*}
解得\(I = -\frac\pi2 \ln2\)，
也就是说\begin{equation}
	\int_0^{\pi/2} \ln\sin x \dd{x}
	= \int_0^{\pi/2} \ln\cos x \dd{x}
	= -\frac\pi2 \ln2.
\end{equation}
\end{solution}
\end{example}
