\section{无穷限的反常积分}
“反常积分（improper integral）”
可以分为“无穷限的反常积分”和“无界函数的反常积分”两大类，
本节讨论第一类反常积分，
即积分区间无界的积分.

\subsection{无穷限的反常积分的概念}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P278
\begin{definition}\label{definition:定积分.无穷限的反常积分的定义1}
%@see: 《数学分析（第二版 上册）》（陈纪修） P358 定义8.1.1
设函数\(f\colon[a,+\infty)\to\mathbb{R}\)在任意有限闭区间上黎曼可积，
即对\(\forall b\in(a,+\infty)\)都有\(f \in R[a,b]\).

如果极限\begin{equation*}
	\lim_{t \to +\infty} \int_a^t f(x) \dd{x}
\end{equation*}存在且有限，
那么称“反常积分\(\int_a^{+\infty} f(x) \dd{x}\)~\DefineConcept{收敛}”
或“函数\(f\)在\([a,+\infty)\)上\DefineConcept{可积}”，
记作\(f \in R[a,+\infty)\)；
并把这个极限称为
“函数\(f\)在\([a,+\infty)\)上的\DefineConcept{反常积分}”，
记作\begin{equation*}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P278 (1)
	\int_a^{+\infty} f(x) \dd{x},
\end{equation*}
即\begin{equation*}
	\int_a^{+\infty} f(x) \dd{x}
	\defeq
	\lim_{t \to +\infty} \int_a^t f(x) \dd{x}.
\end{equation*}

如果极限\begin{equation*}
	\lim_{t \to +\infty} \int_a^t f(x) \dd{x}
\end{equation*}不存在，
则称“反常积分\(\int_a^{+\infty} f(x) \dd{x}\)~\DefineConcept{发散}”.
\end{definition}

类似地，
设\(f\colon(-\infty,b]\to\mathbb{R}\)
对\(\forall a\in(-\infty,b)\)都有\(f \in R[a,b]\)，
则可以定义反常积分\begin{equation*}
	\int_{-\infty}^b f(x) \dd{x}
	\defeq
	\lim_{t \to -\infty} \int_t^b f(x) \dd{x}.
\end{equation*}

\begin{definition}\label{definition:定积分.无穷限的反常积分的定义3}
设函数\(f\colon\mathbb{R}\to\mathbb{R}\)
在\((-\infty,+\infty)\)内的任意有界闭区间上都是可积的，
即\begin{equation*}
	(\forall a,b\in\mathbb{R})
	[
		[a,b]\subset(-\infty,+\infty)
		\implies
		f \in R[a,b]
	].
\end{equation*}
任取\(a\in\mathbb{R}\)，
如果反常积分\begin{equation*}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P279 (2)
	\int_{-\infty}^a f(x) \dd{x}
	\quad\text{和}\quad
	\int_a^{+\infty} f(x) \dd{x}
\end{equation*}都收敛，
那么称“反常积分\(\int_{-\infty}^{+\infty} f(x) \dd{x}\)~\DefineConcept{收敛}”，
并且规定\begin{equation*}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P279 (3)
	\int_{-\infty}^{+\infty} f(x) \dd{x}
	\defeq
	\int_{-\infty}^a f(x) \dd{x} + \int_a^{+\infty} f(x) \dd{x},
\end{equation*}
将其称作“函数\(f(x)\)在无穷区间\((-\infty,\infty)\)上的\DefineConcept{反常积分}”.

反之，如果反常积分\begin{equation*}
	\int_{-\infty}^a f(x) \dd{x}, \qquad
	\int_a^{+\infty} f(x) \dd{x}
\end{equation*}中至少有一个发散，
那么称“反常积分\(\int_{-\infty}^{+\infty} f(x) \dd{x}\)~\DefineConcept{发散}”.
\end{definition}

容易证明，\cref{definition:定积分.无穷限的反常积分的定义3} 实际上与点\(a\)的选取毫无关系.

\cref{definition:定积分.无穷限的反常积分的定义1,%
definition:定积分.无穷限的反常积分的定义3}
定义的反常积分统称为\DefineConcept{无穷限的反常积分}%
或\DefineConcept{第一类反常积分}.

\subsection{无穷限的反常积分的计算法}
由上述定义及牛顿--莱布尼茨公式，可得如下结果.
\begin{theorem}\label{theorem:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P280 定理6.7.1
如果函数\(f\)在\([a,+\infty)\)上可积，
且函数\(F\)为\(f\)在区间\([a,+\infty)\)上的一个原函数，
那么\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分1}
	\int_a^{+\infty} f(x) \dd{x}
	= F(+\infty) - F(a).
\end{equation}
%%其中\(F(+\infty) \defeq \lim_{x\to+\infty} F(x)\).
%FIX: 删去“其中...”，原因是我们已经在[函数的极限](definition:极限.函数极限的定义5)处定义过了.

如果函数\(f\)在\((-\infty,a]\)上可积，
且函数\(F\)为\(f\)在区间\((-\infty,a]\)上的一个原函数，
那么\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分2}
	\int_{-\infty}^a f(x) \dd{x}
	= F(a) - F(-\infty).
\end{equation}
%%其中\(F(-\infty) \defeq \lim_{x\to-\infty} F(x)\).
%FIX: 删去“其中...”，原因是我们已经在[函数的极限](definition:极限.函数极限的定义5)处定义过了.

如果函数\(f\)在\((-\infty,-\infty)\)上可积，
且函数\(F\)为\(f\)在区间\((-\infty,-\infty)\)上的一个原函数，
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分3}
	\int_{-\infty}^{+\infty} f(x) \dd{x}
	= F(+\infty) - F(-\infty).
\end{equation}
\begin{proof}
先证\cref{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分1}，
根据定义，\begin{align*}
	\int_a^{+\infty} f(x) \dd{x}
	&= \lim_{b\to+\infty} \int_a^b f(x) \dd{x}
	= \lim_{b\to+\infty} (F(b) - F(a)) \\
	&= \lim_{b\to+\infty} F(b) - F(a)
	= F(+\infty) - F(a).
\end{align*}

同理可证\cref{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分2,equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分3}.
\end{proof}
\end{theorem}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P256 例1
%@see: 《数学分析（第二版 上册）》（陈纪修） P360 例8.1.4
计算反常积分\(\int_{-\infty}^{+\infty} \frac{\dd{x}}{1+x^2}\).
\begin{solution}
因为\(\arctan x\)是\(\frac{1}{1+x^2}\)的一个原函数，
所以\begin{align*}
	\int_{-\infty}^{+\infty} \frac{\dd{x}}{1+x^2}
	&= \eval{\arctan x}_{-\infty}^{+\infty} \\
	&= \lim_{x\to+\infty} \arctan x
		-\lim_{x\to-\infty} \arctan x \\
	&= \frac{\pi}{2} - \left(-\frac{\pi}{2}\right)
	= \pi.
\end{align*}
\end{solution}
\end{example}

\begin{example}\label{example:反常积分.重要反常积分公式1}
%@see: 《数学分析（第二版 上册）》（陈纪修） P360 例8.1.3
设常数\(a\in\mathbb{R}\)，
讨论\(\int_0^{+\infty} e^{-ax} \dd{x}\)的敛散性.
\begin{solution}
当\(a=0\)时，有\(e^{-ax} = 1\)，那么\begin{equation*}
	\int_0^t e^{-ax} \dd{x} = t,
	\qquad
	\int_0^{+\infty} e^{-ax} \dd{x}
	= \lim_{t\to+\infty} \int_0^t e^{-ax} \dd{x}
	= +\infty.
\end{equation*}

当\(a\neq0\)时，
\(x \mapsto -\frac1a e^{-ax}\)是\(x \mapsto e^{-ax}\)的一个原函数，
那么有\begin{equation*}
	\int_0^{+\infty} e^{-ax} \dd{x}
	= -\frac1a \eval{e^{-ax}}_0^{+\infty}
	= \left\{ \begin{array}{rl}
		1/a, & a>0, \\
		+\infty, & a < 0.
	\end{array} \right.
\end{equation*}

综上所述，当\(a>0\)时，反常积分\(\int_0^{+\infty} e^{-ax} \dd{x}\)收敛于\(1/a\)；
当\(a\leq0\)时，它发散.
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P256 例2
计算反常积分\(\int_0^{+\infty} t e^{-pt} \dd{t}\)，其中常数\(p>0\).
\begin{solution}
直接计算得\begin{equation*}
	\int_0^{+\infty} t e^{-pt} \dd{t}
	= -\frac1p \int_0^{+\infty} t \dd(e^{-pt}) % 分部积分法
	= -\frac1p \left[
		\eval{t e^{-pt}}_0^{+\infty}
		- \int_0^{+\infty} e^{-pt} \dd{t}
	\right],
\end{equation*}
其中\(\lim_{t\to0} t e^{-pt} = 0\)，% 无穷小与有界量的乘积还是无穷小
\(\lim_{t\to+\infty} t e^{-pt}
= \lim_{t\to+\infty} \frac1{p e^{pt}} % 洛必达法则
= 0\)，
从而有\(\eval{t e^{-pt}}_0^{+\infty} = 0\)，
那么\begin{equation*}
	\int_0^{+\infty} t e^{-pt} \dd{t}
	= \frac1p \int_0^{+\infty} e^{-pt} \dd{t}.
\end{equation*}
又由\cref{example:反常积分.重要反常积分公式1}
可知\(\int_0^{+\infty} e^{-pt} \dd{t} = \frac1p\)，
所以\begin{equation*}
	\int_0^{+\infty} t e^{-pt} \dd{t}
	= \frac1{p^2}.
\end{equation*}
\end{solution}
\end{example}
\begin{remark}
从这个例子中我们可以归纳出一个递推公式：\begin{align*}
	\int_0^{+\infty} t^n e^{-pt} \dd{t}
	&= -\frac1p \int_0^{+\infty} t^n \dd(e^{-pt}) \\
	&= -\frac1p \left[\eval{(t^n e^{-pt})}_0^{+\infty} - \int_0^{+\infty} e^{-pt} \dd(t^n)\right] \\
	&= \frac{n}{p} \int_0^{+\infty} t^{n-1} e^{-pt} \dd{t},
\end{align*}
由此可得\begin{align*}
	\int_0^{+\infty} t^n e^{-pt} \dd{t}
	&= \frac{n}{p} \int_0^{+\infty} t^{n-1} e^{-pt} \dd{t}
	= \frac{n(n-1)}{p^2} \int_0^{+\infty} t^{n-2} e^{-pt} \dd{t} \\
	&= \dotsb = \frac{n!}{p^n} \int_0^{+\infty} e^{-pt} \dd{t}
	= \frac{n!}{p^{n+1}}.
\end{align*}
%@Mathematica: Integrate[t^n Exp[-p t], {t, 0, +Infinity}, Assumptions -> {p > 0, n >= 0}]
\end{remark}

\begin{example}\label{example:反常积分.指数函数与三角函数之积的反常积分}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P280 例2
设\(a>0\).
计算反常积分\begin{equation*}
	\int_0^{+\infty} e^{-ax} \cos bx \dd{x}
	\quad\text{和}\quad
	\int_0^{+\infty} e^{-ax} \sin bx \dd{x}.
\end{equation*}
\begin{solution}
用分部积分法，得\begin{align*}
	\int_0^{+\infty} e^{-ax} \cos bx \dd{x}
	&= \frac1b \int_0^{+\infty} e^{-ax} \dd(\sin bx) \\
	&= \frac1b \left(
		\eval{e^{-ax} \sin bx}_0^{+\infty}
		+ a \int_0^{+\infty} e^{-ax} \sin bx \dd{x}
	\right).
\end{align*}
因为\(\lim_{x\to+\infty} e^{-ax} \sin bx = 0\)，
所以\begin{equation*}
	\int_0^{+\infty} e^{-ax} \cos bx \dd{x}
	= \frac{a}{b} \int_0^{+\infty} e^{-ax} \sin bx \dd{x}.
	\eqno(1)
\end{equation*}
再用分部积分法，得\begin{align*}
	\int_0^{+\infty} e^{-ax} \sin bx \dd{x}
	&= -\frac1b \int_0^{+\infty} e^{-ax} \dd(\cos bx) \\
	&= -\frac1b \left(
		\eval{e^{-ax} \cos bx}_0^{+\infty}
		+ a \int_0^{+\infty} e^{-ax} \cos bx \dd{x}
	\right).
\end{align*}
因为\(\lim_{x\to+\infty} e^{-ax} \cos bx = 0\)，
所以\begin{equation*}
	\int_0^{+\infty} e^{-ax} \sin bx \dd{x}
	= -\frac1b \left(
		-1
		+ a \int_0^{+\infty} e^{-ax} \cos bx \dd{x}
	\right).
	\eqno(2)
\end{equation*}
联立(1)(2)两式可以解得\begin{gather}
	\int_0^{+\infty} e^{-ax} \cos bx \dd{x} = \frac{a}{a^2+b^2}, \\
	\int_0^{+\infty} e^{-ax} \sin bx \dd{x} = \frac{b}{a^2+b^2}.
\end{gather}
\end{solution}
\end{example}

\begin{example}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P281 例3
计算\(\int_0^{+\infty} \frac{\dd{x}}{(a^2+x^2)^{3/2}}\).
\begin{solution}
不妨设\(a>0\).
令\(x = a \tan t\)，
则\(\dd{x} = a \sec^2t \dd{t}\).
于是\begin{equation*}
	\int_0^{+\infty} \frac{\dd{x}}{(a^2+x^2)^{3/2}}
	= \int_0^{\pi/2} \frac{a \sec^2t \dd{t}}{a^3 \sec^3t}
	= \frac1{a^2} \int_0^{\pi/2} \cos t \dd{t}
	= \frac1{a^2}.
\end{equation*}
\end{solution}
\end{example}
\begin{remark}
我们看到，一个反常积分经过换元之后变成了常义积分.
反过来，一个常义积分经过换元以后也可变为反常积分.
这种现象是经常发生的，不足为怪.
\end{remark}

\begin{example}
%@see: 《数学分析（第二版 上册）》（陈纪修） P364 例8.1.10
计算反常积分\(I_n = \int_0^{+\infty} \frac{\dd{x}}{(x^2+a^2)^n}\).
\begin{solution}
当\(n\geq2\)时，有\begin{align*}
	I_n &= \int_0^{+\infty} \frac{\dd{x}}{(x^2+a^2)^n} \\
	&= \frac1{a^2} \int_0^{+\infty} \frac{x^2+a^2-x^2}{(x^2+a^2)^n} \dd{x} \\
	&= \frac1{a^2} \int_0^{+\infty} \left[
		\frac1{(x^2+a^2)^{n-1}}
		+ \frac{-x^2}{(x^2+a^2)^n}
	\right] \dd{x} \\
	&= \frac1{a^2} I_{n-1}
		+ \frac1{a^2} \int_0^{+\infty} \frac{-x^2}{(x^2+a^2)^n} \dd{x},
\end{align*}
其中\begin{align*}
	\int_0^{+\infty} \frac{-x^2}{(x^2+a^2)^n} \dd{x}
	&= \frac1{2(n-1)} \int_0^{+\infty} x \dd{\left[\frac1{(x^2+a^2)^{n-1}}\right]} \\
	&= \frac1{2(n-1)} \left[
		\eval{\frac{x}{(x^2+a^2)^{n-1}}}_0^{+\infty}
		- \int_0^{+\infty} \frac{\dd{x}}{(x^2+a^2)^{n-1}}
	\right] \\
	&= -\frac1{2(n-1)} I_{n-1},
\end{align*}
%@Mathematica: Limit[x/(x^2 + a^2)^(n - 1), x -> Infinity, Assumptions -> {n >= 2, n \[Element] Integers}]
%@Mathematica: Limit[x/(x^2 + a^2)^(n - 1), x -> 0, Assumptions -> {n >= 2, n \[Element] Integers}]
从而有\begin{equation*}
	I_n = \frac1{a^2} I_{n-1} - \frac1{a^2} \cdot \frac1{2(n-1)} I_{n-1},
\end{equation*}
整理得\begin{equation*}
	I_n = \frac1{a^2} \cdot \frac{3-2n}{2-2n} \cdot I_{n-1}.
\end{equation*}
又因为\begin{equation*}
	I_1 = \int_0^{+\infty} \frac{\dd{x}}{x^2+a^2}
	= \eval{\frac1a \arctan\frac{x}{a}}_0^{+\infty}
	= \frac\pi{2a},
\end{equation*}
所以\begin{equation*}
	I_n = \frac\pi{2a^{2n-1}} \cdot \frac{(2n-3)!!}{(2n-2)!!}.
\end{equation*}
\end{solution}
\end{example}

\begin{proposition}[\(p\)积分]\label{example:定积分.p积分}
%@see: 《高等数学（第六版 上册）》 P257 例3
%@see: 《数学分析（第二版 上册）》（陈纪修） P359 例8.1.2
%@see: 《数学分析教程（第3版 上册）》（史济怀） P279 例1
反常积分\begin{equation*}
	\int_a^{+\infty} \frac{\dd{x}}{x^p}
	\quad(a>0)
\end{equation*}当\(p>1\)时收敛，当\(p\leq1\)时发散.
\begin{proof}
当\(p=1\)时，有\begin{equation*}
	\int_a^t \frac{\dd{x}}{x^p}
	= \int_a^t \frac{\dd{x}}{x}
	= \eval{\ln x}_a^t
	= \ln t - \ln a,
\end{equation*}
于是\begin{equation*}
	\int_a^{+\infty} \frac{\dd{x}}{x^p}
	= \lim_{t\to+\infty} \int_a^t \frac{\dd{x}}{x^p}
	= \lim_{t\to+\infty} (\ln t - \ln a)
	= +\infty.
\end{equation*}

当\(p\neq1\)时，有\begin{equation*}
	\int_a^t \frac{\dd{x}}{x^p}
	= \frac{1}{1-p} \int_a^t \dd(x^{1-p})
	= \frac{1}{1-p} \eval{x^{1-p}}_a^t
	= \frac{t^{1-p}-a^{1-p}}{1-p},
\end{equation*}
于是\begin{equation*}
	\int_a^{+\infty} \frac{\dd{x}}{x^p}
	= \lim_{t\to+\infty} \int_a^t \frac{\dd{x}}{x^p}
	= \left\{ \begin{array}{cl}
		\frac{a^{1-p}}{p-1}, & p>1, \\
		+\infty, & p<1.
	\end{array} \right.
\end{equation*}

综上所述，反常积分\begin{equation*}
	\int_a^{+\infty} \frac{\dd{x}}{x^p}
	\quad(a>0)
\end{equation*}当\(p>1\)时收敛于\(\frac{a^{1-p}}{p-1}\)，当\(p\leq1\)时发散.
\end{proof}
\end{proposition}

\begin{example}
证明：反常积分\begin{equation*}
	\int_2^{+\infty} \frac{1}{x \ln^p x} \dd{x}
\end{equation*}
当\(p>1\)时收敛，当\(p\leq1\)时发散.
\begin{proof}
应用换元法，令\(t = \ln x\)，
则\(t \to \ln2\ (x\to2)\)，\(t \to +\infty\ (x\to+\infty)\)，
\begin{equation*}
	\int_2^{+\infty} \frac{1}{x \ln^p x} \dd{x}
	= \int_{\ln2}^{+\infty} \frac{\dd{t}}{t^p};
\end{equation*}
与~\hyperref[example:定积分.p积分]{\(p\)积分}作比较即知，
反常积分\(\int_2^{+\infty} \frac{1}{x \ln^p x} \dd{x}\)%
当\(p>1\)时收敛，当\(p\leq1\)时发散.
\end{proof}
\end{example}

\begin{example}
设\(f\colon[0,+\infty)\to\mathbb{R}\)在任意有限闭区间上黎曼可积，
且\(\lim_{x\to+\infty} f(x) = A\).
证明：\begin{equation*}
	\lim_{x\to+\infty} \frac{1}{x} \int_0^x f(t) \dd{t} = A.
\end{equation*}
\begin{proof}
因为\(\frac{1}{x} \int_0^x A \dd{t} = A\)，
所以，要证\(\lim_{x\to+\infty} \frac{1}{x} \int_0^x f(t) \dd{t} = A\)，
只需证\begin{equation*}
	\lim_{x\to+\infty} \frac{1}{x} \int_0^x [f(t) - A] \dd{t} = 0,
\end{equation*}
即证对\(\forall\epsilon>0,
\exists X>0\)，
当\(x>X\)时，成立\begin{equation*}
	\abs{\frac{1}{x} \int_0^x [f(t) - A] \dd{t} - 0} < \epsilon.
	\eqno(1)
\end{equation*}

当\(x>0\)时，
由\cref{theorem:定积分.定积分性质5推论2} 有，
\begin{align*}
	\abs{\frac{1}{x} \int_0^x [f(t) - A] \dd{t}}
	&\leq
		\frac{1}{x} \int_0^x \abs{f(t) - A} \dd{t} \\
	&=
		\frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t}
		+ \frac{1}{x} \int_X^x \abs{f(t) - A} \dd{t}.
	\tag2
\end{align*}
因为\(\int_0^X \abs{f(t) - A} \dd{t}\)是一个与\(x\)无关的常数，
所以\(\lim_{x\to+\infty} \frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t} = 0\)，
也就是说，对于\(\forall\epsilon>0,
\exists Y>0\)，
当\(x>Y\)时，成立\begin{equation*}
	\abs{\frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t} - 0}
	= \frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t}
	< \frac\epsilon2.
	\eqno(3)
\end{equation*}
由\(\lim_{x\to+\infty} f(x) = A\)，故对\(\forall\epsilon>0,
\exists Z>0\)，
当\(x>Z\)时，成立\(\abs{f(x) - A} < \frac\epsilon2\)，
于是\begin{equation*}
	\frac{1}{x} \int_X^x \abs{f(t) - A} \dd{t}
	< \frac{1}{x} \cdot (x-X) \cdot \frac\epsilon2.
	\eqno(4)
\end{equation*}
因此，由(2)(3)(4)式可知，
对于\(\forall \epsilon>0\)，
当\(x > \max\{Y,Z\}\)时，成立\begin{equation*}
	\abs{\frac{1}{x} \int_0^x [f(t) - A] \dd{t}}
	< \frac\epsilon2 + \frac{1}{x} \cdot (x-X) \cdot \frac\epsilon2
	= \frac\epsilon2 \left( 2 - \frac{X}{x} \right)
	< \epsilon.
\end{equation*}
于是，只要取\(X = \max\{Y,Z\}\)，
就有(1)式成立.
\end{proof}
%@see: 《数学分析中的典型问题与方法（第3版）》（裴礼文） P39 例1.3.20
\end{example}

\begin{example}
%@see: https://www.bilibili.com/video/BV1VG4y1S7Ym/
计算极限\(\lim_{n\to\infty} \frac1n \left( \floor*{\frac{2n}{k}} - 2 \floor*{\frac{n}{k} \vphantom{\frac{2n}{k}}} \right)\).
\begin{solution}\let\qed\relax
\begin{proof}[解法一]
由积分的定义有\begin{equation*}
	I = \lim_{n\to\infty} \frac1n \left( \floor*{\frac{2n}{k}} - 2 \floor*{\frac{n}{k} \vphantom{\frac{2n}{k}}} \right)
	= \int_0^1 \left( \floor*{\frac2x} - 2 \floor*{\frac1x} \right) \dd{x}.
\end{equation*}
令\(t = 1/x\)，
得\(\dd{x} = -\frac{\dd{t}}{t^2}\).
于是\begin{equation*}
	I = \int_1^{+\infty} \frac{\floor{2t} - 2\floor{t}}{t^2} \dd{t}.
\end{equation*}
应该注意到\begin{equation*}
	\int_1^{+\infty} \frac{\floor{2t} - 2\floor{t}}{t^2} \dd{t}
	\neq
	\int_1^{+\infty} \frac{\floor{2t}}{t^2} \dd{t}
	- \int_1^{+\infty} \frac{2\floor{t}}{t^2} \dd{t},
\end{equation*}
这是因为不等号右边的两个反常积分都发散.

对于任意正整数\(n\)，
当\(n \leq t < n+1\)时，
有\(2n \leq 2t < 2(n+1) = 2n+2\)，
从而有\(\floor{t} = n\)，
但是不能确定\(\floor{2t}\)的取值，
这是因为当\(2n \leq 2t < 2n+1\)时\(\floor{2t} = 2n\)，
而当\(2n+1 \leq 2t < 2n+2\)时\(\floor{2t} = 2n+1\)，
所以需要进一步讨论.
由于\begin{gather*}
	2n \leq 2t < 2n+1
	\iff
	n \leq t < n+\frac12, \\
	2n+1 \leq 2t < 2n+2
	\iff
	n+\frac12 \leq t < n+1,
\end{gather*}
所以\begin{equation*}
	\floor{2t} - 2\floor{t}
	= \left\{ \begin{array}{cl}
		0, & \floor{t} \leq t < \floor{t}+1/2, \\
		1, & \floor{t}+1/2 \leq t < \floor{t}+1.
	\end{array} \right.
\end{equation*}
于是\begin{align*}
	I &= \sum_{n=1}^\infty \int_n^{n+1} \frac{\floor{2t}-2\floor{t}}{t^2} \dd{t} \\
	&= \sum_{n=1}^\infty \left(
		\int_n^{n+\frac12} \frac{0}{t^2} \dd{t}
		+ \int_{n+\frac12}^{n+1} \frac{1}{t^2} \dd{t}
	\right) \\
	&= \sum_{n=1}^\infty \int_{n+\frac12}^{n+1} \dd(-\frac1t) \\
	&= \sum_{n=1}^\infty \eval{\left( -\frac1t \right)}_{n+\frac12}^{n+1} \\
	&= \sum_{n=1}^\infty \left( \frac2{2n+1} - \frac2{2n+2} \right) \\
	&= 2 \left( \frac13 - \frac14 + \frac15 - \frac16 + \dotsb \right) \\
	%\cref{equation:无穷级数.幂级数展开式4}
	&= 2 \left( \ln2 - \frac12 \right)
	= 2\ln2 - 1.
\end{align*}
\end{proof}
\begin{proof}[解法二]
直接计算得\begin{align*}
	I &= \lim_{n\to\infty} \frac1n \left( \floor*{\frac{2n}{k}} - 2 \floor*{\frac{n}{k} \vphantom{\frac{2n}{k}}} \right)
	= \int_0^1 \left( \floor*{\frac2x} - 2 \floor*{\frac1x} \right) \dd{x} \\
	&= \int_0^1 \left( \floor*{\frac2x} - \frac2x + \frac2x - 2 \floor*{\frac1x} \right) \dd{x} \\
	&= \int_0^1 \left( \floor*{\frac2x} - \frac2x \right) \dd{x}
	+ 2 \int_0^1 \left( \frac1x - \floor*{\frac1x} \right) \dd{x} \\
	&\xlongequal{2/x=1/t}
	2 \int_0^1 \left( \frac1x - \floor*{\frac1x} \right) \dd{x}
	- 2 \int_0^{\frac12} \left( \frac1x - \floor*{\frac1x} \right) \dd{x} \\
	&= 2 \int_{\frac12}^1 \left( \frac1x - \floor*{\frac1x} \right) \dd{x} \\
	&= 2 \int_{\frac12}^1 \left( \frac1x - 1 \right) \dd{x} \\
	&= 2 \eval{\ln x}_{\frac12}^1 - 1
	= 2\ln2 - 1.
\end{align*}
\end{proof}
\end{solution}
\end{example}
