\section{有理函数的积分}
两个（不含公因式的）多项式\(P(x)\)和\(Q(x)\)的商\(\frac{P(x)}{Q(x)}\)
称为\DefineConcept{有理函数}（rational function），
又称\DefineConcept{有理分式}.
%@see: https://mathworld.wolfram.com/PolynomialQuotient.html
%@see: https://mathworld.wolfram.com/RationalFunction.html
%@Mathematica: PolynomialQuotient[x^4 + x^3 + x^2 + x + 1, x^2 - 1, x]
%@Mathematica: PolynomialQuotientRemainder[x^4 + x^3 + x^2 + x + 1, x^2 - 1, x]
当分子多项式\(P(x)\)的次数小于分母多项式\(Q(x)\)的次数时，
称这有理函数为\DefineConcept{真分式}；
否则称为\DefineConcept{假分式}.

利用多项式的除法，总可以将一个假分式化为一个多项式与一个真分式之和的形式.
例如\[
	\frac{2x^4+x^2+3}{x^2+1}
	= 2x^2-1+\frac{4}{x^2+1}.
%@Mathematica: Apart[(2 x^4 + x^2 + 3)/(x^2 + 1)]
\]

对于真分式\(\frac{P(x)}{Q(x)}\)，
如果分母可分解为两个多项式的乘积\[
	Q(x) = Q_1(x)~Q_2(x),
\]
且\(Q_1(x)\)与\(Q_2(x)\)没有公因式，
那么它可分拆成两个真分式之和\[
	\frac{P(x)}{Q(x)} = \frac{P_1(x)}{Q_1(x)} + \frac{P_2(x)}{Q_2(x)},
\]
我们把上述
将真分式化为\DefineConcept{部分分式}（partial fraction）之和的
步骤称为\DefineConcept{部分分式分解}（partial fraction decomposition）.
如果部分分式的分母还能再分解成两个没有公因式的多项式的乘积，
那么就可再分拆成更简单的部分分式.
最后，有理函数的分解式中只出现三类函数：
\begin{enumerate}
	\item 多项式\(F(x)\)；
	\item 部分分式\(\frac{P_1(x)}{(x-a)^k}\)；
	\item 部分分式\(\frac{P_2(x)}{(x^2+px+q)^l}\)，
\end{enumerate}
其中\(p^2-4q<0\)，
\(P_1(x)\)为小于\(k\)次的多项式，
\(P_2(x)\)为小于\(2l\)次的多项式.

对于部分分式\(\frac{P_1(x)}{(x-a)^k}\)，
我们总可运用以下公式：\[
	\int \frac{\dd{x}}{x-a} = \ln\abs{x-a} + C,
\]\[
	\int \frac{\dd{x}}{(x-a)^k} = \frac{(x-a)^{1-k}}{1-k} + C,
	\quad k>1.
\]

现在我们研究如何计算\[
	\int \frac{Ax+B}{(x^2+px+q)^l} \dd{x}.
\]
经过配方，得\[
	x^2+px+q = \left(x+\frac{p}{2}\right)^2 + q-\frac{p^2}{4}.
\]
令\(a^2=q-p^2/4\)，利用\(u=x+p/2\)换元，得\[
	\int \frac{Ax+B}{(x^2+px+q)^l} \dd{x}
	= A \int \frac{u \dd{u}}{(a^2+u^2)^l}
	+ \left(B - \frac{Ap}{2}\right) \int \frac{\dd{u}}{(a^2+u^2)^l}.
\]

我们先求上式右边第一个不定积分\[
	J_l = \int \frac{u \dd{u}}{(a^2+u^2)^l}.
\]
当\(l=1\)时，\[
	J_1
	= \int \frac{u \dd{u}}{a^2+u^2}
	= \frac{1}{2} \ln(a^2+u^2) + C;
\]
当\(l>1\)时，\[
	J_l
	= \int \frac{u \dd{u}}{(a^2+u^2)^l}
	= \frac{1}{2(1-l)} (a^2+u^2)^{1-l} + C.
\]

我们再求右边第二个不定积分\[
	I_l = \int \frac{1}{(a^2+u^2)^l} \dd{u}.
\]
作分部积分，得\begin{align*}
	I_l &= \frac{u}{(a^2+u^2)^l} + 2l \int \frac{u^2}{(a^2+u^2)^{l+1}} \dd{u} \\
	&= \frac{u}{(a^2+u^2)^l} + 2l \int \frac{a^2+u^2-a^2}{(a^2+u^2)^{l+1}} \dd{u} \\
	&= \frac{u}{(a^2+u^2)^l} + 2l I_l - 2la^2 I_{l+1},
\end{align*}
由此推出\[
	I_{l+1} = \frac{1}{2la^2} \frac{u}{(a^2+u^2)^l} + \frac{2k-1}{2ka^2} I_l.
\]
这是一个递推公式.
反复利用这个公式可以把指标\(l\)降低，
最后归结为已知的不定积分.
最初的几个是\begin{align*}
	I_1 &= \int \frac{1}{a^2+u^2} \dd{u} = \frac{1}{a} \arctan\frac{u}{a} + C, \\
	I_2 &= \frac{1}{2a^2} \left( \frac{u}{a^2+u^2} + I_1 \right), \\
	I_3 &= \frac{1}{4a^2} \left[ \frac{u}{(a^2+u^2)^2} + 3 I_2 \right].
\end{align*}

\begin{example}
求\(\int \frac{x+1}{x^2-5x+6} \dd{x}\).
\begin{solution}
被积函数的分母可分解成\((x-3)(x-2)\)，故可设\[
	\frac{x+1}{x^2-5x+6}
	= \frac{A}{x-3} + \frac{B}{x-2},
\]
其中\(A,B\)为待定系数.上式两端通分后，得\[
	x+1 = A(x-2)+B(x-3),
\]
即\[
	x+1 = (A+B)x -(2A+3B).
\]
比较上式两端同次幂的系数，即有\[
	\left\{ \begin{array}{l}
		A+B = 1, \\
		2A+3B = -1,
	\end{array} \right.
\]
从而解得\(A=4\)，\(B=-3\).
于是\[
	\int \frac{x+1}{x^2-5x+6} \dd{x}
	= \int \left(\frac{4}{x-3} - \frac{3}{x-2}\right) \dd{x}
	= 4\ln\abs{x-3} - 3\ln\abs{x-2} + C.
%@Mathematica: Apart[(x + 1)/(x^2 - 5 x + 6)]
%@Mathematica: Integrate[(x + 1)/(x^2 - 5 x + 6), x]
\]
\end{solution}
\end{example}

\begin{example}
计算不定积分\(\int \frac1{(x+1)(x^2-2x+2)} \dd{x}\).
\begin{solution}
设\begin{align*}
	\frac1{(x+1)(x^2-2x+2)}
	&= \frac{A}{x+1} + \frac{Bx+C}{x^2-2x+2} \\
	&= \frac{(A+B)x^2+(B+C-2A)x+(2A+C)}{(x+1)(x^2-2x+2)},
\end{align*}
比较可得\begin{equation*}
	\left\{ \begin{array}{*7r}
		A &+& B && &=& 0, \\
		-2A &+& B &+& C &=& 0, \\
		2A && &+& C &=& 1.
	\end{array} \right.
\end{equation*}
解得\(A=\frac15,
B=-\frac15,
C=\frac35\).
于是\begin{equation*}
	\frac1{(x+1)(x^2-2x+2)}
	= \frac15 \left( \frac1{x+1} - \frac{x-3}{x^2-2x+2} \right).
\end{equation*}
而\begin{align*}
	\int \frac1{x+1} \dd{x}
	&= \ln(x+1) + C_1, \\
	\int \frac{x-3}{x^2-2x+2} \dd{x}
	&= \int \frac{x-1}{(x-1)^2+1} \dd{x}
	- \int \frac{2}{(x-1)^2+1} \dd{x} \\
	&= \frac12 \int \frac{\dd{[(x-1)^2+1]}}{(x-1)^2+1}
	- 2 \int \frac{\dd{(x-1)}}{(x-1)^2+1} \\
	&= \frac12 \ln(x-1)^2
	- 2 \arctan(x-1) + C_2.
\end{align*}
因此\begin{equation*}
	\int \frac1{(x+1)(x^2-2x+2)} \dd{x}
	= \frac15 \left[
		\ln(x+1) + \frac12 \ln(x-1)^2 - 2 \arctan(x-1)
	\right] + C.
\end{equation*}
\end{solution}
\end{example}
