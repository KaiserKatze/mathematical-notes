\section{斯托克斯公式，环流量与旋度}
\subsection{斯托克斯公式}
斯托克斯公式是\hyperref[equation:线积分与面积分.格林公式]{格林公式}的推广.
格林公式表达了平面闭区域上的二重积分与其边界曲线上的曲线积分间的关系，
而斯托克斯公式则把曲面\(\Sigma\)上的曲面积分与沿着\(\Sigma\)的边界曲线的曲线积分联系起来.
这个联系可陈述如下：

\begin{theorem}[斯托克斯公式]
设\(\Gamma\)为分段光滑的空间有向闭曲线，
\(\Sigma\)是以\(\Gamma\)为边界的分片光滑的有向曲面，
\(\Gamma\)的正向与\(\Sigma\)的侧符合“右手规则%
\footnote{右手规则是指当右手除拇指外的四指依\(\Gamma\)的绕行方向时，
拇指所指的方向与\(\Sigma\)上法向量的指向相同.
这时称\(\Gamma\)是有向曲面\(\Sigma\)的\DefineConcept{正向边界曲线}.}”，
函数\(P(x,y,z)\)、\(Q(x,y,z)\)、\(R(x,y,z)\)
在曲面\(\Sigma\)（连同边界\(\Gamma\)）上具有一阶连续偏导数，则有
\begin{equation}\label{equation:线积分与面积分.斯托克斯公式}
	\begin{split}
		&\hspace{-20pt}\iint_\Sigma
			\left( \pdv{R}{y} - \pdv{Q}{z} \right)\dd{y}\dd{z}
			+\left( \pdv{P}{z} - \pdv{R}{x} \right)\dd{z}\dd{x}
			+\left( \pdv{Q}{x} - \pdv{P}{y} \right)\dd{x}\dd{y} \\
		&= \oint_\Gamma P\dd{x}+Q\dd{y}+R\dd{z}.
	\end{split}
\end{equation}
%TODO proof
\end{theorem}

为了便于记忆，利用行列式记号把斯托克斯公式写成\[
	\iint_\Sigma \begin{vmatrix}
		\dd{y}\dd{z} & \dd{z}\dd{x} & \dd{x}\dd{y} \\
		\pdv{x} & \pdv{y} & \pdv{z} \\
		P & Q & R
	\end{vmatrix}
	= \oint_\Gamma P\dd{x}+Q\dd{y}+R\dd{z},
\]
把其中的行列式按第一行展开，并把\(\pdv{y}\)与\(R\)的“积”理解为\(\pdv{R}{y}\)，并以此类推.

利用两类曲面积分间的联系，可得斯托克斯公式的另一形式\[
	\iint_\Sigma \begin{vmatrix}
		\cos\alpha & \cos\beta & \cos\gamma \\
		\pdv{x} & \pdv{y} & \pdv{z} \\
		P & Q & R
	\end{vmatrix} \dd{S}
	= \oint_\Gamma P\dd{x}+Q\dd{y}+R\dd{z},
\]
其中\(\vb{n}=(\cos\alpha,\cos\beta,\cos\gamma)\)为
有向曲面\(\Sigma\)在点\((x,y,z)\)处的单位法向量.

如果我们再进一步借用分块矩阵的记法，则可将斯托克斯公式写成\[
	\iint_\Sigma \begin{vmatrix}
		\dd{\vb{S}} \\
		\grad \\
		\vb{A}
	\end{vmatrix}
	= \oint_\Gamma \vb{A} \cdot \dd{\vb{r}}
	\quad\text{或}\quad
	\iint_\Sigma \begin{vmatrix}
		\vb{n} \\
		\grad \\
		\vb{A}
	\end{vmatrix} \dd{S}
	= \oint_\Gamma \vb{A} \cdot \dd{\vb{r}}.
\]

如果\(\Sigma\)是\(xOy\)面上的一块平面闭区域，斯托克斯公式就变成格林公式.
因此，格林公式是斯托克斯公式的一种特殊情形，即\[
	\iint_\Sigma \begin{vmatrix}
		0 & 0 & \dd{x}\dd{y} \\
		\pdv{x} & \pdv{y} & \pdv{z} \\
		P & Q & 0 \\
	\end{vmatrix}
	= \oint_\Gamma P\dd{x}+Q\dd{y}.
\]

\begin{example}
%@see: 《高等数学（第六版 上册）》 P240 例1
利用斯托克斯公式计算曲线积分\(\oint_\Gamma z\dd{x}+x\dd{y}+y\dd{z}\)，
其中\(\Gamma\)是平面\(x+y+z=1\)被三个坐标面所截成的三角形的整个边界，
它的正向与这个平面三角形\(\Sigma\)上侧的法向量之间符合右手规则.
\begin{solution}
按斯托克斯公式，有\[
	\oint_\Gamma z\dd{x}+x\dd{y}+y\dd{z}
	= \iint_\Sigma \dd{y}\dd{z}+\dd{z}\dd{x}+\dd{x}\dd{y}.
\]
而\begin{gather*}
	\iint_\Sigma \dd{y}\dd{z} = \iint_{D_{yz}} \dd{\sigma} = \frac12, \\
	\iint_\Sigma \dd{z}\dd{x} = \iint_{D_{zx}} \dd{\sigma} = \frac12, \\
	\iint_\Sigma \dd{x}\dd{y} = \iint_{D_{xy}} \dd{\sigma} = \frac12,
\end{gather*}
其中\(D_{yz},D_{zx},D_{xy}\)分别是\(\Sigma\)在\(yOz,zOx,xOy\)面上的投影区域，
因此\[
	\oint_\Gamma z\dd{x}+x\dd{y}+y\dd{z} = \frac32.
\]
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P240 例2
利用斯托克斯公式计算曲线积分\[
	I = \oint_\Gamma (y^2-z^2)\dd{x}+(z^2-x^2)\dd{y}+(x^2-y^2)\dd{z},
\]
其中\(\Gamma\)是用平面\(x+y+z=\frac32\)
截立方体\(\Set{(x,y,z)\given0\leq x\leq1,0\leq y\leq1,0\leq z\leq1}\)的表面所得的截口，
若从\(Ox\)轴的正向看去，取逆时针方向.
\begin{solution}
取\(\Sigma\)为平面\(x+y+z=\frac32\)的上侧被\(\Gamma\)所围成的部分，
\(\Sigma\)的单位法向量\(\vb{n}=\frac1{\sqrt3}(1,1,1)\)，
即\(\cos\alpha=\cos\beta=\cos\gamma=\frac1{\sqrt3}\).
按斯托克斯公式，有\begin{align*}
	I &= \iint_\Sigma \begin{vmatrix}
		\frac1{\sqrt3} & \frac1{\sqrt3} & \frac1{\sqrt3} \\
		\pdv{x} & \pdv{y} & \pdv{z} \\
		y^2-z^2 & z^2-x^2 & x^2-y^2
	\end{vmatrix} \dd{S} \\
	&= -\frac4{\sqrt3} \iint_\Sigma (x+y+z) \dd{S}.
\end{align*}
因为在\(\Sigma\)上\(x+y+z=\frac32\)，
所以\[
	I = -\frac4{\sqrt3} \cdot \frac32 \iint_\Sigma \dd{S}
	= -2\sqrt3 \iint_{D_{xy}} \sqrt3 \dd{x}\dd{y}
	= -6 \sigma_{xy},
\]
其中\(D_{xy}\)是\(\Sigma\)在\(xOy\)平面上的投影区域，
\(\sigma_{xy}\)是\(D_{xy}\)的面积.
因\(\sigma_{xy} = 1-2\times\frac18=\frac34\)，
故\(I=-\frac92\).
\end{solution}
\end{example}

\subsection{空间曲线积分与路径无关的条件}
\begin{theorem}\label{theorem:线积分与面积分.空间曲线积分与路径无关的条件}
设空间区域\(G\)是一维单连通区域，
函数\(P(x,y,z)\)、\(Q(x,y,z)\)、\(R(x,y,z)\)在\(G\)内具有一阶连续偏导数，
则空间曲线积分\(\int_\Gamma P\dd{x}+Q\dd{y}+R\dd{z}\)
在\(G\)内与路径无关（或沿\(G\)内任意闭曲线的曲线积分为零）的充分必要条件是\[
	\pdv{P}{y}=\pdv{Q}{x}, \qquad
	\pdv{Q}{z}=\pdv{R}{y}, \qquad
	\pdv{R}{x}=\pdv{P}{z}
\]在\(G\)内恒成立.
%TODO proof
\end{theorem}

\begin{theorem}\label{theorem:线积分与面积分.与路径无关的空间曲线积分}
设区域\(G\)是空间一维单连通区域，
函数\(P(x,y,z)\)、\(Q(x,y,z)\)、\(R(x,y,z)\)在\(G\)内具有一阶连续偏导数，
则表达式\(P\dd{x}+Q\dd{y}+R\dd{z}\)在\(G\)内成为某一函数\(u(x,y,z)\)的全微分，
即\begin{align*}
	u(x,y,z)
	&= \int_{(x_0,y_0,z_0)}^{(x,y,z)}
	P\dd{x}+Q\dd{y}+R\dd{z} \\
	&= \int_{x_0}^x P(x,y_0,z_0) \dd{x}
	+ \int_{y_0}^y Q(x,y,z_0) \dd{y}
	+ \int_{z_0}^z R(x,y,z) \dd{z}
\end{align*}的充分必要条件是\[
	\pdv{P}{y}=\pdv{Q}{x}, \qquad
	\pdv{Q}{z}=\pdv{R}{y}, \qquad
	\pdv{R}{x}=\pdv{P}{z}
\]在\(G\)内恒成立.
%TODO proof
\end{theorem}

\subsection{环流量与旋度}
\begin{definition}
设有向量场\[
\vb{A}(x,y,z)=P(x,y,z)\vb{i}+Q(x,y,z)\vb{j}+R(x,y,z)\vb{k},
\]其中函数\(P\)、\(Q\)、\(R\)均连续，
\(\Gamma\)是\(\vb{A}\)的定义域内的一条分段光滑的有向闭曲线，
\(\vb{\tau}\)是\(\Gamma\)在点\((x,y,z)\)处的单位切向量，
则积分\[
	\oint_\Gamma \vb{A}\cdot\vb{\tau}\dd{s}
\]称为“向量场\(\vb{A}\)沿有向闭曲线\(\Gamma\)的\DefineConcept{环流量}”.
\end{definition}
由两类曲线积分的关系，环流量又可表达为\[
	\oint_\Gamma \vb{A}\cdot\vb{\tau}\dd{s}
	=\oint_\Gamma \vb{A}\cdot\dd{\vb{r}}
	=\oint_\Gamma P\dd{x}+Q\dd{y}+R\dd{z}.
\]

\begin{definition}
设有向量场\[
	\vb{A}(x,y,z)=P(x,y,z)\vb{i}+Q(x,y,z)\vb{j}+R(x,y,z)\vb{k},
\]
其中函数\(P\)、\(Q\)、\(R\)均具有一阶连续偏导数，
则向量\[
	\left( \pdv{R}{y} - \pdv{Q}{z} \right)\vb{i}
	+\left( \pdv{P}{z} - \pdv{R}{x} \right)\vb{j}
	+\left( \pdv{Q}{x} - \pdv{P}{y} \right)\vb{k}
\]
称为“向量场\(\vb{A}\)的\DefineConcept{旋度}”，
记作\(\curl{\vb{A}}\)或\(\operatorname{rot}\vb{A}\)，
即\[
	\curl{\vb{A}}
	=\left( \pdv{R}{y} - \pdv{Q}{z} \right)\vb{i}
	+\left( \pdv{P}{z} - \pdv{R}{x} \right)\vb{j}
	+\left( \pdv{Q}{x} - \pdv{P}{y} \right)\vb{k}.
\]
\end{definition}

为了便于记忆，利用行列式记号把旋度公式改写为\[
	\curl{\vb{A}}
	= \begin{vmatrix}
		\vb{i} & \vb{j} & \vb{k} \\
		\pdv{x} & \pdv{y} & \pdv{z} \\
		P & Q & R
	\end{vmatrix},
\]
把其中的行列式按第一行展开，
并把\(\pdv{y}\)与\(R\)的“积”理解为\(\pdv{R}{y}\)，
并以此类推.

\begin{definition}
如果向量场\(\vb{A}\)的旋度\(\curl{\vb{A}}\)处处为零，
则称向量场\(\vb{A}\)为\DefineConcept{无旋场}.
一个无源、无旋的向量场称为\DefineConcept{调和场}.
\end{definition}
调和场是物理学中一类重要的向量场，这种场与调和函数有密切的关系.

设斯托克斯公式中有向曲面\(\Sigma\)在点\((x,y,z)\)处的单位法向量为\[
	\vb{n} = \cos\alpha \vb{i} + \cos\beta \vb{j} + \cos\gamma \vb{k},
\]
则\[
	(\curl{\vb{A}}) \cdot \vb{n} = \begin{vmatrix}
		\cos\alpha & \cos\beta & \cos\gamma \\
		\pdv{x} & \pdv{y} & \pdv{z} \\
		P & Q & R
	\end{vmatrix}.
\]
于是，斯托克斯公式可以写成下面的向量形式\[
	\iint_\Sigma \curl{\vb{A}} \cdot \vb{n} \dd{S}
	= \oint_L \vb{A} \cdot \vb{\tau} \dd{s}
\]或\[
	\iint_\Sigma \curl{\vb{A}} \cdot \dd{\vb{S}}
	= \oint_L \vb{A} \cdot \dd{\vb{s}}.
\]
上式表明：向量场\(\vb{A}\)沿有向闭曲线\(\Gamma\)的环流量
等于向量场\(\vb{A}\)的旋度通过曲面\(\Sigma\)的通量，
这里\(\Gamma\)的正向与\(\Sigma\)的侧应符合右手规则.

\begin{example}
证明：\(\curl(\vb{a}+\vb{b}) = \curl\vb{a} + \curl\vb{b}\).
\begin{proof}
设\[
	\vb{a}=P_1\vb{i}+Q_1\vb{j}+R_1\vb{k}, \qquad
	\vb{b}=P_2\vb{i}+Q_2\vb{j}+R_2\vb{k}
\]
那么\[
	\curl{\vb{a}}
	=\left( \pdv{R_1}{y} - \pdv{Q_1}{z} \right)\vb{i}
	+\left( \pdv{P_1}{z} - \pdv{R_1}{x} \right)\vb{j}
	+\left( \pdv{Q_1}{x} - \pdv{P_1}{y} \right)\vb{k},
\]\[
	\curl{\vb{b}}
	=\left( \pdv{R_2}{y} - \pdv{Q_2}{z} \right)\vb{i}
	+\left( \pdv{P_2}{z} - \pdv{R_2}{x} \right)\vb{j}
	+\left( \pdv{Q_2}{x} - \pdv{P_2}{y} \right)\vb{k},
\]
所以{\def\arraystretch{1.5}
\begin{align*}
	\curl{\vb{a}} + \curl{\vb{b}}
	&= \begin{bmatrix}
		\pdv{R_1}{y} - \pdv{Q_1}{z} \\
		\pdv{P_1}{z} - \pdv{R_1}{x} \\
		\pdv{Q_1}{x} - \pdv{P_1}{y}
	\end{bmatrix}
	+ \begin{bmatrix}
		\pdv{R_2}{y} - \pdv{Q_2}{z} \\
		\pdv{P_2}{z} - \pdv{R_2}{x} \\
		\pdv{Q_2}{x} - \pdv{P_2}{y}
	\end{bmatrix} \\
	&= \begin{bmatrix}
		\pdv{y}(R_1+R_2) - \pdv{z}(Q_1+Q_2) \\
		\pdv{z}(P_1+P_2) - \pdv{x}(R_1+R_2) \\
		\pdv{x}(Q_1+Q_2) - \pdv{y}(P_1+P_2)
	\end{bmatrix}
	= \curl(\vb{a}+\vb{b}).
	\qedhere
\end{align*}}
\end{proof}
\end{example}

\begin{example}
设\(u = u(x,y,z)\)具有二阶连续偏导数，求\(\curl(\grad u)\).
\begin{solution}
因为\[
	\grad u = \pdv{u}{x} \vb{i} + \pdv{u}{y} \vb{j} + \pdv{u}{z} \vb{k},
\]
所以\[
	\curl(\grad u)
	= \left( \pdv[2]{u}{z}{y} - \pdv[2]{u}{y}{z} \right) \vb{i}
	+ \left( \pdv[2]{u}{x}{z} - \pdv[2]{u}{z}{x} \right) \vb{j}
	+ \left( \pdv[2]{u}{y}{x} - \pdv[2]{u}{x}{y} \right) \vb{k}.
\]
又因为\(u(x,y,z)\)的二阶偏导数是连续的，
那么\[
	\pdv[2]{u}{z}{y} = \pdv[2]{u}{y}{z},
	\qquad
	\pdv[2]{u}{x}{z} = \pdv[2]{u}{z}{x},
	\qquad
	\pdv[2]{u}{y}{x} = \pdv[2]{u}{x}{y},
\]
因此\(\curl(\grad u) = \vb{0}\).
\end{solution}
\end{example}

\begin{example}
设\(\vb{A}(x,y,z) = P(x,y,z) \vb{i} + Q(x,y,z) \vb{j} + R(x,y,z) \vb{k}\)的分量函数\(P,Q,R\)都具有二阶连续偏导数，
求\(\div(\curl \vb{A})\).
\begin{solution}
因为\begin{equation*}
	\curl \vb{A}
	= \left( \pdv{R}{y} - \pdv{Q}{z} \right) \vb{i}
	+ \left( \pdv{P}{z} - \pdv{R}{x} \right) \vb{j}
	+ \left( \pdv{Q}{x} - \pdv{P}{y} \right) \vb{k},
\end{equation*}
所以\begin{align*}
	\div(\curl \vb{A})
	&= \pdv{x} \left( \pdv{R}{y} - \pdv{Q}{z} \right)
	+ \pdv{y} \left( \pdv{P}{z} - \pdv{R}{x} \right)
	+ \pdv{z} \left( \pdv{Q}{x} - \pdv{P}{y} \right) \\
	&= \left( \pdv[2]{R}{y}{x} - \pdv[2]{Q}{z}{x} \right)
	+ \left( \pdv[2]{P}{z}{y} - \pdv[2]{R}{x}{y} \right)
	+ \left( \pdv[2]{Q}{x}{z} - \pdv[2]{P}{y}{z} \right),
\end{align*}
又因为\(\vb{A}\)的分量函数\(P,Q,R\)的二阶偏导数是连续的，
那么\begin{equation*}
	\pdv[2]{R}{x}{y} = \pdv[2]{R}{y}{x},
	\qquad
	\pdv[2]{Q}{x}{z} = \pdv[2]{Q}{z}{x},
	\qquad
	\pdv[2]{P}{y}{z} = \pdv[2]{P}{z}{y},
\end{equation*}
所以\(\div(\curl \vb{A}) = 0\).
\end{solution}
\end{example}
