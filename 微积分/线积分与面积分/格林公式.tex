\section{格林公式}
\subsection{格林公式}
在一元函数积分学中，牛顿--莱布尼茨公式\[
	\int_a^b f(x) \dd{x} = F(b) - F(a)
\]表示：\(f(x)\)在区间\([a,b]\)上的积分可以通过它的原函数\(F(x)\)在这个区间端点上的值来表达.

下面要介绍的格林公式告诉我们，
在平面闭区域\(D\)上的二重积分可以通过沿闭区域\(D\)的边界曲线\(L\)上的曲线积分来表达.

\begin{definition}\label{definition:线积分与面积分.平面闭区域的边界曲线的取向}
对于平面区域\(D\)的边界曲线\(C = \partial D\)，
我们规定\(C\)的方向如下：

设坐标平面的\(x\)轴、\(y\)轴对应的基向量分别为\(\vb{e}_x\)和\(\vb{e}_y\)，
令\(\vb{e}_z = \vb{e}_x \times \vb{e}_y\).任取点\(P \in C\)，
则可得与曲线切于点\(P\)的直线\(L\).

在点\(P\)取一个半径\(r\)足够小的去心邻域，
使得其与区域\(D\)的内部的交集\(I(D) \cap \mathring{U}(P,r)\)是单连通区域，
再从中任取一点\(Q\)，
即\[
	Q \in I(D) \cap \mathring{U}(P,r).
\]

任意取一个与直线\(L\)平行的单位向量\(\vb{e}_L\).
令\(\Phi = \VectorInnerProductDot{(\vb{e}_z \times \vb{e}_L)}{\vec{PQ}}\).
如果\[
	\Phi < 0,
\]
则称“单位向量\(\vb{e}_L\)的方向为曲线\(C\)在点\(P\)处的正方向”；
反之，如果\[
	\Phi > 0,
\]
则称“单位向量\(\vb{e}_L\)的方向为曲线\(C\)在点\(P\)处的负方向”.
\end{definition}
如\cref{figure:线积分与面积分.平面区域的边界曲线与其取向}，
平面区域\(D\)的边界是曲线\(L\)和曲线\(l\)的并集\(L+l\).
曲线\(L\)的正向是它的逆时针方向（记作\(L^+\)），
其负向是它的顺时针方向（记作\(L^-\)）；
曲线\(l\)的正向是它的顺时针方向（记作\(l^+\)），
其负向是它的逆时针方向（记作\(l^-\)）；
总的来说，平面区域\(D\)的正向边界曲线就是\((L^+ + l^+)\).

\begin{figure}[htb]
\centering
\begin{tikzpicture}[scale=.7]
	\draw[orange,fill=gray!40,rotate=60,thick] (0,0)ellipse[x radius=5,y radius=4];
	\draw[orange,fill=white,thick] (1,1)ellipse[x radius=2,y radius=2];
	\draw (-2,-2)node{\(D\)};
	\begin{scope}[rotate=60]
		\coordinate (P1) at (5.5,0);
		\draw (P1)node{\(L\)};
		\draw[->] (P1)+(0,.5) arc[start angle=0,end angle=20,radius=3]node[left]{\(+\)};
		\draw[->] (P1)+(0,-.5) arc[start angle=0,end angle=-20,radius=3]node[below right]{\(-\)};
	\end{scope}
	\begin{scope}
		\coordinate (P2) at (2.7,1);
		\draw (P2)node[left]{\(l\)};
		\draw[->] (P2)+(-.5,.5) arc[start angle=0,end angle=40,radius=1]node[left]{\(-\)};
		\draw[->] (P2)+(-.5,-.5) arc[start angle=0,end angle=-40,radius=1]node[left]{\(+\)};
	\end{scope}
\end{tikzpicture}
\caption{}
\label{figure:线积分与面积分.平面区域的边界曲线与其取向}
\end{figure}

\begin{theorem}[格林公式]
%@see: 《高等数学（第六版 下册）》 P202 定理1
设闭区域\(D\)由分段光滑的曲线\(L\)围成，
函数\(P(x,y)\)和\(Q(x,y)\)在\(D\)上具有一阶连续偏导数，
则有
\begin{equation}\label{equation:线积分与面积分.格林公式}
	\iint_D \left( \pdv{Q}{x} - \pdv{P}{y} \right) \dd{x}\dd{y}
	= \oint_L P\dd{x} + Q\dd{y},
\end{equation}
其中\(L\)是\(D\)的取正向的边界曲线\footnote{%
如果\(D\)是复连通区域，
那么\cref{equation:线积分与面积分.格林公式}
右端应包括沿区域\(D\)的全部边界的曲线积分
（如\cref{figure:线积分与面积分.平面区域的边界曲线与其取向} 中的曲线\(L\)和\(l\)），
且边界的方向对区域\(D\)来说都是正向.}.
%TODO proof
\end{theorem}
\cref{equation:线积分与面积分.格林公式} 叫做\DefineConcept{格林公式}.

为了方便记忆，我们可以利用行列式记号，把格林公式写成如下形式：\[
	\iint_D \begin{vmatrix}
		\pdv{x} & \pdv{y} \\
		P & Q
	\end{vmatrix} \dd{x}\dd{y}
	= \oint_L P\dd{x}+Q\dd{y}.
\]

下面说明格林公式的一个简单应用.
在格林公式中，
令\(P=-y\)、\(Q=x\)，
可得\[
	2 \iint_D \dd{x}\dd{y}
	=\oint_L x\dd{y}-y\dd{x}.
\]
上式左端是闭区域\(D\)的面积\(A\)的两倍，
因此有
\begin{equation}\label{equation:线积分与面积分.利用格林公式计算闭区域的面积}
	A = \frac{1}{2} \oint_L x\dd{y}-y\dd{x}.
\end{equation}

\begin{example}
求椭圆\(x = a \cos\theta, y = b \sin\theta\)所围成图形的面积\(A\).
\begin{solution}
根据\cref{equation:线积分与面积分.利用格林公式计算闭区域的面积} 有
\begin{align*}
	A &= \frac{1}{2} \oint_L x\dd{y}-y\dd{x} \\
	&= \frac{1}{2} \int_0^{2\pi}
		\left[
			a \cos\theta \cdot b \cos\theta
			- b \sin\theta \cdot (-a \sin\theta)
		\right] \dd{\theta} \\
	&= \frac{1}{2} ab \int_0^{2\pi} \dd{\theta}
	= \pi ab.
\end{align*}
\end{solution}
\end{example}

\begin{example}
计算\(\oint_L \frac{x\dd{y}-y\dd{x}}{x^2+y^2}\)，
其中\(L\)是一条不经过原点的分段光滑的若尔当闭曲线，
\(L\)的方向为逆时针方向.
\begin{solution}
记\(P = -\frac{y}{x^2+y^2}, Q = \frac{x}{x^2+y^2}\).
当\(x^2+y^2\neq0\)时，
有\[
	\pdv{Q}{x} = \frac{y^2-x^2}{(x^2+y^2)^2} = \pdv{P}{y}.
\]
记\(L\)所围成的闭区域为\(D\).

当\((0,0) \notin D\)时，
由\cref{equation:线积分与面积分.格林公式} 有\[
	\oint_L \frac{x\dd{y}-y\dd{x}}{x^2+y^2} = \iint_D 0 \dd{x}\dd{y} = 0;
\]

当\((0,0) \in D\)时，
取\(r>0\)使得\(D_r = \Set{ (x,y) \given x^2+y^2 < r^2 } \subseteq D\)，
令\(l = \partial D_r\)，
\(D_1 = D - D_r\).
对复连通区域\(D_1\)应用格林公式，
得\[
	\oint_L \frac{x\dd{y}-y\dd{x}}{x^2+y^2} - \oint_l \frac{x\dd{y}-y\dd{x}}{x^2+y^2}
	= \iint_{D_1} 0 \dd{x}\dd{y} = 0,
\]
其中\(l\)的方向取逆时针方向.
于是\[
	\oint_L \frac{x\dd{y}-y\dd{x}}{x^2+y^2}
	= \oint_l \frac{x\dd{y}-y\dd{x}}{x^2+y^2}
	= \int_0^{2\pi} \frac{r^2 \cos^2\theta + r^2 \sin^2\theta}{r^2} \dd{\theta}
	= 2\pi.
\]
综上所述\[
	\oint_L \frac{x\dd{y}-y\dd{x}}{x^2+y^2}
	= \begin{cases}
		2\pi, & (0,0) \in D, \\
		0, & (0,0) \notin D.
	\end{cases}
\]
\end{solution}
\end{example}

\begin{example}[二维格林第一公式、二维格林第二公式]
设\(u(x,y)\)、\(v(x,y)\)在闭区域\(D\)上都具有二阶连续偏导数，
分段光滑的曲线\(L\)为\(D\)的正向边界曲线.
证明：\begin{gather}
	\iint_D v \laplacian{u} \dd{x}\dd{y}
	= -\iint_D (\VectorInnerProductDot{\grad u}{\grad v}) \dd{x}\dd{y}
		+ \oint_L v \pdv{u}{\vb{n}} \dd{s};
		\label{equation:线积分与面积分.二维格林第一公式} \\
	\iint_D (u \laplacian v - v \laplacian u) \dd{x}\dd{y}
	= \oint_L \left( u \pdv{v}{\vb{n}} - v \pdv{u}{\vb{n}} \right) \dd{s},
		\label{equation:线积分与面积分.二维格林第二公式}
\end{gather}
其中\(\pdv{u}{\vb{n}}\)、\(\pdv{v}{\vb{n}}\)
分别是\(u\)、\(v\)沿\(L\)的外法线向量\(\vb{n}\)的方向导数，
二维拉普拉斯算子\(\laplacian = \pdv[2]{x} + \pdv[2]{y}\).
\begin{proof}
因为方向导数\[
	\pdv{u}{\vb{n}}
	= \pdv{u}{x} \cos\alpha
	+ \pdv{u}{y} \cos\beta,
	\qquad
	\pdv{v}{\vb{n}}
	= \pdv{v}{x} \cos\alpha
	+ \pdv{v}{y} \cos\beta,
\]其中\(\cos\alpha\)、\(\cos\beta\)是\(L\)在点\((x,y)\)处的外法线向量的方向余弦，
那么\(L\)在该点处的正向单位切向量为\(\vb{\tau} = (-\cos\beta,\cos\alpha)\)，
于是利用格林公式可得\begin{align*}
	\oint_L v \pdv{u}{\vb{n}} \dd{s}
	&= \oint_L v \left(
	\pdv{u}{x} \cos\alpha
	+ \pdv{u}{y} \cos\beta
	\right) \dd{s} \\
	&= \oint_L \left( - v \pdv{u}{y} \right) \dd{x}
		+ \left( v \pdv{u}{x} \right) \dd{y} \\
	&= \iint_D \left[
		\pdv{x} \left( v \pdv{u}{x} \right)
		- \pdv{y} \left( - v \pdv{u}{y} \right)
		\right] \dd{x}\dd{y} \\
	&= \iint_D \left(
		\pdv{v}{x} \pdv{u}{x}
		+ v \pdv[2]{u}{x}
		+ \pdv{v}{y} \pdv{u}{y}
		+ v \pdv[2]{u}{y}
		\right) \dd{x}\dd{y} \\
	&= \iint_D (\VectorInnerProductDot{\grad u}{\grad v}) \dd{x}\dd{y}
		+ \iint_D v \laplacian{u} \dd{x}\dd{y},
\end{align*}
移项可得\[
	\iint_D v \laplacian{u} \dd{x}\dd{y}
	= - \iint_D (\VectorInnerProductDot{\grad u}{\grad v}) \dd{x}\dd{y}
	+ \oint_L v \pdv{u}{\vb{n}} \dd{s}.
	\eqno(1)
\]
同理可得\[
	\iint_D u \laplacian{v} \dd{x}\dd{y}
	= - \iint_D (\VectorInnerProductDot{\grad v}{\grad u}) \dd{x}\dd{y}
	+ \oint_L u \pdv{v}{\vb{n}} \dd{s}.
	\eqno(2)
\]
(2)式与(1)式相减便得\[
	\iint_D (u \laplacian{v} - v \laplacian{u}) \dd{x}\dd{y}
	= \oint_L \left(
		u \pdv{v}{\vb{n}} - v \pdv{u}{\vb{n}}
	\right) \dd{s}.
	\qedhere
\]
\end{proof}
\end{example}

\begin{example}
设函数\(f(x,y)\)在区域\(D=\Set{(x,y) \given x^2+y^2\leq1}\)上具有二阶连续偏导数，
且\(\laplacian{f}=e^{-(x^2+y^2)}\)，
求二重积分\(I=\iint_D\left(x\pdv{f}{x}+y\pdv{f}{y}\right)\dd{x}\dd{y}\).
\begin{solution}
考虑区域\(D\)的形状，将积分\(I\)化为在极坐标系下的积分，
令\(x=\rho\cos\theta, y=\rho\sin\theta\)：
\begin{align*}
	I &= \int_0^1 \rho\dd{\rho} \int_0^{2\pi}
		\left(\rho\cos\theta\pdv{f}{x}+\rho\sin\theta\pdv{f}{y}\right) \dd{\theta} \\
	&= \int_0^1 \rho\dd{\rho} \int_0^{2\pi}
		\left[\pdv{f}{x}\dd(\rho\sin\theta)-\pdv{f}{y}\dd(\rho\cos\theta)\right].
\end{align*}
考虑到\(\dd{x}=\dd(\rho\cos\theta),
\dd{y}=\dd(\rho\sin\theta)\)，
所以\[
	I = \int_0^1 \rho\dd{\rho} \oint_{L_\rho} \pdv{f}{x}\dd{y}-\pdv{f}{y}\dd{x}.
\]
其中\(L_\rho: x^2+y^2=\rho^2\).
令\(D_\rho = \Set{ (x,y) \given x^2+y^2\leq\rho^2 }\)，
应用\hyperref[equation:线积分与面积分.格林公式]{格林公式}，
则有\begin{align*}
	\oint_{L_\rho} \pdv{f}{x}\dd{y}-\pdv{f}{y}\dd{x}
	&= \iint_{D_\rho} \laplacian{f} \dd{x}\dd{y} \\
	&= \iint_{D_\rho} e^{-(x^2+y^2)} \dd{x}\dd{y} \\
	&= \int_0^{2\pi} \dd{\theta} \int_0^\rho e^{-r^2} r\dd{r} \\
	&= \pi \left(1-e^{-\rho^2}\right).
\end{align*}
那么\[
	I = \int_0^1 \pi \left(1-e^{-\rho^2}\right) \rho\dd{\rho}
	=  \frac{\pi}{2e}.
\]
\end{solution}
\end{example}

%@see: 《2000年全国硕士研究生入学统一考试（数学一）》五解答题
%@see: 《2020年全国硕士研究生入学统一考试（数学一）》三解答题/第16题

\begin{example}
%@see: https://www.bilibili.com/video/BV1sKSTYdETC/
计算曲线积分\(\oint_\Gamma y \dd{x} + z \dd{y} + x \dd{z}\)，
其中\(\Gamma\)是\(x^2+y^2+z^2=1\)和\(x+y+z=1\)的交线.
\begin{solution}
将\(z = 1-x-y\)代入，得\begin{align*}
	\oint_\Gamma y \dd{x} + z \dd{y} + x \dd{z}
	&= \oint_L y \dd{x} + (1-x-y) \dd{y} + x \dd(1-x-y) \\
	&= \oint_L (y-x) \dd{x} + (1-2x-y) \dd{y},
\end{align*}
其中\(L: x^2+y^2+(1-x-y)^2=1\).
记\begin{equation*}
	D = \Set{ (x,y) \given x^2+y^2+(1-x-y)^2\leq1 }
	= \Set{ (x,y) \given x^2+y^2+xy-x-y\leq0 },
\end{equation*}
由\hyperref[equation:线积分与面积分.格林公式]{格林公式}有\begin{equation*}
%@Mathematica: -3 Integrate[Boole[x^2 + y^2 + (1 - x - y)^2 <= 1], {x, -2, 2}, {y, -2, 2}]
	\oint_L (y-x) \dd{x} + (1-2x-y) \dd{y}
	= \iint_D (-2-1) \dd{x}\dd{y}
	= -3 \iint_D \dd{x}\dd{y}.
\end{equation*}
令\(x = u+v,
y = u-v\)，
得\begin{equation*}
	\iint_D \dd{x}\dd{y}
	= \iint_{D'} \abs{\begin{vmatrix}
		1 & 1 \\
		1 & -1
	\end{vmatrix}} \dd{u}\dd{v}
	= 2 \iint_{D'} \dd{u}\dd{v},
\end{equation*}
其中\(D': \frac{(u-\frac13)^3}{1/9}+\frac{v^2}{1/3}\leq1\)，
于是\begin{equation*}
	\iint_{D'} \dd{u}\dd{v}
	= \frac\pi{3\sqrt3},
\end{equation*}
那么\begin{equation*}
	\oint_\Gamma y \dd{x} + z \dd{y} + x \dd{z}
	= -\frac{2\pi}{\sqrt3}.
\end{equation*}
\end{solution}
\end{example}

\subsection{平面上曲线积分与路径无关的条件}
在物理学中（特别是在力学中）要研究所谓“势场”，
就是要研究场力所作的功与路径无关的情形.
在什么条件下场力所作的功与路径无关？
这个问题在数学上就是要研究曲线积分与路径无关的条件.
为了研究这个问题，先要明确什么叫做“曲线积分\(\int_L P\dd{x}+Q\dd{y}\)与路径无关”.
\begin{definition}
设\(G\)是一个区域，\(P(x,y)\)以及\(Q(x,y)\)在区域\(G\)内具有一阶连续偏导数.
如果对于\(G\)内任意指定的两个点\(A\)、\(B\)
以及\(G\)内从点\(A\)到点\(B\)的任意两条曲线\(L_1\)、\(L_2\)，
等式\[
	\int_{L_1} P\dd{x}+Q\dd{y}
	=\int_{L_2} P\dd{x}+Q\dd{y}
\]恒成立，
就说“曲线积分\(\int_L P\dd{x}+Q\dd{y}\)在\(G\)内与路径无关”
或“沿\(G\)内任意闭曲线\(C\)的曲线积分\(\oint_C P\dd{x}+Q\dd{y}\)等于零”，
否则便说“曲线积分\(\int_L P\dd{x}+Q\dd{y}\)在\(G\)内与路径相关”.
\end{definition}

\begin{theorem}\label{theorem:线积分与面积分.平面上曲线积分与路径无关的充分必要条件}
%@see: 《高等数学（第六版 下册）》 P206 定理2
设区域\(G\)是一个单连通区域，
函数\(P(x,y)\)、\(Q(x,y)\)在\(G\)内具有一阶连续偏导数，
那么曲线积分\(\int_L P\dd{x}+Q\dd{y}\)在\(G\)内
与路径无关（或沿\(G\)内任意闭曲线的曲线积分为零）的充分必要条件是：\[
	\pdv{P}{y}=\pdv{Q}{x}
\]在\(G\)内恒成立.
%TODO proof
\end{theorem}

如果\cref{theorem:线积分与面积分.平面上曲线积分与路径无关的充分必要条件}
所要求的两个条件“区域\(G\)是单连通区域，
且函数\(P(x,y)\)和\(Q(x,y)\)在\(G\)内具有一阶连续偏导数”不能同时满足，
那么定理的结论不能保证成立.

例如当区域\(G\)中出现破坏函数\(P\)、\(Q\)
及\(Q'_x\)、\(P'_y\)连续性条件的\DefineConcept{奇点}时，
定理的结论就不能保证成立.

\subsection{二元函数的全微分求积}
\begin{theorem}\label{theorem:线积分与面积分.二元函数的全微分的存在条件}
%@see: 《高等数学（第六版 下册）》 P208 定理3
设区域\(G\)是一个单连通区域.
函数\(P(x,y)\)、\(Q(x,y)\)在\(G\)内具有一阶连续偏导数.
则\(P(x,y)\dd{x}+Q(x,y)\dd{y}\)在\(G\)内为某个二元实值函数\(u(x,y)\)的全微分的充分必要条件是\[
	\pdv{P}{y}=\pdv{Q}{x}
\]在\(G\)内恒成立.
\end{theorem}

根据\cref{theorem:线积分与面积分.平面上曲线积分与路径无关的充分必要条件,theorem:线积分与面积分.二元函数的全微分的存在条件}，
立即可得如下推论.
\begin{corollary}
%@see: 《高等数学（第六版 下册）》 P209 推论
设区域\(G\)是一个单连通区域.
函数\(P(x,y)\)、\(Q(x,y)\)在\(G\)内具有一阶连续偏导数.
则曲线积分\(\int_L P\dd{x}+Q\dd{y}\)在\(G\)内与路径无关的充分必要条件是：
在\(G\)内存在函数\(u(x,y)\)，
使\(\dd{u}=P\dd{x}+Q\dd{y}\).
\end{corollary}

\subsection{曲线积分的基本定理}
\begin{definition}
若曲线积分\(\int_L \VectorInnerProductDot{\vb{F}}{\dd{\vb{r}}}\)在区域\(G\)内与积分路径无关，
则称向量场\(\vb{F}\)为\DefineConcept{保守场}.
\end{definition}

下面的定理给出了平面曲线积分与路径无关的另一种形式的条件，
并为计算保守场中的曲线积分提供了一种简便的方法.
\begin{theorem}[曲线积分的基本定理]\label{theorem:线积分与面积分.曲线积分的基本定理}
设\(\vb{F}(x,y)=P(x,y)\vb{i}+Q(x,y)\vb{j}\)是平面区域\(G\)内的一个向量场，
\(P(x,y)\)、\(Q(x,y)\)都在\(G\)内连续，
且存在一个数量函数\(f(x,y)\)，使得\(\vb{F}=\grad f\)，
则曲线积分\(\int_L \VectorInnerProductDot{\vb{F}}{\dd{\vb{r}}}\)在\(G\)内与路径无关，且
\begin{equation}\label{equation:线积分与面积分.曲线积分的基本公式}
	\int_L \VectorInnerProductDot{\vb{F}}{\dd{\vb{r}}}
	= f(B)-f(A),
\end{equation}
其中\(L\)是位于\(G\)内起点为\(A\)、终点为\(B\)的任一分段光滑曲线.
\end{theorem}

\cref{theorem:线积分与面积分.曲线积分的基本定理} 表明，
对于势场\(\vb{F}\)，
曲线积分\(\int_L \VectorInnerProductDot{\vb{F}}{\dd{\vb{r}}}\)的值仅依赖于它的势函数\(f\)在路径\(L\)的两端点的值，
而不依赖于两点间的路径，
即积分\(\int_L \VectorInnerProductDot{\vb{F}}{\dd{\vb{r}}}\)在\(G\)内与路径无关.
也就是说：势场是保守场.

\cref{equation:线积分与面积分.曲线积分的基本公式}
是与微积分基本公式\[
	\int_a^b f(x) \dd{x}
	= F(b) - F(a)
\]
（其中\(F'(x) = f(x)\)）完全类似的向量微积分的相应公式，
称为\DefineConcept{曲线积分的基本公式}.
