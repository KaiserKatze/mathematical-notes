\section{多元复合函数的求导法则}
\subsection{一元函数与多元函数复合的情形}
\begin{theorem}
如果一元函数\(u=\phi(t)\)及\(v=\psi(t)\)都在点\(t\)可导，
二元函数\(z=f(u,v)\)在对应点\((u,v)\)具有连续偏导数，
则复合得到的一元函数\[
	z = z(t) = f[\phi(t),\psi(t)]
\]
在点\(t\)可导，且有\[
	\dv{z}{t} = \pdv{z}{u}\dv{u}{t} + \pdv{z}{v}\dv{v}{t}.
\]
像这样的导数\(\dv{z}{t}\)称为\DefineConcept{全导数}.
\begin{proof}
\def\D#1#2{\frac{\increment #1}{\increment #2}}
设\(t\)获得增量\(\increment t\)，
这时\(u=\phi(t)\)和\(v=\psi(t)\)的对应增量为\(\increment u\)、\(\increment v\)，
由此函数\(z=f(u,v)\)相应地获得增量\(\increment z\).
按假定，函数\(z=f(u,v)\)在点\((u,v)\)具有连续偏导数，
这时函数的全增量\(\increment z\)可以表示为
\[
	\increment z
	= \left(\pdv{z}{u} + \epsilon_1\right) \increment u
	+ \left(\pdv{z}{v} + \epsilon_2\right) \increment v,
\]
这里，当\(\increment u\to0\)，\(\increment v\to0\)时，
\(\epsilon_1\to0\)，\(\epsilon_2\to0\).

将上式两边各除以\(\increment t\)，得\[
	\D{u}{t}
	= \left(\pdv{z}{u} + \epsilon_1\right) \D{u}{t}
	+ \left(\pdv{z}{v} + \epsilon_2\right) \D{v}{t}.
\]
当\(\increment t\to0\)时，
\(\increment u\to0\)，
\(\increment v\to0\)，
\(\D{u}{t} \to \dv{t}{t}\)，
\(\D{v}{t} \to \dv{v}{t}\)，
所以\[
	\dv{z}{t} = \lim_{\increment t\to0}{\D{z}{t}}
	= \pdv{z}{u} \dv{u}{t} + \pdv{z}{v} \dv{v}{t}.
	\qedhere
\]
\end{proof}
\end{theorem}
用同样的方法，可把上述定理推广到复合函数的中间变量多于两个的情形.
例如，设三元函数\(z=f(u,v,w)\)
与一元函数\(u=\phi(t)\)、\(v=\psi(t)\)、\(w=\omega(t)\)复合得到的一元函数\[
	z = z(t) = f[\phi(t),\psi(t),\omega(t)],
\]
则在与上述定理相类似的条件下，
这复合函数在点\(t\)可导，
且有\[
	\dv{z}{t} = \pdv{z}{u}\dv{u}{t} + \pdv{z}{v}\dv{v}{t} + \pdv{z}{w}\dv{w}{t}.
\]

\subsection{多元函数与多元函数复合的情形}
\begin{theorem}
如果二元函数\(u=\phi(x,y)\)及\(v=\psi(x,y)\)都在点\((x,y)\)具有对\(x\)及对\(y\)的偏导数，
二元函数\(z=f(u,v)\)在对应点\((u,v)\)具有连续偏导数，
则复合得到的二元函数\(z=f[\phi(x,y),\psi(x,y)]\)在点\((x,y)\)的两个偏导数都存在，
且有\[
	\pdv{z}{x} = \pdv{z}{u}\pdv{u}{x} + \pdv{z}{v}\pdv{v}{x},
\]\[
	\pdv{z}{y} = \pdv{z}{u}\pdv{u}{y} + \pdv{z}{v}\pdv{v}{y}.
\]
\end{theorem}
类似地，设\(u=\phi(x,y)\)、\(v=\psi(x,y)\)及\(w=\omega(x,y)\)
都在点\((x,y)\)具有对\(x\)及对\(y\)的偏导数，
函数\(z=f(u,v,w)\)在对应点\((u,v,w)\)具有连续偏导数，
则复合函数\[
	z = f[\phi(x,y),\psi(x,y),\omega(x,y)]
\]
在点\((x,y)\)的两个偏导数都存在，且可用下列公式计算：\[
	\pdv{z}{x} = \pdv{z}{u}\pdv{u}{x} + \pdv{z}{v}\pdv{v}{x} + \pdv{z}{w}\pdv{w}{x},
\]\[
	\pdv{z}{y} = \pdv{z}{u}\pdv{u}{y} + \pdv{z}{v}\pdv{v}{y} + \pdv{z}{w}\pdv{w}{y}.
\]

\subsection{其他情形}
\begin{theorem}
如果函数\(u=\phi(x,y)\)在点\((x,y)\)具有对\(x\)及对\(y\)的偏导数，
函数\(v=\psi(y)\)在点\(y\)可导，
函数\(z=f(u,v)\)在对应点\((u,v)\)具有连续偏导数，
则复合函数\[
	z = f[\phi(x,y),\psi(y)]
\]
在点\((x,y)\)的两个偏导数都存在，且有\[
	\pdv{z}{x} = \pdv{z}{u} \pdv{u}{x},
\]\[
	\pdv{z}{y} = \pdv{z}{u} \pdv{u}{y} + \pdv{z}{v} \dv{v}{y}.
\]
\end{theorem}
上述情形实际上是情形2的一种特例，即在情形2中，如变量\(v\)与\(x\)无关，
从而\(\pdv{v}{x}=0\)；在\(v\)对\(y\)求导时，
由于\(v=\psi(y)\)是一元函数，
故\(\pdv{v}{y}\)换成了\(\dv{v}{y}\)，
这就得上述结果.

在情形3中，还会遇到这样的情形：复合函数的某些中间变量本身又是复合函数的自变量.
例如，设\(z = f(u,x,y)\)具有连续偏导数，而\(u=\phi(x,y)\)具有偏导数，则复合函数\[
z = z(x,y) = f[\phi(x,y),x,y]
\]可看做情形2中当\(v=x\)、\(w=y\)的特殊情形.因此\[
	\pdv{v}{x} = 1, \qquad
	\pdv{w}{x} = 0, \qquad
	\pdv{v}{y} = 0, \qquad
	\pdv{w}{y} = 1.
\]
从而复合函数\(z = f[\phi(x,y),x,y]\)具有对自变量\(x\)及\(y\)的偏导数，且有\[
	\pdv{z}{x} = \pdv{f}{u} \pdv{u}{x} + \pdv{f}{x},
	\qquad
	\pdv{z}{y} = \pdv{f}{u} \pdv{u}{y} + \pdv{f}{y}.
\]
注意：这里\(\pdv{z}{x}\)和\(\pdv{f}{x}\)是不同的.
\(\pdv{z}{x}\)是把复合函数\(z = f[\phi(x,y),x,y]\)中的\(y\)看做不变而对\(x\)的偏导数，
\(\pdv{f}{x}\)是把\(f(u,x,y)\)中的\(u\)及\(y\)看做不变而对\(x\)的偏导数.
\(\pdv{z}{y}\)和\(\pdv{f}{y}\)也有类似的区别.
有时候为了更准确地区分上述两个概念，按中间变量在外层函数的顺序从1开始编号：\[
	\pdv{f}{u} = f_1', \qquad
	\pdv{f}{v} = f_2', \qquad
	\pdv{f}{w} = f_3'.
\]

\begin{example}
设\(w = f(x+y+z,xyz)\)，
\(f\)具有二阶连续偏导数，
求\(\pdv{w}{x}\)及\(\pdv[2]{w}{x}{z}\).
\begin{solution}
记\(u = x+y+z\)，\(v = xyz\)，则\(w = f(u,v)\).
那么根据复合函数求导法则，
有\[
	\pdv{w}{x} = \pdv{f}{u} \pdv{u}{x} + \pdv{f}{v} \pdv{v}{x}
	= \pdv{f}{u} + yz \pdv{f}{v},
\]\[
	\pdv[2]{w}{x}{z} = \pdv{z}(\pdv{f}{u} + yz \pdv{f}{v})
	= \pdv[2]{f}{u}{z} + y\pdv{f}{v} + yz \pdv[2]{f}{v}{z}.
\]
又因为\[
	\pdv[2]{f}{u}{z}
	= \pdv{u}(\pdv{f}{u}) \pdv{u}{z} + \pdv{v}(\pdv{f}{u}) \pdv{v}{z}
	= \pdv[2]{f}{u} + xy \pdv[2]{f}{u}{v},
\]\[
	\pdv[2]{f}{v}{z}
	= \pdv{u}(\pdv{f}{v}) \pdv{u}{z} + \pdv{v}(\pdv{f}{v}) \pdv{v}{z}
	= \pdv[2]{f}{v}{u} + xy \pdv[2]{f}{v},
\]
于是\begin{align*}
	\pdv[2]{w}{x}{z}
	&= \pdv[2]{f}{u} + xy \pdv[2]{f}{u}{v}
	+ y\pdv{f}{v} + yz \left( \pdv[2]{f}{v}{u} + xy \pdv[2]{f}{v} \right) \\
	&= \pdv[2]{f}{u}
	+ xy \pdv[2]{f}{u}{v} + yz \pdv[2]{f}{v}{u}
	+ x y^2 z \pdv[2]{f}{v}
	+ y \pdv{f}{v} \\
	&= \pdv[2]{f}{u}
	+ y(x+z) \pdv[2]{f}{u}{v}
	+ x y^2 z \pdv[2]{f}{v}
	+ y \pdv{f}{v}.
\end{align*}
\end{solution}
\end{example}

\subsection{全微分形式不变性}
\begin{theorem}[全微分形式不变性]
设函数\(z=f(u,v)\)具有连续偏导数，则有全微分\[
	\dd{z}=\pdv{z}{u}\dd{u}+\pdv{z}{v}\dd{v}.
\]

如果\(u\)、\(v\)又是中间变量，
即\(u=\phi(x,y)\)、\(v=\psi(x,y)\)，
且这两个函数也具有连续偏导数，
则复合函数\(z=f[\phi(x,y),\psi(x,y)]=g(x,y)\)的全微分为\[
	\dd{z}=\pdv{z}{x}\dd{x}+\pdv{z}{y}\dd{y}.
\]
又由\begin{gather*}
	\pdv{z}{x} = \pdv{z}{u}\pdv{u}{x} + \pdv{z}{v}\pdv{v}{x}, \\
	\pdv{z}{y} = \pdv{z}{u}\pdv{u}{y} + \pdv{z}{v}\pdv{v}{y},
\end{gather*}
可知\begin{align*}
	\dd{z}
	&=\left(\pdv{z}{u}\pdv{u}{x} + \pdv{z}{v}\pdv{v}{x}\right)\dd{x}
	+\left(\pdv{z}{u}\pdv{u}{y} + \pdv{z}{v}\pdv{v}{y}\right)\dd{y} \\
	&=\pdv{z}{u}\left(\pdv{u}{x}\dd{x}+\pdv{u}{y}\dd{y}\right)
	+\pdv{z}{v}\left(\pdv{v}{x}\dd{x}+\pdv{v}{y}\dd{y}\right) \\
	&=\pdv{z}{u}\dd{u}+\pdv{z}{v}\dd{v}.
\end{align*}
\end{theorem}
由此可见，无论\(u\)和\(v\)是自变量还是中间变量，
函数\(z=f(u,v)\)的全微分形式是一样的.
这个性质叫做\DefineConcept{全微分形式不变性}.

\begin{example}
若函数\(f(x,y)\)满足对任意\(t>0\)有\(f(tx,ty) = t^n f(x,y)\)，
则称\(f(x,y)\)是\(n\)次\DefineConcept{齐次函数}.
证明：若\(f(x,y)\)可微，
则\(f(x,y)\)是\(n\)次齐次函数的充分必要条件是\begin{equation*}
	x \pdv{f}{x} + y \pdv{f}{y} = n f(x,y).
\end{equation*}
\begin{proof}
必要性.
假设\(f(x,y)\)是\(n\)次齐次函数，
那么只要把\(x,y,n\)看作常数，
然后在等式\(f(tx,ty) = t^n f(x,y)\)
等号两边分别对\(t\)求导，
就有\begin{equation*}
	x f'_1(tx,ty) + y f'_2(tx,ty)
	= n t^{n-1} f(x,y).
\end{equation*}
令\(t=1\)得\(x f'_1(x,y) + y f'_2(x,y) = n f(x,y)\).

充分性.
假设\(x f'_1(x,y) + y f'_2(x,y) = n f(x,y)\)，
用\(tx\)代\(x\)，用\(ty\)代\(y\)，得\begin{equation*}
	t x f'_1(tx,ty) + t y f'_2(tx,ty) = n f(tx,ty).
	\eqno(1)
\end{equation*}
记\(F(t) = \frac{f(tx,ty)}{t^n}\)，
把\(x,y,n\)看作常数，
对\(t\)求导，
得\begin{equation*}
	F'(t)
	= \frac{x f'_1(tx,ty) + y f'_2(tx,ty)}{t^n}
	- \frac{n f(tx,ty)}{t^{n+1}}
	% 通分
	= \frac{t x f'_1(tx,ty) + t y f'_2(tx,ty) - n f(tx,ty)}{t^{n+1}}.
\end{equation*}
在上式中代入(1)式，可知\(F'(t) = 0\)，
也就是说\(F\)是常数函数，
对于任意\(t>0\)，
总成立\(F(t) \equiv F(1) = f(x,y)\)，
即\(f(tx,ty) = t^n f(x,y)\).
\end{proof}
\end{example}
