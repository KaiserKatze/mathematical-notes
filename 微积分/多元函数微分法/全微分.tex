\section{全微分}
\subsection{全微分的定义}
\begin{definition}
%@see: 《数学分析（第二版 下册）》（陈纪修） P139 定义12.1.3
设开集\(D \subseteq \mathbb{R}^2\)，
函数\(f\colon D\to\mathbb{R}\)，
点\((x,y) \in D\)，
如果存在只与点\((x,y)\)有关而与\(\increment x,\increment y\)无关的常数\(A\)和\(B\)，
使得函数在点\((x,y)\)的全增量\begin{equation*}
	\increment z = f(x + \increment x,y + \increment y) - f(x,y)
\end{equation*}可表示为\begin{equation*}
	\increment z = A \increment x + B \increment y + o(\rho),
\end{equation*}
其中\(\rho=\sqrt{(\increment x)^2+(\increment y)^2}\)，
则称“函数\(f\)在点\((x,y)\)~\DefineConcept{可微}”；
把\(A \increment x + B \increment y\)称为
“函数\(f\)在点\((x,y)\)的\DefineConcept{全微分}”，
记作\(\dd{z}(x,y)\)，
即\begin{equation*}
	\dd{z}(x,y)
	\defeq
	A \increment x + B \increment y.
\end{equation*}
\end{definition}
% \begin{remark}
% 可以把\(\dd{z}\)视作
% 向量\((A,B)\)与\((\increment x,\increment y)\)的内积，
% 视\(\rho\)为向量\((\increment x,\increment y)\)的模.
% \end{remark}
\begin{definition}
如果函数\(f\)在区域\(D\)内的每一个点可微，
那么称“函数\(f\)在\(D\)内\DefineConcept{可微}”.
\end{definition}

\begin{theorem}[必要条件1]
%@see: 《数学分析（第二版 下册）》（陈纪修） P140
如果函数\(f\)在点\((x,y)\)可微，那么函数\(f\)在点\((x,y)\)必定连续.
\end{theorem}
\begin{remark}
多元函数在某点连续是在该点可微的必要不充分条件.
例如，函数\begin{equation*}
	f(x,y) = \sqrt{x^2+y^2}
\end{equation*}在点\((0,0)\)连续，
但是它在点\((0,0)\)不可偏导，更不可微.
\end{remark}

\begin{theorem}[必要条件2]\label{theorem:多元函数微分法.二元函数可微的必要条件}
%@see: 《数学分析（第二版 下册）》（陈纪修） P140
如果函数\(f\)在点\((x,y)\)可微，
则该函数在点\((x,y)\)的偏导数\(\pdv{z}{x}\)、\(\pdv{z}{y}\)必定存在，
且函数\(f\)在点\((x,y)\)的全微分为\begin{equation*}
	\dd{z} = \pdv{z}{x} \increment x + \pdv{z}{y} \increment y.
\end{equation*}
\end{theorem}

\begin{theorem}\label{theorem:多元函数微分法.二元函数可微的充分必要条件}
如果函数\(f\)在点\((x,y)\)具有偏导数\(f'_x(x,y)\)和\(f'_y(x,y)\)，
且满足\begin{equation*}
	\lim_{(\increment x,\increment y)\to(0,0)}
	\frac{
		[f(x+\increment x,y+\increment y)-f(x,y)]
		-[f'_x(x,y) \increment x + f'_y(x,y) \increment y]
	}{
		\sqrt{(\increment x)^2+(\increment y)^2}
	} = 0,
\end{equation*}那么它就在该点可微.
\end{theorem}

我们知道，一元函数在某点的导数存在是微分存在的充分必要条件.
但对于多元函数来说，情形就不同了.
当函数的各偏导数都存在时，
虽然能形式地写出\(\pdv{z}{x} \increment x + \pdv{z}{y} \increment y\)，
但它与\(\increment z\)之差并不一定是较\(\rho\)高阶的无穷小，
因此它不一定是函数的全微分.
换句话说，各偏导数的存在只是全微分存在的必要条件而不是充分条件.
例如，函数\begin{equation*}
	f(x,y) = \left\{ \begin{array}{cl}
		\frac{xy}{\sqrt{x^2+y^2}}, & (x,y)\neq(0,0), \\
		0, & (x,y)=(0,0)
	\end{array} \right.
\end{equation*}在点\((0,0)\)可偏导，
且有\(f'_x(0,0) = f'_y(0,0) = 0\)，
所以\begin{equation*}
	\increment z - [f'_x(0,0) \cdot \increment x + f'_y(0,0) \cdot \increment y]
	= \frac{\increment x \cdot \increment y}{\sqrt{(\increment x)^2+(\increment y)^2}},
\end{equation*}
如果考虑点\(P'(\increment x,\increment y)\)沿着直线\(y=x\)趋于\((0,0)\)，
则\begin{equation*}
	\frac{1}{\rho} \frac{\increment x \cdot \increment y}{\sqrt{(\increment x)^2+(\increment y)^2}}
	= \frac{\increment x \cdot \increment y}{(\increment x)^2+(\increment y)^2}
	= \frac{(\increment x)^2}{2(\increment x)^2}
	= \frac{1}{2},
\end{equation*}
它不能随\(\rho\to0\)而趋于\(0\)，这表示\(\rho\to0\)时，\begin{equation*}
	\increment z - [f'_x(0,0) \cdot \increment x + f'_y(0,0) \cdot \increment y]
\end{equation*}并不是较\(\rho\)高阶的无穷小，
因此函数在点\((0,0)\)处的全微分并不存在，
即函数在点\((0,0)\)处是不可微的.

\begin{theorem}[充分条件]\label{theorem:多元函数微分法.二元函数可微的充分条件}
%@see: 《数学分析（第二版 下册）》（陈纪修） P142 定理12.1.2
如果函数\(f\)在点\((x,y)\)的某个邻域上存在偏导数，并且偏导数在点\((x,y)\)连续，
则函数在点\((x,y)\)可微.
\begin{proof}
首先有\begin{align*}
	&\hspace{-20pt}
	f(x+h,y+k) - f(x,y) \\
	&= [f(x+h,y+k) - f(x,y+k)] + [f(x,y+k) - f(x,y)] \\
	&= f'_x(x+\theta_1 h,y+k)~h + f'_y(x,y+\theta_2 k)~k,
	\tag{\hyperref[theorem:微分中值定理.拉格朗日中值定理]{拉格朗日中值定理}}
\end{align*}
其中\(0<\theta_1<1,0<\theta_2<1\).
因为\(f'_x\)和\(f'_y\)都在点\((x,y)\)连续，
所以\begin{gather*}
	f'_x(x+\theta_1 h,y+k) = f'_x(x,y) + o(1), \qquad
	f'_y(x,y+\theta_2 k) = f'_y(x,y) + o(1),
\end{gather*}
其中\(o(1)\)表示当\(\rho=\sqrt{h^2+k^2}\to0\)时的无穷小.
于是\begin{align*}
	&\hspace{-20pt}
	f(x+h,y+k) - f(x,y) \\
	&= f'_x(x,y)~h + f'_y(x,y)~k + o(1)~h + o(1)~k \\
	&= f'_x(x,y)~h + f'_y(x,y)~k + o(\rho),
\end{align*}
即\(f\)在点\((x,y)\)可微.
\end{proof}
\end{theorem}
\begin{remark}
%@see: https://www.bilibili.com/video/BV16UtHeoEE7/
函数\(f\)满足\begin{equation*}
	\lim_{x\to0} f'_x(x,0) = f'_x(0,0)
	\quad\text{和}\quad
	\lim_{y\to0} f'_y(0,y) = f'_y(0,0)
\end{equation*}
不能说明\(f\)的偏导数在点\((x,y)\)连续.

这是因为\(f\)的偏导数在点\((x,y)\)连续
当且仅当\begin{equation*}
	\lim_{(x,y)\to(0,0)} f'_x(x,y) = f'_x(0,0)
	\quad\text{且}\quad
	\lim_{(x,y)\to(0,0)} f'_y(x,y) = f'_y(0,0).
\end{equation*}
实际上，只要取\begin{equation*}
	f(x,y) = \left\{ \begin{array}{cl}
		1, & xy = 0, \\
		0, & xy \neq 0,
	\end{array} \right.
\end{equation*}
可见\(f(x,0) = f(0,y) = 1\)，从而\(f'_x(x,0) = f'_y(0,y) = 0\)，
但是\(f\)在点\((0,0)\)不连续更不可微.

再则取\begin{equation*}
	g(x,y) = \left\{ \begin{array}{cl}
		(x^2+y^2) \sin\frac1{x^2+y^2}, & (x,y)\neq(0,0), \\
		0, & (x,y)=(0,0),
	\end{array} \right.
\end{equation*}
因为\begin{equation*}
	\abs{(x^2+y^2) \sin\frac1{x^2+y^2} - A x - B y}
	\leq x^2 + y^2 + \abs{A x + B y},
\end{equation*}
而且只要\(A = B = 0\)就有\(x^2 + y^2 + \abs{A x + B y} = o(\sqrt{x^2 + y^2})\)，
所以\(g\)在点\((0,0)\)可微.
但是\begin{equation*}
	g'_x(0,0) = \lim_{x\to0} \frac{g(x,0) - g(0,0)}{x - 0} = 0,
\end{equation*}
而由\begin{equation*}
	g(x,0) = \left\{ \begin{array}{cl}
		x^2 \sin\frac1{x^2}, & x\neq0, \\
		0, & x=0,
	\end{array} \right.
\end{equation*}可得\(g'_x(x,0) = 2x \sin\frac1{x^2} - \frac2x \cos\frac1{x^2}\)，
从而有\(\lim_{x\to0} g'_x(x,0)\)不存在.
\end{remark}

\begin{example}
%@see: https://www.bilibili.com/video/BV12vtHeiEmc/
%@see: https://www.bilibili.com/video/BV1R3z2YbEsq/
证明：函数\(f\)满足\begin{equation*}
	\lim_{(x,y)\to(0,0)} \frac{f(x,y) - f(0,0)}{\sqrt{x^2+y^2}} = 0
\end{equation*}是“\(f\)在点\((0,0)\)可微”的充分不必要条件.
\begin{proof}
%@credit: {5f4d2f8a-fc8b-4798-85d6-98670f6761e7},{358680b2-838d-49a8-861b-c25fa42d35c9}
先证充分性.
令\(g(x,y) = f(x,y) - f(0,0)\)，显然\(g(0,0) = 0\).
只要证明函数\(g\)在点\((0,0)\)可微，就能证明函数\(f\)也在点\((0,0)\)可微.
由定义可知函数\(g\)在点\((0,0)\)可微，
当且仅当存在与\(x,y\)无关的常数\(A,B\)，
使得\begin{equation*}
	g(x,y) = A x + B y + o(\sqrt{x^2+y^2}).
	\eqno(1)
\end{equation*}
由题可知\(\lim_{(x,y)\to(0,0)} \frac{g(x,y)}{\sqrt{x^2+y^2}} = 0\)，
从而有\begin{equation*}
	g(x,y) = o(\sqrt{x^2+y^2}).
	\eqno(2)
\end{equation*}
比较(1)(2)两式可知\(A = B = 0\)取值与\(x,y\)无关，
因此\(g\)在点\((0,0)\)可微，\(f\)也在点\((0,0)\)可微.

再举例证伪必要性.
取\(f(x,y) = x\).
显然\(f\)在点\((0,0)\)可微，
但是极限\begin{equation*}
	\lim_{(x,y)\to(0,0)} \frac{f(x,y) - f(0,0)}{\sqrt{x^2+y^2}}
	= \lim_{(x,y)\to(0,0)} \frac{x - 0}{\sqrt{x^2+y^2}}
\end{equation*}不存在.
\end{proof}
\end{example}
\begin{remark}
对于非零有限常数\(a\)，
“\(\lim_{(x,y)\to(0,0)} \frac{f(x,y) - f(0,0)}{\sqrt{x^2+y^2}} = a\)”
是“\(f\)在点\((0,0)\)不可微”的充分不必要条件.
\end{remark}
\begin{remark}
当\(f'_x(0,0) = f'_y(0,0) = 0\)时，
“\(\lim_{(x,y)\to(0,0)} \frac{f(x,y) - f(0,0)}{\sqrt{x^2+y^2}} = 0\)”
是“\(f\)在点\((0,0)\)可微”的充分必要条件.
\end{remark}

\begin{example}
%@see: https://www.bilibili.com/video/BV1DEz2Y9Emn/
设函数\begin{equation*}
	f(x,y) = \left\{ \begin{array}{cl}
		\frac{(x+y) \sqrt{\abs{xy}}}{\sqrt{x^2+y^2}}, & (x,y)\neq(0,0), \\
		0, & (x,y)=(0,0).
	\end{array} \right.
\end{equation*}
考察函数\(f\)在点\((0,0)\)的连续性、可偏导性、可微性.
\begin{solution}
因为\(\frac{\abs{x}}{\sqrt{x^2+y^2}} \leq 1,
\frac{\abs{y}}{\sqrt{x^2+y^2}} \leq 1\)，
当\((x,y)\to(0,0)\)时，
有\(\abs{\frac{(x+y) \sqrt{\abs{xy}}}{\sqrt{x^2+y^2}}}
\leq 2 \sqrt{\abs{xy}}
\to 0\)，
所以\(f\)在点\((0,0)\)连续.

因为\(f'_x(0,0) = \dv{x} f(x,0) = 0,
f'_y(0,0) = \dv{y} f(0,y) = 0\)，
所以\(f\)在点\((0,0)\)对\(x\)和\(y\)均可偏导.

%\cref{theorem:多元函数微分法.二元函数可微的充分必要条件}
令\(g(x,y) = \frac{(x+y) \sqrt{\abs{xy}}}{x^2+y^2}\).
因为极限\(\lim_{\substack{(x,y)\to(0,0) \\ y=x}} g(x,y)
= \lim_{x\to0} \frac{2x \abs{x}}{2x^2}
= \lim_{x\to0} \frac{\abs{x}}{x}\)不存在，
所以\(f\)在点\((0,0)\)不可微.
\end{solution}
\end{example}

\begin{example}
%@see: 《2020年全国硕士研究生入学统一考试（数学一）》一选择题/第3题
设函数\(f\)在点\((0,0)\)可微，
\(f(0,0) = 0\)，
曲面\(z = f(x,y)\)在点\((0,0,0)\)的法向量为\(\vb{n} = \eval{(f'_x,f'_y,-1)}_{(0,0)}\).
证明：极限\begin{math}
	\lim_{(x,y)\to(0,0)} \frac{\abs{\vb{n} \cdot (x,y,f(x,y))}}{\sqrt{x^2+y^2}}
\end{math}存在.
\begin{proof}
由可微性的定义有\begin{equation*}
	% 全增量与全微分的差是\(\rho\)的高阶无穷小
	\lim_{(x,y)\to(0,0)} \frac{
		f(x,y) - f(0,0)
		- f'_x(0,0) x
		- f'_y(0,0) y
	}{
		\sqrt{x^2+y^2}
	}
	= 0,
\end{equation*}
所以\begin{align*}
	\lim_{(x,y)\to(0,0)} \frac{\abs{\vb{n} \cdot (x,y,f(x,y))}}{\sqrt{x^2+y^2}}
	&= \lim_{(x,y)\to(0,0)} \frac{
		\abs{
			\eval{(f'_x,f'_y,-1)}_{(0,0)}
			\cdot
			(x,y,f(x,y))
		}
	}{
		\sqrt{x^2+y^2}
	} \\
	&= \lim_{(x,y)\to(0,0)} \frac{
		\abs{
			f'_x(0,0) x + f'_y(0,0) y - f(x,y)
		}
	}{
		\sqrt{x^2+y^2}
	}
	= 0.
	\qedhere
\end{align*}
\end{proof}
\end{example}

以上关于二元函数全微分的定义及可微的必要条件和充分条件，
可以完全类似地推广到三元和三元以上的多元函数.

习惯上，我们将自变量的增量\(\increment x\)、\(\increment y\)
分别记作\(\dd{x}\)、\(\dd{y}\)，
并分别称为自变量\(x\)、\(y\)的微分.
这样，函数\(f\)的全微分就可写为\begin{equation*}
	\dd{z}=\pdv{z}{x}\dd{x}+\pdv{z}{y}\dd{y}.
\end{equation*}

通常把“二元函数的全微分等于它的两个偏微分之和”这件事
称为二元函数的微分符合\DefineConcept{叠加原理}.

叠加原理也适用于二元以上的函数的情形.
例如，如果三元函数\(u = f(x,y,z)\)可微，那么它的全微分就等于它的三个偏微分之和，
即\begin{equation*}
	\dd{u} = \pdv{u}{x} \dd{x} + \pdv{u}{y} \dd{y} + \pdv{u}{z} \dd{z}.
\end{equation*}

\subsection{全微分在近似计算中的应用}
由二元函数的全微分的定义及关于全微分存在的充分条件可知，
当二元函数\(z = f(x,y)\)在点\(P(x,y)\)的两个偏导数\(f'_x(x,y),f'_y(x,y)\)连续，
并且\(\abs{\increment x},\abs{\increment y}\)都较小时，
就有近似等式\begin{equation*}
	\increment z \approx \dd{z} = f'_x(x,y) \increment x + f'_y(x,y) \increment y.
\end{equation*}
上式也可以写成\begin{equation*}
	f(x+\increment x,y+\increment y) \approx f(x,y) + f'_x(x,y) \increment x + f'_y(x,y) \increment y.
\end{equation*}

\begin{example}
计算\((1.04)^{2.02}\)的近似值.
\begin{solution}
设函数\(f(x,y) = x^y\).
显然，要计算的值就是函数在\(x=1.04,y=2.02\)时的函数值\(f(1.04,2.02)\).
取\(x=1,y=2,\increment x=0.04,\increment y=0.02\).由于\begin{equation*}
	f(1,2)=1,
\end{equation*}\begin{equation*}
	f'_x(x,y) = y x^{y-1}, \qquad f'_y(x,y) = x^y \ln x,
\end{equation*}\begin{equation*}
	f'_x(1,2) = 2, \qquad f'_y(1,2) = 0,
\end{equation*}
所以，有\begin{equation*}
	(1.04)^{2.02} \approx 1 + 2 \times 0.04 + 0 \times 0.02 = 1.08.
\end{equation*}
\end{solution}
\end{example}
