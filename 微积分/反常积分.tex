\chapter{反常积分}
有一些实际问题中，常会遇到积分区间为无穷区间\((-\infty,+\infty)\)，
或者被积函数为无界函数的积分，它们已经不属于前面所说的定积分了.
因此，我们对定积分作如下两种推广，从而形成反常积分（或广义积分）的概念.
相对地，原本的定积分又称作常义积分.

\section{无穷限的反常积分}
反常积分（improper integral）
可以分为“无穷限的反常积分”和“无界函数的反常积分”两大类，
本节讨论第一类反常积分，
即积分区间无界的积分.

\subsection{无穷限的反常积分的概念}
\begin{definition}\label{definition:定积分.无穷限的反常积分的定义1}
设函数\(f\colon[a,+\infty)\to\mathbb{R}\)
对\(\forall b\in(a,+\infty)\)都有\(f \in R[a,b]\).

如果极限\[
	\lim_{t \to +\infty} \int_a^t f(x) \dd{x}
\]存在且有限，
那么把这个极限称为
“函数\(f(x)\)在无穷区间\([a,+\infty)\)上的\DefineConcept{反常积分}”，
记作\[
	\int_a^{+\infty} f(x) \dd{x}.
\]
这时也称“反常积分\(\int_a^{+\infty} f(x) \dd{x}\) \DefineConcept{收敛}”，
或称“函数\(f\)在\([a,+\infty)\)上\DefineConcept{可积}”，
记作\(f \in R[a,+\infty)\).

如果上述极限不存在，
则称“反常积分\(\int_a^{+\infty} f(x) \dd{x}\) \DefineConcept{发散}”.
\end{definition}

类似地，可以定义反常积分\[
	\int_{-\infty}^b f(x) \dd{x}
	\defeq
	\lim_{t \to -\infty} \int_t^b f(x) \dd{x}.
\]

\begin{definition}\label{definition:定积分.无穷限的反常积分的定义3}
设函数\(f\colon\mathbb{R}\to\mathbb{R}\)
在\((-\infty,+\infty)\)内的任意有界闭区间上都是可积的.

任取\(a\in\mathbb{R}\)，
如果反常积分\[
	\int_{-\infty}^a f(x) \dd{x}
	\quad\text{和}\quad
	\int_a^{+\infty} f(x) \dd{x}
\]都收敛，
那么称“反常积分\(\int_{-\infty}^{+\infty} f(x) \dd{x}\) \DefineConcept{收敛}”，
并且规定\[
	\int_{-\infty}^{+\infty} f(x) \dd{x}
	\defeq
	\int_{-\infty}^a f(x) \dd{x} + \int_a^{+\infty} f(x) \dd{x},
\]
将其称作“函数\(f(x)\)在无穷区间\((-\infty,\infty)\)上的\DefineConcept{反常积分}”.

反之，如果反常积分\[
	\int_{-\infty}^a f(x) \dd{x}, \qquad
	\int_a^{+\infty} f(x) \dd{x}
\]中至少有一个发散，
那么称“反常积分\(\int_{-\infty}^{+\infty} f(x) \dd{x}\) \DefineConcept{发散}”.
\end{definition}

容易证明，\cref{definition:定积分.无穷限的反常积分的定义3} 实际上与点\(a\)的选取毫无关系.

\cref{definition:定积分.无穷限的反常积分的定义1,%
definition:定积分.无穷限的反常积分的定义3}
定义的反常积分统称为\DefineConcept{无穷限的反常积分}%
或\DefineConcept{第一类反常积分}.

\subsection{无穷限的反常积分的计算法}
由上述定义及牛顿--莱布尼茨公式，可得如下结果.
\begin{theorem}\label{theorem:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分}
如果函数\(f\)在\([a,+\infty)\)上可积，
且函数\(F\)为\(f\)在\([a,+\infty)\)上的一个原函数，
那么\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分1}
	\int_a^{+\infty} f(x) \dd{x}
	= F(+\infty) - F(a).
\end{equation}
%%其中\(F(+\infty) \defeq \lim_{x\to+\infty} F(x)\).
%FIX: 删去“其中...”，原因是我们已经在[函数的极限](definition:极限.函数极限的定义5)处定义过了.

如果函数\(f\)在\((-\infty,a]\)上可积，
且函数\(F\)为\(f\)在\((-\infty,a]\)上的一个原函数，
那么\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分2}
	\int_{-\infty}^a f(x) \dd{x}
	= F(a) - F(-\infty).
\end{equation}
%%其中\(F(-\infty) \defeq \lim_{x\to-\infty} F(x)\).
%FIX: 删去“其中...”，原因是我们已经在[函数的极限](definition:极限.函数极限的定义5)处定义过了.

如果函数\(f\)在\((-\infty,-\infty)\)上可积，
且函数\(F\)为\(f\)在\((-\infty,-\infty)\)上的一个原函数，
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分3}
	\int_{-\infty}^{+\infty} f(x) \dd{x}
	= F(+\infty) - F(-\infty).
\end{equation}
\begin{proof}
先证\cref{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分1}，
根据定义，\begin{align*}
	\int_a^{+\infty} f(x) \dd{x}
	&= \lim_{b\to+\infty} \int_a^b f(x) \dd{x}
	= \lim_{b\to+\infty} (F(b) - F(a)) \\
	&= \lim_{b\to+\infty} F(b) - F(a)
	= F(+\infty) - F(a).
\end{align*}

同理可证\cref{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分2,equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分3}.
\end{proof}
\end{theorem}

\begin{example}
计算反常积分\(\int_{-\infty}^{+\infty} \frac{\dd{x}}{1+x^2}\).
\begin{solution}
因为\(\arctan x\)是\(\frac{1}{1+x^2}\)的一个原函数，
所以\begin{align*}
	\int_{-\infty}^{+\infty} \frac{\dd{x}}{1+x^2}
	&= [\arctan x]_{-\infty}^{+\infty} \\
	&= \lim_{x\to+\infty} \arctan x
		-\lim_{x\to-\infty} \arctan x \\
	&= \frac{\pi}{2} - \left(-\frac{\pi}{2}\right)
	= \pi.
\end{align*}
\end{solution}
\end{example}

\begin{example}
计算反常积分\(\int_0^{+\infty} t e^{-pt} \dd{t}\)，
其中\(p\)是常数，且\(p>0\).
\begin{solution}
由题有\begin{align*}
	\int_0^{+\infty} t e^{-pt} \dd{t}
	&= \left[ \int t e^{-pt} \dd{t} \right]_0^{+\infty}
	= -\frac{1}{p} \int_0^{+\infty} t \dd(e^{-pt}) \\
	&= -\frac{1}{p} \left[
			\left( t e^{-pt} \right)_0^{+\infty}
			- \int_0^{+\infty} e^{-pt} \dd{t}
		\right].
\end{align*}
因为\[
	\lim_{t\to0} t e^{-pt} = 0, \qquad
	\lim_{t\to+\infty} t e^{-pt}
	= \lim_{t\to+\infty} \frac{1}{e^{pt}}
	= 0,
\]
所以\[
	\left( t e^{-pt} \right)_0^{+\infty}
	= 0.
\]
又因为\[
	\int_0^{+\infty} e^{-pt} \dd{t}
	= -\frac{1}{p} \int_0^{+\infty} \dd(e^{-pt})
	= -\frac{1}{p} \eval{e^{-pt}}_0^{+\infty},
\]
其中\[
	\lim_{t\to0} e^{-pt} = 1, \qquad
	\lim_{t\to+\infty} e^{-pt} = 0,
\]
所以\[
	\int_0^{+\infty} e^{-pt} \dd{t}
	= \frac{1}{p}.
\]
因此，\[
	\int_0^{+\infty} t e^{-pt} \dd{t}
	= -\frac{1}{p} \left(
			0 - \frac{1}{p}
		\right)
	= \frac{1}{p^2}.
\]
\end{solution}
\end{example}

\subsection{\texorpdfstring{\(p\)}{p}积分}
\begin{proposition}[\(p\)积分]\label{example:定积分.p积分}
反常积分\[
\int_a^{+\infty} \frac{\dd{x}}{x^p} \quad(a>0)
\]
当\(p > 1\)时收敛；
当\(p \leq 1\)时发散.
\begin{proof}
当\(p=1\)时，\[
	\int_a^{+\infty} \frac{\dd{x}}{x^p}
	= \int_a^{+\infty} \frac{\dd{x}}{x}
	= \eval{\ln x}_a^{+\infty}
	= +\infty;
\]

当\(p\neq1\)时，\[
	\frac{\dd{x}}{x^p}
	= \frac{1}{1-p} \dd(x^{1-p}).
\]
于是，当\(p<1\)时，
因为\(\int_a^{+\infty} \frac{\dd{x}}{x^p}
= +\infty\)；
当\(p>1\)时，
\(\int_a^{+\infty} \frac{\dd{x}}{x^p}
= \frac{a^{1-p}}{p-1}\).

综上，当\(p > 1\)时，这反常积分收敛于\(\frac{a^{1-p}}{p-1}\)；
当\(p\leq1\)时，这反常积分发散.
\end{proof}
\end{proposition}

\begin{example}
证明：反常积分\[
	\int_2^{+\infty} \frac{1}{x \ln^p x} \dd{x}
\]
当\(p>1\)时收敛，当\(p\leq1\)时发散.
\begin{proof}
应用换元法，令\(t = \ln x\)，
则\(t \to \ln2\ (x\to2)\)，\(t \to +\infty\ (x\to+\infty)\)，
\[
	\int_2^{+\infty} \frac{1}{x \ln^p x} \dd{x}
	= \int_{\ln2}^{+\infty} \frac{\dd{t}}{t^p};
\]
与\hyperref[example:定积分.p积分]{\(p\)积分}作比较即知，
反常积分\(\int_2^{+\infty} \frac{1}{x \ln^p x} \dd{x}\)%
当\(p>1\)时收敛，当\(p\leq1\)时发散.
\end{proof}
\end{example}

\begin{example}
\def\l{\lim_{x\to+\infty}}%
设\(f(x)\)在任意有限区间可积，
且\(\l f(x) = A\).
证明：\(\l \frac{1}{x} \int_0^x f(t) \dd{t} = A\).
\begin{proof}
因为\[
	\frac{1}{x} \int_0^x A \dd{t} = A,
\]
所以，要证\(\l \frac{1}{x} \int_0^x f(t) \dd{t} = A\)，
只需证\[
	\l \frac{1}{x} \int_0^x [f(t) - A] \dd{t} = 0,
\]
即证对\(\forall\epsilon>0,
\exists X>0\)有
\[
	x>X
	\implies
	\abs{\frac{1}{x} \int_0^x [f(t) - A] \dd{t} - 0} < \epsilon.
	\eqno(1)
\]

当\(x>0\)时，
由\cref{theorem:定积分.定积分性质5推论2} 有，
\begin{align*}
	\abs{\frac{1}{x} \int_0^x [f(t) - A] \dd{t}}
	&\leq
		\frac{1}{x} \int_0^x \abs{f(t) - A} \dd{t} \\
	&=
		\frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t}
		+ \frac{1}{x} \int_X^x \abs{f(t) - A} \dd{t}.
	\tag2
\end{align*}
因为\(\int_0^X \abs{f(t) - A} \dd{t}\)是一个与\(x\)无关的常数，
所以\(\l \frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t} = 0\)，
也就是说，对\(\forall\epsilon>0,
\exists Y>0\)有
\[
	x>Y
	\implies
	\abs{\frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t} - 0}
	= \frac{1}{x} \int_0^X \abs{f(t) - A} \dd{t}
	< \frac{\epsilon}{2}.
	\eqno(3)
\]
由\(\l f(x) = A\)，故对\(\forall\epsilon>0,
\exists Z>0\)有
\[
	x>Z
	\implies
	\abs{f(x) - A} < \frac{\epsilon}{2}
	\implies
	\frac{1}{x} \int_X^x \abs{f(t) - A} \dd{t}
	< \frac{1}{x} \cdot (x-X) \cdot \frac{\epsilon}{2}.
	\eqno(4)
\]
因此，由(2)、(3)、(4)式可知，
对\(\forall \epsilon>0\)，
当\(x > \max\{Y,Z\}\)时，
有
\[
	\abs{\frac{1}{x} \int_0^x [f(t) - A] \dd{t}}
	< \frac{\epsilon}{2} + \frac{1}{x} \cdot (x-X) \cdot \frac{\epsilon}{2}
	= \frac{\epsilon}{2} \left( 2 - \frac{X}{x} \right)
	< \epsilon.
\]
于是，只要取\(X = \max\{Y,Z\}\)，
就有(1)式成立.
\end{proof}
\end{example}

\section{无界函数的反常积分}
本节我们讨论第二类反常积分 --- “无界函数的反常积分”.

先看一个具体的例子.
表达式\[
	\int_0^1 \frac{\dd{x}}{\sqrt{x}}
\]在黎曼积分的意义下是没有意义的，
因为被积函数\(\frac{1}{\sqrt{x}}\)在\(0\)的右邻域无界，
于是我们把点\(x=0\)称为这个积分的“瑕点”.
但是，对于\(\forall\epsilon\in(0,1)\)，积分\[
	\int_\epsilon^1 \frac{\dd{x}}{\sqrt{x}}
\]是有意义的，
它是一个带有变动下限\(\epsilon\)的积分.
由于极限\[
	\lim_{\epsilon\to0^+} \int_\epsilon^1 \frac{\dd{x}}{\sqrt{x}}
	= \lim_{\epsilon\to0^+} 2\sqrt{x}\eval_\epsilon^1
	= 2 \lim_{\epsilon\to0^+} (1-\sqrt\epsilon)
	= 2
\]存在且有限，
我们就定义\[
	\int_0^1 \frac{\dd{x}}{\sqrt{x}}=2.
\]

\subsection{无界函数的反常积分的概念}
\begin{definition}\label{definition:定积分.无界函数的反常积分的定义1}
设函数\(f\colon(a,b]\to\mathbb{R}\)满足\[
	\lim_{x \to a^+} f(x) = \infty;
\]
但是对于\(\forall\epsilon\in(0,b-a)\)，
函数\(f\)在\([a+\epsilon,b]\)上可积.

如果极限\[
	\lim_{\epsilon\to0^+} \int_{a+\epsilon}^b f(x) \dd{x}
\]存在且有限，
那么把这个极限称为“函数\(f(x)\)在\((a,b]\)上的\DefineConcept{广义积分}”，
记作\(\int_a^b f(x) \dd{x}\)；
我们还称“反常积分\(\int_a^b f(x) \dd{x}\) \DefineConcept{收敛}”；
另外，我们把点\(a\)称为“反常积分\(\int_a^b f(x) \dd{x}\)的\DefineConcept{瑕点}”.

否则，称“反常积分\(\int_a^b f(x) \dd{x}\) \DefineConcept{发散}”.
\end{definition}

类似地，当\(b\)是瑕点时，
我们也可以定义反常积分\[
	\int_a^b f(x) \dd{x}
	\defeq
	\lim_{\epsilon\to0^+} \int_a^{b-\epsilon} f(x) \dd{x}.
\]
当\(a\)和\(b\)都是瑕点时，
那么任取一点\(c\in(a,b)\)，我们定义\begin{align*}
	\int_a^b f(x) \dd{x}
	&\defeq
	\int_a^c f(x) \dd{x}
	+ \int_c^b f(x) \dd{x} \\
	&= \lim_{\epsilon\to0^+} \int_{a+\epsilon}^c f(x) \dd{x}
	+ \lim_{\epsilon\to0^+} \int_c^{b-\epsilon} f(x) \dd{x}.
\end{align*}
当开区间\((a,b)\)内一点\(d\)是瑕点时，
我们定义\begin{align*}
	\int_a^b f(x) \dd{x}
	&\defeq \int_a^d f(x) \dd{x}
		+ \int_d^b f(x) \dd{x} \\
	&= \lim_{\epsilon\to0^+} \int_a^{d-\epsilon} f(x) \dd{x}
		+ \lim_{\epsilon\to0^+} \int_{d+\epsilon}^b f(x) \dd{x}.
\end{align*}

\subsection{无界函数的反常积分的计算法}
计算无界函数的反常积分，也可借助于牛顿--莱布尼茨公式.
\begin{theorem}\label{theorem:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1}
设函数\(f \in C(a,b]\)，点\(a\)是\(f\)的瑕点，
函数\(F\)是\(f\)在区间\((a,b]\)上的一个原函数.
若极限\(F(a^+) \equiv \lim_{x \to a^+} F(x)\)存在，
则有
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1'}
\int_a^b f(x) \dd{x}
= F(b) - F(a^+);
\end{equation}
若极限\(F(a^+)\)不存在，则反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{theorem}
我们仍用记号\([F(x)]_a^b\)来表示\(F(b) - F(a^+)\)，
这样就可以简化\cref{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1'}，
从而形式上仍有
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1}
\int_a^b f(x) \dd{x} = [F(x)]_a^b.
\end{equation}

对于\(f\)在\([a,b)\)上连续、\(b\)为瑕点的反常积分，也有类似的计算公式.
这里不再详述.

\begin{theorem}\label{theorem:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2}
设函数\(f \in C[a,b]\)，点\(c\in(a,b)\)是\(f\)的瑕点，
函数\(F\)是\(f\)在区间\((a,b]\)上的一个原函数.
若极限\(F(c^+),F(c^-)\)都存在，
则有
\begin{equation}\label{equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2}
\int_a^b f(x) \dd{x}
= [F(b) - F(c^+)] + [F(c^-) - F(a)];
\end{equation}
否则，反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{theorem}
在\cref{theorem:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2} 中，
由于\(F(c^+)\)与\(F(c^-)\)不一定相等（例如，点\(c\)可能是函数\(F\)的跳跃间断点），
所以\[
\int_a^b f(x) \dd{x}
\neq [F(x)]_a^b = F(b) - F(a).
\]

\begin{example}
计算反常积分\[
\int_0^a \frac{\dd{x}}{\sqrt{a^2-x^2}}\quad(a>0).
\]
\begin{solution}
因为\[
\lim_{x \to a^-} \frac{1}{\sqrt{a^2-x^2}} = +\infty,
\]所以点\(a\)是瑕点，于是\[
\int_0^a \frac{\dd{x}}{\sqrt{a^2-x^2}}
= \left[ \arcsin\frac{x}{a} \right]_0^a
= \lim_{x \to a^-} \arcsin\frac{x}{a} - 0 = \frac{\pi}{2}.
\]
\end{solution}
\end{example}

\begin{example}
讨论反常积分\(\int_{-1}^1 \frac{\dd{x}}{x^2}\)的收敛性.
\begin{solution}
被积函数\(f(x) = \frac{1}{x^2}\)在积分区间\([-1,1]\)上除\(x=0\)外连续，且\[
\lim_{x\to0} \frac{1}{x^2} = +\infty.
\]

由于\[
\int_{-1}^0 \frac{\dd{x}}{x^2}
= \left[-\frac{1}{x}\right]_{-1}^0
= \lim_{x\to0^-} \left(-\frac{1}{x}\right) - 1
= +\infty,
\]即反常积分\(\int_{-1}^0 \frac{\dd{x}}{x^2}\)发散，所以反常积分\(\int_{-1}^1 \frac{\dd{x}}{x^2}\)发散.
\end{solution}

需要注意的是，如果疏忽了\(x=0\)是被积函数的瑕点，就可能得到以下错误结果：\[
\int_{-1}^1 \frac{\dd{x}}{x^2}
= \left[ -\frac{1}{x} \right]_{-1}^1
= -1 - 1 = -2.
\]
\end{example}

\subsection{\texorpdfstring{\(q\)}{q}积分}
\begin{proposition}[\(q\)积分]\label{example:定积分.q积分}
反常积分\[
	\int_a^b \frac{\dd{x}}{(x-a)^q}
	\quad(a \neq b)
\]
当\(0 < q < 1\)时收敛；
当\(q \geq 1\)时发散.
\begin{proof}
当\(q=1\)时，\[
	\int_a^b \frac{\dd{x}}{(x-a)^q}
	= \int_a^b \frac{\dd{x}}{x-a}
	= \eval{\ln(x-a)}_a^b
	= \ln(b-a) - \lim_{x \to a^+} \ln(x-a)
	= +\infty.
\]

当\(q\neq1\)时，\[
	\frac{\dd{x}}{(x-a)^q}
	= \frac{1}{1-q} \dd((x-a)^{1-q}),
\]
于是，当\(0<q<1\)时，
\(\int_a^b \frac{\dd{x}}{(x-a)^q}
= \frac{(b-a)^{1-q}}{1-q}\)；
当\(q>1\)时，
\(\int_a^b \frac{\dd{x}}{(x-a)^q}
= +\infty\).

综上，当\(0<q<1\)时，这反常积分收敛于\(\frac{(b-a)^{1-q}}{1-q}\)；
当\(q\geq1\)时，这反常积分发散.
\end{proof}
\end{proposition}

如果收敛的反常积分\(\int_a^b f(x) \dd{x}\)的%
被积函数\(f \in C(a,b)\)（\(a\)可以是\(-\infty\)，
\(b\)可以是\(+\infty\)，\(a\)、\(b\)也可以是\(f(x)\)的瑕点），
且应用的换元函数在\((a,b)\)内单调增加（或减少），
那么可以像定积分一样换元.

\begin{example}
求反常积分\(\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}\).
\begin{solution}
这里，积分上限为\(+\infty\)，且下限\(x=0\)为被积函数的瑕点.

令\(\sqrt{x} = t\)，
则\(x = t^2\)，
\(x\to0^+\)时\(t\to0\)，
\(x\to+\infty\)时\(t\to+\infty\).
于是\[
	\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}
	= \int_0^{+\infty} \frac{2t\dd{t}}{t(t^2+1)^{\frac32}}
	= 2 \int_0^{+\infty} \frac{\dd{t}}{(t^2+1)^{\frac32}}.
\]
再令\(t = \tan u\)，
则\(u = \arctan t\)，
\(t=0\)时\(u=0\)，
\(t\to+\infty\)时，
\(u\to\frac\pi2\).
于是\[
	\int_0^{+\infty} \frac{\dd{x}}{\sqrt{x(x+1)^3}}
	= 2 \int_0^{\frac\pi2} \frac{\sec^2 u \dd{u}}{\sec^3 u}
	= 2 \int_0^{\frac\pi2} \cos u \dd{u}
	= 2.
\]
\end{solution}
本例如用变换\(t = \frac{1}{x}\)或\(t = \frac{1}{x+1}\)，计算会更简单些.
\end{example}

\section{反常积分的审敛法}
反常积分的收敛性，可以通过求被积函数的原函数，然后按定义取极限，根据极限的存在与否来判定.
但在本节中，我们可以建立不通过被积函数的原函数判定反常积分收敛性的判定法.

\subsection{无穷限反常积分的审敛法}
\begin{theorem}\label{theorem:定积分.无穷限反常积分的审敛法引理}
设函数\(f(x)\)在区间\([a,+\infty)\)上连续，且\(f(x) \geq 0\).若函数\[
F(x)=\int_a^x f(t) \dd{t}
\]在\([a,+\infty)\)上有上界，则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛.
\end{theorem}
事实上，因为\(f(x)\geq0\)，
\(F(x)\)在\([a,+\infty)\)上单调增加；
又因为\(F(x)\)在\([a,+\infty)\)上有上界，
故\(F(x)\)在\([a,+\infty)\)上是单调有界的函数.
按照“区间\([a,+\infty)\)上的单调有界函数\(F(x)\)必有极限\(\lim_{x\to+\infty} F(x)\)”的准则，
就可知道极限\[
	\lim_{x\to+\infty} \int_a^x f(t) \dd{t}
\]存在，即反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛.

根据\cref{theorem:定积分.无穷限反常积分的审敛法引理}，
对于非负函数的无穷限的反常积分，有以下的比较审敛原理.
\begin{theorem}[比较审敛原理]\label{theorem:定积分.无穷限反常积分的比较审敛原理}
设函数\(f(x),g(x)\)在区间\([a,+\infty)\)上连续.
\begin{enumerate}
	\item 如果\[
		0 \leq f(x) \leq g(x)
		\quad (a \leq x < +\infty),
	\]并且\(\int_a^{+\infty} g(x) \dd{x}\)收敛，
	则\(\int_a^{+\infty} f(x) \dd{x}\)也收敛.

	\item 如果\[
		0 \leq g(x) \leq f(x)
		\quad (a \leq x < +\infty),
	\]
	并且\(\int_a^{+\infty} g(x) \dd{x}\)发散，
	则\(\int_a^{+\infty} f(x) \dd{x}\)也发散.
\end{enumerate}
\begin{proof}
任意取定\(t \in (a,+\infty)\).

当有\(0 \leq f(x) \leq g(x)\)且\(\int_a^{+\infty} g(x) \dd{x}\)收敛时，
根据\cref{theorem:定积分.定积分性质5推论1}
得\[
	\int_a^t f(x) \dd{x}
	\leq
	\int_a^t g(x) \dd{x}
	\leq
	\int_a^{+\infty} g(x) \dd{x}.
\]
这表明作为积分上限\(t\)的函数\[
	F(t) = \int_a^t f(x) \dd{x}
\]
在区间\([a,+\infty)\)上有上界.
由\cref{theorem:定积分.无穷限反常积分的审敛法引理} 可知，
反常积分\(\int_a^{+\infty} f(x) \dd{x}\)也收敛.
\end{proof}
\end{theorem}

\begin{theorem}[比较审敛法]\label{theorem:定积分.无穷限反常积分的比较审敛法}
设函数\(f(x)\)在区间\([a,+\infty)\ (a>0)\)上连续，且\(f(x) \geq 0\).
如果存在常数\(M>0\)及\(p>1\)，使得\[
f(x) \leq \frac{M}{x^p} \quad (a \leq x < +\infty),
\]则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛；
如果存在常数\(N>0\)，使得\[
f(x) \geq \frac{N}{x} \quad (a \leq x < +\infty),
\]则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)发散.
\end{theorem}

\begin{theorem}[极限审敛法]\label{theorem:定积分.无穷限反常积分的极限审敛法}
设函数\(f(x)\)在区间\([a,+\infty)\)上连续，且\(f(x) \geq 0\).
如果存在常数\(p > 1\)，使得\[
\lim_{x \to +\infty} x^p f(x)
\]存在，则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛；
如果\[
\lim_{x \to +\infty} x f(x) = d \in (0,+\infty],
\]则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)发散.
\end{theorem}

\begin{example}\label{example:定积分.高斯积分的收敛性}
证明：高斯积分\[
\int_0^{+\infty} e^{-x^2} \dd{x}
\]收敛.
\begin{proof}
因为在区间\([0,+\infty)\)上被积函数\(f(x) = e^{-x^2}\)连续且恒大于零，
且极限\[
\lim_{x\to+\infty} x^2 e^{-x^2}
= \lim_{x\to+\infty} \frac{x^2}{e^{x^2}}
\xlongequal{u=x^2} \lim_{u\to+\infty} \frac{u}{e^u}
= \lim_{u\to+\infty} \frac{1}{e^u}
= 0,
\]
那么根据\cref{theorem:定积分.无穷限反常积分的极限审敛法}，
高斯积分\(\int_0^{+\infty} e^{-x^2} \dd{x}\)收敛.
\end{proof}
\end{example}

\begin{theorem}\label{theorem:定积分.绝对收敛的无穷限反常积分必收敛}
设函数\(f(x)\)在区间\([a,+\infty)\)上连续.
如果反常积分\[
\int_a^{+\infty} \abs{f(x)} \dd{x}
\]收敛，则反常积分\[
\int_a^{+\infty} f(x) \dd{x}
\]也收敛.
\end{theorem}
通常称满足上述定理条件的反常积分\(\int_a^{+\infty} f(x) \dd{x}\) \DefineConcept{绝对收敛}.
于是，上述定理可简单地表述为：
绝对收敛的反常积分\(\int_a^{+\infty} f(x) \dd{x}\)必定收敛.

\begin{example}
设反常积分\(\int_1^{+\infty} f^2(x) \dd{x}\)收敛.
证明：反常积分\(\int_1^{+\infty} \frac{f(x)}{x} \dd{x}\)绝对收敛.
\begin{proof}
根据\cref{theorem:不等式.基本不等式2}，
在区间\([1,+\infty)\)上有\[
\abs{\frac{f(x)}{x}}
= \frac{\abs{f(x)}}{x}
\leq \frac{1}{2} \left[
	\abs{f(x)}^2 + \frac{1}{x^2}
\right]
= \frac{1}{2} f^2(x) + \frac{1}{2x^2}
\]成立，且\(\int_1^{+\infty} f^2(x) \dd{x}\)和\(\int_1^{+\infty} \frac{1}{x^2} \dd{x}\)都收敛，
故\(\int_1^{+\infty} \abs{\frac{f(x)}{x}} \dd{x}\)收敛.
\end{proof}
\end{example}

\subsection{无界函数的反常积分的审敛法}
\begin{theorem}[比较审敛法]\label{theorem:定积分.无界函数的反常积分的比较审敛法}
设函数\(f(x)\)在区间\((a,b]\)上连续，且\(f(x) \geq 0\)，\(x=a\)为\(f(x)\)的瑕点.
如果存在常数\(M > 0\)及\(q < 1\)，使得\[
f(x) \leq \frac{M}{(x-a)^q} \quad (a < x \leq b),
\]则反常积分\(\int_a^b f(x) \dd{x}\)收敛；
如果存在常数\(N > 0\)，使得\[
f(x) \geq \frac{N}{x - a} \quad (a < x \leq b),
\]则反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{theorem}

\begin{theorem}[极限审敛法]\label{theorem:定积分.无界函数的反常积分的极限审敛法}
设函数\(f(x)\)在区间\((a,b]\)上连续，且\(f(x) \geq 0\)，\(x=a\)为\(f(x)\)的瑕点.
如果存在常数\(q \in (0,1)\)，使得\[
\lim_{x \to a^+} (x-a)^q f(x)
\]存在，则反常积分\(\int_a^b f(x) \dd{x}\)收敛；
如果\[
\lim_{x \to a^+} (x-a) f(x) = d \in (0,+\infty],
\]则反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{theorem}

\section{面积原理}
\begin{theorem}
设函数\(f\)是在\([m,+\infty)\ (m\in\mathbb{N}^+)\)上非负的单调减少的函数，
则极限\[
	\lim\limits_{n\to\infty} \left(
	\sum\limits_{k=m}^n f(k)
	- \int_m^n f(t) \dd{t}
	\right)
	= \alpha
\]存在，
且\(\alpha\in[0,f(m)]\).
\begin{proof}
记\(g(x)
= \sum\limits_{k=m}^{\floor{x}} f(k)
- \int_m^x f(t) \dd{t}\)，
那么\[
	g(n) - g(n+1)
	= -f(n+1)
	+ \int_n^{n+1} f(t) \dd{t}.
\]
因为\[
	\int_n^{n+1} f(t) \dd{t}
	\geq
	1 \cdot f(n+1),
\]
所以\(g(n) - g(n+1) \geq 0\)，\(\{g(n)\}\)单调性得证.

又因为\begin{align*}
	g(n)
	&= \sum\limits_{k=m}^{n-1} f(k) - \int_m^n f(t) \dd{t} \\
	&= \sum\limits_{k=m}^{n-1} \left[
			f(k) - \int_k^{k+1} f(t) \dd{t}
		\right] + f(n) \\
	&\geq \sum\limits_{k=m}^{n-1} [f(k) - f(k)] + f(n)
	= f(n) \geq 0,
\end{align*}
这就是说\(\{g(n)\}\)是非负的单调减少的数列，
从而\(\{g(n)\}\)有界性得证.

因此，根据单调有界定理，\(\alpha = \lim\limits_{n\to\infty} g(n)\)存在.
又由\(0 \leq g(n) \leq g(m) = f(m)\)
可知\(0 \leq \alpha \leq f(m)\).
\end{proof}
%@see: https://encyclopediaofmath.org/wiki/Area_principle
%@see: https://mathworld.wolfram.com/AreaPrinciple.html
\end{theorem}
\begin{remark}
取\(m=1\)和\(f(x) = \frac1x\)，
立即可得\cref{example:微分中值定理.拉格朗日中值定理.欧拉--马歇罗尼常数} 的结论.
\end{remark}

\section{贝塔函数}
\subsection{贝塔函数的定义}
\begin{definition}
定义\(B\)函数：
\begin{equation}\label{equation:特殊函数.贝塔函数的定义式}
	B(p,q)
	\defeq
	\int_0^1 t^{p-1} (1-t)^{q-1} \dd{t}
	\quad(p,q>0).
\end{equation}
\end{definition}
我们称含参反常积分 \labelcref{equation:特殊函数.贝塔函数的定义式} 为\DefineConcept{欧拉第一型积分}.

\subsection{贝塔函数的性质}
\begin{property}
%@see: 《概率论与数理统计》（茆诗松、周纪芗、张日权） P89
对任意\(p,q>0\)，
贝塔函数\(B\)满足：
\(B(p,q)=B(q,p)\).
\end{property}

\section{伽马函数}
\subsection{伽马函数的历史渊源}
假设函数\(\Gamma\colon\mathbb{R}\to\mathbb{R}\)的值\(\Gamma(n+1)\)%
恰好与\(n\)的阶乘\(n!\)满足相等关系
\[
	\Gamma(n+1)
	= n!
	\equiv 1 \cdot 2 \cdot 3 \dotsm n
	\quad(n\in\mathbb{N}).
	\eqno(1)
\]
又假设函数\(\Gamma\)满足递推公式
\[
	\Gamma(z+1) = z \cdot \Gamma(z)
	\quad(z\in\mathbb{R}),
	\eqno(2)
\]
那么有
\[
	\Gamma(z+n+1)
	= z(z+1)\dotsm(z+n) \cdot \Gamma(z),
\]
即有
\[
	\Gamma(z) = \frac{\Gamma(z+n+1)}{z(z+1)\dotsm(z+n)}.
	\eqno(3)
\]
假设当\(n\to\infty\)时，
\(\Gamma(z+n+1)\)是\((z+n)!\)的等价无穷大，
即
\[
	\lim_{n\to\infty} \frac{(z+n)!}{\Gamma(z+n+1)}
	= \lim_{n\to\infty} \frac{1 \cdot 2 \cdot 3 \dotsm n \cdot (n+1) \dotsm (n+z)}{\Gamma(z+n+1)}
	= 1;
\]
那么对(3)式取极限就有
\begin{align*}
	\Gamma(z)
	\equiv \lim_{n\to\infty} \Gamma(z)
	&= \lim_{n\to\infty}
		\frac{\Gamma(z+n+1)}{z(z+1)\dotsm(z+n)} \\
	&= \lim_{n\to\infty}
		\frac{\Gamma(z+n+1)}{z(z+1)\dotsm(z+n)} \cdot \frac{(z+n)!}{\Gamma(z+n+1)} \\
	&= \lim_{n\to\infty}
		\frac{1 \cdot 2 \cdot 3 \dotsm n}{z(z+1)\dotsm(z+n)} \cdot (n+1) \dotsm (n+z).
	\tag4
\end{align*}
又因为
\[
	\lim_{n\to\infty} \frac{(n+1)(n+2)\dotsm(n+z)}{n^z} = 1,
\]
所以(4)式化为
\begin{equation}\label{equation:特殊函数.伽马函数的极限定义}
	\Gamma(z)
	= \lim_{n\to\infty} \frac{n^z \cdot n!}{z(z+1)\dotsm(z+n)}.
\end{equation}
像这样，我们就得到\(\Gamma\)函数的极限定义.

我们可以验证，根据上述极限定义，有\(\Gamma(1) = 0!\)，即
\[
	\Gamma(1)
	= \lim_{n\to\infty} \frac{n^1 \cdot 1 \cdot 2 \dotsm n}{1 \cdot 2 \dotsm n \cdot (n+1)}
	= \lim_{n\to\infty} \frac{n}{n+1}
	= 1.
\]
而且从
\begin{align*}
	\frac{\Gamma(z+1)}{\Gamma(z)}
	&= \left[ \lim_{n\to\infty} \frac{n^{z+1} \cdot n!}{(z+1)(z+2)\dotsm(z+n+1)} \right] \bigg/ \left[ \lim_{n\to\infty} \frac{n^z \cdot n!}{z(z+1)\dotsm(z+n)} \right] \\
	&= \lim_{n\to\infty} \left[ \frac{n^{z+1} \cdot n!}{(z+1)(z+2)\dotsm(z+n+1)} \bigg/ \frac{n^z \cdot n!}{z(z+1)\dotsm(z+n)} \right] \\
	&= \lim_{n\to\infty} \frac{n \cdot z}{z+n+1}
	= z
\end{align*}
也可以看出，函数\(\Gamma\)也确实满足递推公式(2)，进而也满足阶乘关系(1).

\subsection{伽马函数的收敛性}
现在我们来讨论含参反常积分\[
	\int_0^{+\infty} t^{s-1} e^{-t} \dd{t} \quad(s\in\mathbb{R}^+)
\]的收敛性问题.
这个积分的积分区间为\([0,+\infty)\)，又当\(s-1<0\)时，\(t=0\)是被积函数的瑕点.
为此，分别讨论下列两个积分\[
	I_1 = \int_0^1 t^{s-1} e^{-t} \dd{t},
	\qquad
	I_2 = \int_1^{+\infty} t^{s-1} e^{-t} \dd{t}
\]的收敛性.

当\(s \geq 1\)时，
\(I_1\)是定积分；
当\(0 < s < 1\)时，
因为\[
	t^{s-1} \cdot e^{-t}
	= \frac{1}{t^{1-s}} \cdot \frac{1}{e^t} < \frac{1}{t^{1-s}},
\]
而\(1-s < 1\)，
根据\hyperref[theorem:定积分.无界函数的反常积分的比较审敛法]{无界函数反常积分的比较审敛法}，
反常积分\(I_1\)收敛.

又因为\[
	\lim_{t\to+\infty} t^2 (e^{-t} t^{s-1})
	= \lim_{t\to+\infty} \frac{t^{s+1}}{e^t} = 0,
\]
根据\hyperref[theorem:定积分.无穷限反常积分的极限审敛法]{无穷限反常积分的极限审敛法}，
反常积分\(I_2\)也收敛.

综上所述，反常积分\(\int_0^{+\infty} e^{-t} t^{s-1} \dd{t}\)对\(s > 0\)均收敛.

\subsection{伽马函数的定义}
\begin{definition}
定义\(\Gamma\)函数：
\begin{equation}\label{equation:特殊函数.伽马函数的积分定义}
	\Gamma(s)
	\defeq
	\int_0^{+\infty} t^{s-1} e^{-t} \dd{t}
	\quad(s>0)
\end{equation}
\end{definition}
有时候我们把含参反常积分 \labelcref{equation:特殊函数.伽马函数的积分定义}
称为\DefineConcept{欧拉第二型积分}.

\(\Gamma\)函数的图形如\cref{figure:定积分.伽马函数} 所示.

\begin{figure}%伽马函数
	\centering
	\begin{tikzpicture}
	%@Mathematica: Plot[Gamma[s], {s, 0, 5}, PlotRange -> {0, 6}]
		\begin{axis}[
			xmin=0,xmax=5.1,
			restrict y to domain=-6:6,
			axis lines=middle,
			xlabel=$x$,
			ylabel=$y$,
			enlarge x limits=0.05,
			enlarge y limits=0.1,
			x label style={at={(ticklabel* cs:1.00)}, inner sep=5pt, anchor=north},
			y label style={at={(ticklabel* cs:1.00)}, inner sep=2pt, anchor=south east},
		]
			\addplot[color=blue,samples=222,smooth,domain=0:5]{sqrt(2*pi)*x^(x-0.5)*exp(-x)*exp(1/(12*x))};
		\end{axis}
	\end{tikzpicture}
	\caption{\(\Gamma\)函数的图形}
	\label{figure:定积分.伽马函数}
\end{figure}

特别地，函数\[
	G(s,z) = \int_z^{+\infty} t^{s-1} e^{-t} \dd{t}
\]
称为\DefineConcept{不完全伽马函数}.
函数\[
	G(s,z_0,z_1) = \int_{z_0}^{z_1} t^{s-1} e^{-t} \dd{t}
\]
称为\DefineConcept{广义不完全伽马函数}.

\begin{proposition}
伽马函数的导数为\begin{equation}
	\dv{s} \Gamma(s)
	= \int_0^{+\infty} t^{s-1} e^{-t} \ln t \dd{t}.
\end{equation}
\begin{proof}
由导数的定义有\begin{align*}
	\Gamma'(s)
	&= \lim_{h\to0} \frac{\Gamma(s+h)-\Gamma(s)}{h} \\
	&= \lim_{h\to0} \frac{
			\int_0^{+\infty} t^{(s+h)-1} e^{-t} \dd{t}
			- \int_0^{+\infty} t^{s-1} e^{-t} \dd{t}
		}{h} \\
	&= \lim_{h\to0}
		\int_0^{+\infty} t^{s-1} \frac{t^h - 1}{h} e^{-t} \dd{t} \\
	&= \int_0^{+\infty} t^{s-1} e^{-t} \ln t \dd{t}.
	\qedhere
\end{align*}
\end{proof}
\end{proposition}

\subsection{伽马函数与贝塔函数的关系}
\begin{theorem}
%@see: 《概率论与数理统计》（茆诗松、周纪芗、张日权） P89
对任意的\(a,b>0\)，
有\begin{equation}\label{equation:定积分.伽马函数与贝塔函数的关系}
	B(a,b) = \frac{\Gamma(a) \Gamma(b)}{\Gamma(a+b)}.
\end{equation}
\begin{proof}
由伽马函数的定义可知\begin{align*}
	\Gamma(a) \Gamma(b)
	&= \int_0^{+\infty} \int_0^{+\infty} x^{a-1} y^{b-1} e^{-(x+y)} \dd{x}\dd{y} \\
	&\xlongequal{x=uv,y=u(1-v)}
	\int_0^{+\infty} \int_0^1 (uv)^{a-1} [u(1-v)]^{b-1} e^{-u} u \dd{x}\dd{y} \\
	&=\int_0^{+\infty} u^{a+b-1} e^{-u} \dd{u}
		\int_0^1 v^{a-1} (1-v)^{b-1} \dd{v} \\
	&= \Gamma(a+b) B(a,b).
	\qedhere
\end{align*}
\end{proof}
\end{theorem}

\subsection{伽马函数的性质}
\begin{property}
对于任意\(s > 0\)，总有
\begin{equation}\label{equation:伽马函数.递推公式}
	\Gamma(s+1) = s \Gamma(s).
\end{equation}
\begin{proof}
应用分部积分法，
有\begin{align*}
	\Gamma(s+1)
	&= \int_0^{+\infty} t^s e^{-t} \dd{t} \\
	&= -\int_0^{+\infty} t^s \dd(e^{-t}) \\
	&= \left[-t^s e^{-t}\right]_0^{+\infty}
		+ s \int_0^{+\infty} t^{s-1} e^{-t} \dd{t} \\
	&= s \Gamma(s).
	\qedhere
\end{align*}
\end{proof}
\end{property}

\begin{property}
\(\Gamma(1) = 1\).
\begin{proof}
\(\Gamma(1)
= \int_0^{+\infty} e^{-x} \dd{x}
= \left(-e^{-x}\right)_0^{+\infty}
= 1\).
\end{proof}
\end{property}

\begin{property}
对于\(n\in\mathbb{N}\)，
有\begin{equation}\label{equation:定积分.伽马函数与阶乘的联系}
	\Gamma(n+1) = n!.
\end{equation}
\begin{proof}
对\hyperref[equation:伽马函数.递推公式]{递推公式}运用数学归纳法即可.
\end{proof}
\end{property}

\begin{property}
\(\Gamma(s)\to+\infty\ (s\to0^+)\).
\begin{proof}
因为\[
	\Gamma(s) = \frac{\Gamma(s+1)}{s},
	\qquad
	\Gamma(1) = 1,
\]
所以当\(s\to0^+\)时，
\(\Gamma(s)\to+\infty\).
\end{proof}
\end{property}

\begin{proposition}
\(\Gamma\)函数在\(s > 0\)时连续，且有各阶连续导数.
\end{proposition}

\begin{proposition}
\(\Gamma(s) > 0\ (s>0)\).
\end{proposition}

\begin{property}[余元公式]
\begin{equation}\label{equation:定积分.余元公式}
	\Gamma(s) \cdot \Gamma(1-s)
	= \frac{\pi}{\sin{\pi s}} \quad (0 < s < 1).
\end{equation}
\begin{proof}
由\cref{equation:定积分.伽马函数与贝塔函数的关系} 有\[
	\Gamma(s) \cdot \Gamma(1-s)
	= B(s,1-s)
	= \int_0^1 t^{s-1} (1-t)^{-s} \dd{t}
	= \int_0^1 \frac1t \left(\frac{t}{1-t}\right)^s \dd{t}.
\]
令\(x=\frac{t}{1-t}\)，
则\(t=\frac{x}{1+x}\)，
\(\dd{t}=\frac1{(1+x)^2} \dd{x}\)，
于是\[
	\Gamma(s) \cdot \Gamma(1-s)
	= \int_0^{+\infty} \frac{1+x}{x} \cdot x^s \cdot \frac1{(1+x)^2} \dd{x}
	= \int_0^{+\infty} \frac{x^{s-1}}{1+x} \dd{x}.
\]
记\(I_1 = \int_0^1 \frac{x^{s-1}}{1+x} \dd{x},
I_2 = \int_1^{+\infty} \frac{x^{s-1}}{1+x} \dd{x}\)，
则\(\Gamma(s) \cdot \Gamma(1-s) = I_1 + I_2\).

对于\(I_2 = \int_1^{+\infty} \frac{x^{s-1}}{1+x} \dd{x}\)，
可令\(x = \frac1t\)，
则\(I_2
= \int_0^1 \frac{t^{-s}}{1+t} \dd{t}
= \int_0^1 \frac{x^{-s}}{1+x} \dd{x}\).
于是\begin{align*}
	I_1 + I_2
	&= \int_0^1 \frac{x^{s-1} + x^{-s}}{1+x} \dd{x}
	= \int_0^1 (x^{s-1} + x^{-s}) \sum_{k=0}^\infty (-x)^k \dd{x} \\%FIXME: 这里用到了函数项级数，但是函数项级数在后续章节，尚未介绍！
	&= \int_0^1 \sum_{k=0}^\infty (-1)^k x^{k+s-1} \dd{x}
	+ \int_0^1 \sum_{k=0}^\infty (-1)^k x^{k-s} \dd{x} \\
	&= \sum_{k=0}^\infty \frac{(-1)^k}{k+s}
	+ \sum_{k=0}^\infty \frac{(-1)^k}{k-s+1} \\
	&= \frac1s
	+ \sum_{k=1}^\infty \frac{(-1)^k}{k+s}
	+ \sum_{k=1}^\infty \frac{(-1)^{k-1}}{k-s} \\
	&= \frac1s + \sum_{k=1}^\infty \frac{(-1)^k \cdot 2s}{s^2-k^2}.
\end{align*}

记\(f(x)=\cos(sx)\).
将\(f\)展开，得\[
	\cos(sx) = \frac{a_0}2 + \sum_{n=1}^\infty (a_n \cos(nx) + b_n \sin(nx)),
\]
其中\begin{gather*}
	a_n = \frac1\pi \int_{-\pi}^\pi \cos(sx) \cos(nx) \dd{x}
	= \frac{(-1)^n \cdot 2s \cdot \sin(\pi s)}{\pi(s^2-n^2)}, \\
	b_n = \frac1\pi \int_{-\pi}^\pi \cos(sx) \sin(nx) \dd{x} = 0.
\end{gather*}
于是\[
	\cos(sx) = \frac{\sin(\pi s)}{\pi s}
	+ \sum_{n=1}^\infty \frac{(-1)^n \cdot 2s \cdot \sin(\pi s)}{\pi(s^2-n^2)} \cdot \cos(nx).
\]
令\(x=0\)，
得\(1 = \frac{\sin(\pi s)}{\pi s}
+ \frac{\sin(\pi s)}{\pi} \sum_{n=1}^\infty \frac{(-1)^n \cdot 2s}{s^2-n^2}\)，
即\(\sum_{n=1}^\infty \frac{(-1)^n \cdot 2s}{s^2-n^2} = \frac{\pi}{\sin(\pi s)} - \frac1s\).

由上可知\[
	\Gamma(s) \cdot \Gamma(1-s)
	= \frac{\pi}{\sin(\pi s)}.
	\qedhere
\]
%@see: 【余元公式的证明推导过程】https://www.bilibili.com/video/BV17M4m1m7ZH
\end{proof}
\end{property}

\begin{corollary}
\(\Gamma\left(\frac{1}{2}\right) = \sqrt{\pi}\).
\begin{proof}
在\cref{equation:定积分.余元公式} 中取\(s = \frac12\)即得.
\end{proof}
\end{corollary}

\begin{example}
利用伽马函数计算高斯积分\(\int_0^{+\infty} e^{-u^2} \dd{u}\).
\begin{solution}
在\(\Gamma(s) = \int_0^{+\infty} e^{-x} x^{s-1} \dd{x}\)中，
作代换\(x = u^2\)，
有\begin{equation}\label{equation:定积分.伽马函数.中间步骤1}
	\Gamma(s) = 2 \int_0^{+\infty} e^{-u^2} u^{2s-1} \dd{u}.
\end{equation}
再令\(2s-1 = t\)或\(s = \frac{1+t}{2}\)，
即有\begin{equation}
	\int_0^{+\infty} e^{-u^2} u^t \dd{u}
	= \frac{1}{2} \Gamma\left(\frac{1+t}{2}\right)
	\quad (t > -1).
\end{equation}

在 \labelcref{equation:定积分.伽马函数.中间步骤1} 中，
令\(s=\frac12\)，
得\[
	2\int_0^{+\infty} e^{-u^2} \dd{u}
	= \Gamma\left(\frac{1}{2}\right)
	= \sqrt{\pi},
\]
于是我们算得\cref{example:定积分.高斯积分的收敛性} 中的高斯积分的值为\begin{equation}
	\int_0^{+\infty} e^{-u^2} \dd{u} = \frac{\sqrt{\pi}}{2}.
\end{equation}
\end{solution}
\end{example}

\begin{example}
证明：\begin{equation}
	\int_0^{+\infty} x^{\alpha-1} e^{-\beta x} \dd{x}
	= \frac{\Gamma(\alpha)}{\beta^\alpha}.
\end{equation}
\begin{proof}
直接计算得
\begin{align*}
	\int_0^{+\infty} x^{\alpha-1} e^{-\beta x} \dd{x}
	&\xlongequal{u=\beta x}
		\int_0^{+\infty}
			\left(\frac{u}{\beta}\right)^{\alpha-1}
			e^{-u} \dd\left(\frac{u}{\beta}\right) \\
	&= \frac{1}{\beta^\alpha} \int_0^{+\infty} u^{\alpha-1} e^{-u} \dd{u}
	= \frac{\Gamma(\alpha)}{\beta^\alpha}.
	\qedhere
\end{align*}
\end{proof}
\end{example}

\begin{example}
证明：\[
	\Gamma\left(\frac{2k+1}{2}\right)
	= \sqrt{\pi} \cdot \frac{(2k-1)!!}{2^k},
\]
其中\(k\in\mathbb{N}^+\).
\begin{proof}
由\cref{equation:伽马函数.递推公式} 有\[
	\Gamma\left(\frac{2k+1}{2}\right)
	= \Gamma\left(\frac{2k-1}{2}+1\right)
	= \frac{2k-1}{2} \cdot \Gamma\left(\frac{2k-1}{2}\right),
\]
又因为\(\Gamma\left(\frac12\right) = \sqrt{\pi}\)，
所以\[
	\Gamma\left(\frac{2k+1}{2}\right)
	= \Gamma\left(\frac12\right) \cdot \prod_{i=1}^k \frac{2i-1}{2}
	= \sqrt{\pi} \cdot \frac{(2k-1)!!}{2^k}.
	\qedhere
\]
\end{proof}
\end{example}

\begin{example}
试证：\begin{equation}\label{equation:定积分.伽马函数与双阶乘的联系1}
	(2n)!! = 2^n \cdot \Gamma(n+1).
\end{equation}
\begin{proof}
因为\begin{align*}
	(2n)!!
	&= \prod_{k=1}^n 2k
		\tag{双阶乘的定义} \\
	&= 2^n \cdot \prod_{k=1}^n k \\
	&= 2^n \cdot n!
		\tag{阶乘的定义} \\
	&= 2^n \cdot \Gamma(n+1),
		\tag{\cref{equation:定积分.伽马函数与阶乘的联系}}
\end{align*}
所以\cref{equation:定积分.伽马函数与双阶乘的联系1} 对任意整数\(n\)都成立.
\end{proof}
\end{example}

\begin{example}
试证：\begin{equation}\label{equation:定积分.伽马函数与双阶乘的联系2}
	(2n-1)!! = \frac{\Gamma(2n)}{2^{n-1} \cdot \Gamma(n)}.
\end{equation}
\begin{proof}
由\cref{equation:定积分.伽马函数与阶乘的联系} 有，\[
	(2n)! = \Gamma(2n+1).
\]
又因为\begin{align*}
	(2n)!
	&= \prod_{k=1}^{2n} k \\
	&= \left(\prod_{k=1}^n 2k\right)
		\cdot \left[\prod_{k=1}^n (2k-1)\right] \\
	&= (2k)!! \cdot (2n-1)!!
		\tag{双阶乘的定义} \\
	&= 2^n \cdot \Gamma(n+1) \cdot (2n-1)!!,
		\tag{\cref{equation:定积分.伽马函数与双阶乘的联系1}}
\end{align*}
所以\[
	\Gamma(2n+1)
	= 2^n \cdot \Gamma(n+1) \cdot (2n-1)!!,
\]
因此\[
	(2n-1)!!
	= \frac{\Gamma(2n+1)}{2^n \cdot \Gamma(n+1)}.
\]
也就是说，\cref{equation:定积分.伽马函数与双阶乘的联系2} 对任意整数\(n\)都成立.
\end{proof}
\end{example}

\begin{example}
计算定积分\(\int_0^1 x^m \ln^n x \dd{x}\ (n>-1)\).
\begin{solution}
直接计算得
\begin{align*}
	\int_0^1 x^m \ln^n x \dd{x}
	&\xlongequal{t=\ln x}
	\int_{-\infty}^0 e^{mt} t^n \cdot e^t \dd{t} \\
	&\xlongequal{t=-u}
	\int_{+\infty}^0 e^{-(m+1)u} (-u)^n \cdot (-1) \dd{u} \\
	&\xlongequal{s=(m+1)u}
	\int_0^{+\infty} e^{-s} \left(-\frac{s}{m+1}\right)^n \cdot \frac{1}{m+1} \dd{s} \\
	&=
	\frac{(-1)^n}{(m+1)^{n+1}} \int_0^{+\infty} e^{-s} s^n \dd{s} \\
	&=
	\frac{(-1)^n}{(m+1)^{n+1}} \cdot \Gamma(n+1).
\end{align*}
\end{solution}
\end{example}
我们从这个例子得到以下重要公式
\begin{equation}
	\int_0^1 x^m \ln^n x \dd{x}
	= \frac{(-1)^n}{(m+1)^{n+1}} \cdot \Gamma(n+1)
	\quad(n>-1).
\end{equation}
特别地，有
\begin{equation}
	\int_0^1 \ln^n x \dd{x}
	= (-1)^n \cdot \Gamma(n+1)
	\quad(n>-1).
\end{equation}

\begin{example}
计算极限\(\lim_{n\to\infty} \int_0^{+\infty} e^{-x^n} \dd{x}\).
\begin{solution}
利用换元法，有\begin{align*}
	\int_0^{+\infty} e^{-x^n} \dd{x}
	&\xlongequal{t=x^n}
	\int_0^{+\infty} e^{-t} \cdot \frac{1}{n} t^{\frac{1}{n}-1} \dd{t} \\
	&= \frac{1}{n} \Gamma\left(\frac{1}{n}\right)
	= \Gamma\left(1+\frac{1}{n}\right).
\end{align*}
又因为伽马函数在其定义域上是连续的，所以\[
	\lim_{n\to\infty} \int_0^{+\infty} e^{-x^n} \dd{x}
	= \lim_{n\to\infty} \Gamma\left(1+\frac{1}{n}\right)
	= \Gamma\left(1+\lim_{n\to\infty} \frac{1}{n}\right)
	= \Gamma(1) = 1.
\]
\end{solution}
\end{example}

\subsection{勒让德倍量公式}
\begin{theorem}[勒让德倍量公式]
对于\(\forall n\in\mathbb{N}^+\)，
总有\begin{equation}\label{equation:定积分.勒让德倍量公式}
\sqrt{\pi} \cdot \Gamma(2n)
= 2^{2n-1} \cdot \Gamma(n) \cdot \Gamma\left(n+\frac{1}{2}\right).
\end{equation}
\end{theorem}

\subsection{伽马函数的斯特林近似}
\begin{lemma}\label{theorem:定积分.伽马函数的斯特灵近似.引理1}
%@see: 《数学分析（第3册）》（徐森林） P229 引理15.4.2
%@see: 《数学分析教程（下册）》（史济怀） P392 引理18.4.1
对任意的\(x>0\)，
有不等式\begin{equation}\label{equation:定积分.伽马函数的斯特灵近似.引理1}
	0 < \left(x+\frac{1}{2}\right) \ln(1+\frac{1}{x}) - 1
	< \frac{1}{12}\left(\frac{1}{x}-\frac{1}{x+1}\right).
\end{equation}
\begin{proof}
由于\[
	\ln\frac{1+x}{1-x}
	= 2 \sum_{k=0}^\infty \frac{x^{2k+1}}{2k+1}
	\quad(-1<x<1),
\]
所以\begin{align*}
	\left(x+\frac{1}{2}\right) \ln(1+\frac{1}{x})
	&= \frac{2x+1}{2} \ln\frac{
		1+\frac{1}{2x+1}
	}{
		1-\frac{1}{2x+1}
	} \\
	&= \frac{2x+1}{2} \cdot
	2 \sum_{k=0}^\infty \frac{1}{2k+1} \left(\frac{1}{2x+1}\right)^{2k+1} \\
	&= \sum_{k=0}^\infty \frac{1}{2k+1} \left(\frac{1}{2x+1}\right)^{2k},
\end{align*}
从而\[
	\left(x+\frac{1}{2}\right) \ln(1+\frac{1}{x}) - 1
	= \frac{1}{3} \left(\frac{1}{2x+1}\right)^2
	+ \frac{1}{5} \left(\frac{1}{2x+1}\right)^4
	+ \dotsb.
\]
显然上式（当\(x>0\)时）恒大于零；
另外，上式右边小于\begin{align*}
	&\hspace{-20pt}
	\frac{1}{3} \left(\frac{1}{2x+1}\right)^2 \left[
	1 + \left(\frac{1}{2x+1}\right)^2 + \left(\frac{1}{2x+1}\right)^4 + \dotsb
	\right] \\
	&= \frac{1}{3} \left(\frac{1}{2x+1}\right)^2 \left[
	1 - \left(\frac{1}{2x+1}\right)^2
	\right]^{-1}
	= \frac{1}{3} \frac{1}{4x^2 + 4x}
	= \frac{1}{12} \left(\frac{1}{x} - \frac{1}{x+1}\right).
	\qedhere
\end{align*}
\end{proof}
\end{lemma}

\begin{lemma}\label{theorem:定积分.伽马函数的斯特灵近似.引理2}
%@see: 《数学分析教程（下册）》（史济怀） P393 引理18.4.2
对任意的\(x>0\)，
有\begin{equation}\label{equation:定积分.伽马函数的斯特灵近似.引理2}
	0 < \int_0^{+\infty} \frac{\floor{t} - t + 1/2}{t + x} \dd{x} < \frac{1}{12 x}.
\end{equation}
\begin{proof}
计算得\begin{align*}
	\int_0^{+\infty} \frac{\floor{t} - t + 1/2}{t + x} \dd{x}
	&= \sum_{k=0}^\infty \int_k^{k+1} \frac{k - t + 1/2}{t + x} \dd{t} \\
	&= \sum_{k=0}^\infty \left[
	\left(k + \frac{1}{2} + x\right) \ln(1 + \frac{1}{k + x}) - 1
	\right].
\end{align*}
在 \labelcref{equation:定积分.伽马函数的斯特灵近似.引理1} 中，
用\((k+x)\)代替\(x\)，
则得\begin{align*}
	0 &< \int_0^{+\infty} \frac{\floor{t} - t + 1/2}{t + x} \dd{x} \\
	&< \frac{1}{12} \sum_{k=0}^\infty \left(\frac{1}{k+x}
		- \frac{1}{k+x+1}\right) \\
	&= \frac{1}{12} \left[
		\left(\frac{1}{x} - \frac{1}{x+1}\right)
		+ \left(\frac{1}{x+1} - \frac{1}{x+2}\right) + \dotsb
	\right]
	= \frac{1}{12x}.
	\qedhere
\end{align*}
\end{proof}
\end{lemma}

\begin{lemma}\label{theorem:定积分.伽马函数的斯特灵近似.引理3}
%@see: 《数学分析教程（下册）》（史济怀） P394 引理18.4.3
对任意的\(n\in\mathbb{N}^+\)和\(x>0\)，
有\begin{equation}\label{equation:定积分.伽马函数的斯特灵近似.引理3}
	\begin{split}
		\int_0^n \frac{\floor{t} - t + 1/2}{t + x} \dd{t}
		&= \left(n+x+\frac{1}{2}\right) \ln(n+x) \\
		&\hspace{20pt}
		- \left(\frac{1}{2}+x\right) \ln x
		- \sum_{k=1}^n \ln(k+x) - n.
	\end{split}
\end{equation}
\begin{proof}
直接计算得\begin{align*}
	&\hspace{-5pt}
		\int_0^n \frac{\floor{t} - t + 1/2}{t + x} \dd{t}
		= \sum_{k=0}^{n-1} \int_k^{k+1} \left(
			\frac{k + 1/2 + x}{t + x} - 1
		\right) \dd{t} \\
	&= \sum_{k=0}^{n-1} \left[
			\left(k + \frac{1}{2} + x\right)
			\left(\ln\overline{k+1+x} - \ln\overline{k+x}\right)
			- 1
		\right] \\
	&= \sum_{k=0}^{n-1} \left(k + \frac{1}{2} + x\right) \ln(k+1+x)
		- \sum_{k=0}^{n-1} \left(k + \frac{1}{2} + x\right) \ln(k+x)
		- n \\
	&= \sum_{k=1}^n \left(k - \frac{1}{2} + x\right) \ln(k+x)
		- \sum_{k=0}^{n-1} \left(k + \frac{1}{2} + x\right) \ln(k+x)
		- n \\
	&= \sum_{k=1}^n \left(k + \frac{1}{2} + x\right) \ln(k+x)
		- \sum_{k=1}^n \ln(k+x)
		- \sum_{k=0}^{n-1} \left(k + \frac{1}{2} + x\right) \ln(k+x)
		- n \\
	&= \left(n + \frac{1}{2} + x\right) \ln(n+x)
		- \left(\frac{1}{2} + x\right) \ln x
		- \sum_{k=1}^n \ln(k+x)
		- n.
	\qedhere
\end{align*}
\end{proof}
\end{lemma}

\begin{lemma}\label{theorem:定积分.伽马函数的斯特灵近似.引理4}
%@see: 《数学分析教程（下册）》（史济怀） P395 引理18.4.4
\begin{equation}\label{equation:定积分.伽马函数的斯特灵近似.引理4}
\lim_{n\to\infty} \left[
\ln n! + n - \left(n+\frac{1}{2}\right) \ln n
\right]
= \ln\sqrt{2\pi}.
\end{equation}
\begin{proof}
在斯特林公式\[
\lim_{n\to\infty} \frac{n!}{(n/e)^n \sqrt{2\pi n}} = 1
\]的两边取对数，即得 \labelcref{equation:定积分.伽马函数的斯特灵近似.引理4}.
\end{proof}
\end{lemma}

\begin{theorem}[\(\Gamma\)函数的斯特林近似公式]
%@see: 《数学分析（第3册）》（徐森林） P231 定理15.4.9
%@see: 《数学分析教程（下册）》（史济怀） P392 定理18.4.10
对于任意的\(x>0\)，
存在\(\theta(x)\in(0,1)\)，
使得\begin{equation}\label{equation:定积分.伽马函数的斯特林近似}
	\Gamma(x+1) = \sqrt{2\pi x}
		\left(\frac{x}{e}\right)^x e^{\frac{\theta(x)}{12x}}.
\end{equation}
\begin{proof}
因为\(\Gamma(x+1) = x \Gamma(x)\)，故可证\[
\Gamma(x) = \frac{1}{x} \sqrt{2\pi x} \left(\frac{x}{e}\right)^x e^{\frac{\theta(x)}{12x}},
\]再两边取对数，得\[
\ln \Gamma(x) = \ln\sqrt{2\pi} + \left(x - \frac{1}{2}\right) \ln x - x + \frac{\theta(x)}{12x}.
\]

由等式\[
\ln\frac{n^x n!}{x(x+1)\dotsm(x+n)}
= \ln n! + x \ln n - \sum_{k=0}^n \ln(k+x)
\]和\cref{theorem:定积分.伽马函数的斯特灵近似.引理3}，可得\begin{align*}
&\hspace{-5pt}
\ln\frac{n^x n!}{x(x+1)\dotsm(x+n)}
- \int_0^n \frac{\floor{t} - t + 1/2}{t + x} \dd{t} \\
&= \ln n! + x \ln n - \ln x - \left(n+x+\frac{1}{2}\right) \ln(n+x) + \left(\frac{1}{2}+x\right) \ln x + n \\
&= \ln n! + n + x \ln n - \ln x
- \left(n+x+\frac{1}{2}\right) \left[\ln n + \ln(1+\frac{x}{n})\right]
+ \left(\frac{1}{2}+x\right) \ln x \\
&= \ln n! + n - \left(n+\frac{1}{2}\right) \ln n
- \left(n+x+\frac{1}{2}\right) \ln(1+\frac{x}{n})
+ \left(x-\frac{1}{2}\right) \ln x.
\end{align*}
由\cref{theorem:定积分.伽马函数的斯特灵近似.引理4} 可知，
上式右边的前三项之和当\(n\to\infty\)时趋于\(\ln\sqrt{2\pi}\)，
上式左边的第一项当\(n\to\infty\)时趋于\(\ln\Gamma(x)\)，
而{%
\def\l{\lim_{n\to\infty}}%
\def\xn{\left(1+\frac{x}{n}\right)}%
\begin{align*}
\l \left(n+x+\frac{1}{2}\right) \ln\xn
&= \l \ln\xn^{n+x+\frac{1}{2}} \\
&= \l \ln\xn^n \xn^{x+\frac{1}{2}}
= x.
\end{align*}}
那么只要令\(n\to\infty\)，即得\[
\ln\Gamma(x) - \int_0^{+\infty} \frac{\floor{t} - t + 1/2}{t + x} \dd{t}
= \ln\sqrt{2\pi} - x + \left(x - \frac{1}{2}\right) \ln x.
\]若记\[
\theta(x) = 12 x \int_0^{+\infty} \frac{\floor{t} - t + 1/2}{t + x} \dd{t},
\]则由\cref{theorem:定积分.伽马函数的斯特灵近似.引理3} 可知，必有\(0<\theta(x)<1\)，如此便得要证的 \labelcref{equation:定积分.伽马函数的斯特林近似}.
\end{proof}
\end{theorem}
\begin{remark}
\cref{equation:定积分.伽马函数的斯特林近似} 说明，
\(\Gamma(x+1)\)与\(\sqrt{2\pi x} \left(\frac{x}{e}\right)^x\)是\(x\to+\infty\)时的等价无穷大.
\end{remark}

\begin{corollary}
%@see: 《数学分析教程（下册）》（史济怀） P396 推论18.4.1
对任意的实数\(a\)，
有\begin{equation}\label{equation:反常积分.伽马函数.极限1}
	\lim_{x\to+\infty} \frac{x^a \Gamma(x)}{\Gamma(x+a)} = 1.
\end{equation}
%TODO proof
\end{corollary}

\section{本章总结}

我们在本章学习了无穷限的反常积分和无界函数的反常积分这两类反常积分的基本概念%
（\cref{definition:定积分.无穷限的反常积分的定义1,%
definition:定积分.无穷限的反常积分的定义3%
}，以及\cref{definition:定积分.无界函数的反常积分的定义1}）.
它们是对常义积分的定义的扩展.

我们可以利用莱布尼茨公式
\labelcref{equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分1,%
equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分2,%
equation:定积分.利用牛顿莱布尼茨公式计算无穷限的反常积分3,%
equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分1,%
equation:定积分.利用牛顿莱布尼茨公式计算无界函数的反常积分2%
}
计算反常积分.

\begin{table}[hb]
	\centering
	\begin{tabular}{*3l}
		\hline
		名称 & 表达式 & 敛散条件 \\
		\hline
		{\hyperref[example:定积分.p积分]{p 积分}}
			& \(\int_a^{+\infty} \frac{\dd{x}}{x^p}\ (a>0)\)
			& 当\(p > 1\)时收敛于\(\frac{1}{p-1} a^{1-p}\)；当\(p \leq 1\)时发散. \\[.5cm]
		{\hyperref[example:定积分.q积分]{q 积分}}
			& \(\int_a^b \frac{\dd{x}}{(x-a)^q}\ (a<b)\)
			& 当\(0 < q < 1\)时收敛于\(\frac{1}{1-q} (b-a)^{1-q}\)；当\(q \geq 1\)时发散. \\[.5cm]
		\hline
	\end{tabular}
	\caption{重要反常积分及其敛散条件}
\end{table}

在本章我们还学习了一个特殊函数：
\hyperref[equation:特殊函数.伽马函数的积分定义]{\(\Gamma\)函数}.
