\section{定积分的换元积分法}
由上节结果知道，计算定积分\(\int_a^b f(x) \dd{x}\)的简便方法是
把它转化为求\(f(x)\)的原函数的增量.
在\cref{chapter:不定积分}中，
我们知道用换元积分法和分部积分法可以求出一些函数的原函数.
因此，在一定条件下，可以用换元积分法和分部积分法来计算定积分.
下面就来讨论定积分的这两种计算方法.

为了说明如何用换元法来计算定积分，先证明下面的定理.
\begin{theorem}\label{theorem:定积分.定积分的换元法}
%@see: 《数学分析（第二版 上册）》（陈纪修） P303 定理7.3.4
%@see: 《数学分析教程（第3版 上册）》（史济怀） P258 定理6.4.2
设函数\(f \in C[a,b]\)，
函数\(\phi \in C^1[\alpha,\beta]\)，
\(\ran\phi \subseteq [a,b]\)，
\(\phi(\alpha)=a,
\phi(\beta)=b\)，
则有\begin{equation}\label{equation:定积分.定积分的换元公式}
	\int_a^b f(x) \dd{x} = \int_\alpha^\beta f[\phi(t)] \phi'(t) \dd{t}.
\end{equation}
\begin{proof}
由假设可知，
被积函数\(f(x)\)和\(f[\phi(t)] \phi'(t)\)都是连续的，
因此不仅\cref{equation:定积分.定积分的换元公式} 两边的定积分都存在，
而且由\hyperref[theorem:定积分.原函数存在定理]{原函数存在定理}知道，
被积函数的原函数也都存在.
所以\cref{equation:定积分.定积分的换元公式} 两边的定积分
都可应用\hyperref[equation:定积分.牛顿--莱布尼茨公式]{牛顿--莱布尼茨公式}.
假设\(F(x)\)是\(f(x)\)的一个原函数，则\begin{equation*}
	\int_a^b f(x) \dd{x} = F(b) - F(a).
\end{equation*}
另一方面，记\(\Phi(t) = F[\phi(t)]\)，
它是由\(F(x)\)与\(x=\phi(t)\)复合而成的函数.
由复合函数求导法则，得\begin{equation*}
	\Phi'(t) = \dv{F}{x} \dv{x}{t}
	= f(x) \phi'(t)
	= f[\phi(t)] \phi'(t).
\end{equation*}
这表明\(\Phi(t)\)是\(f[\phi(t)] \phi'(t)\)的一个原函数，
因此有\begin{equation*}
	\int_\alpha^\beta f[\phi(t)] \phi'(t) \dd{t}
	= \Phi(\beta) - \Phi(\alpha).
\end{equation*}
又由\(\Phi(t) = F[\phi(t)]\)，
\(\phi(\alpha) = a\)，
\(\phi(\beta) = b\)，
可得\begin{equation*}
	\Phi(\beta) - \Phi(\alpha)
	= F[\phi(\beta)] - F[\phi(\alpha)]
	= F(b) - F(a).
\end{equation*}
所以\begin{equation*}
	\int_a^b f(x) \dd{x}
	= F(b) - F(a)
	= \Phi(\beta) - \Phi(\alpha)
	= \int_\alpha^\beta f[\phi(t)] \phi'(t) \dd{t}.
	\qedhere
\end{equation*}
\end{proof}
\end{theorem}
在定积分\(\int_a^b f(x) \dd{x}\)中的\(\dd{x}\)，本来是整个定积分记号中不可分割的一部分，但由上述定理可知，在一定条件下，它确实可以作为微分记号来对待.
这就是说，应用换元公式时，如果把\(\int_a^b f(x) \dd{x}\)中的\(x\)换成\(\phi(t)\)，则\(\dd{x}\)就换成\(\phi'(t) \dd{t}\)，这正好是\(x = \phi(t)\)的微分\(\dd{x}\).

应用换元公式时，有两点值得注意：\begin{enumerate}
\item 用\(x = \phi(t)\)把原来变量\(x\)代换成新变量\(t\)时，积分限也要换成相应于新变量\(t\)的积分限；
\item 求出\(f[\phi(t)] \phi'(t)\)的一个原函数\(\Phi(t)\)后，不必像计算不定积分那样再要把\(\Phi(t)\)变换成原来变量\(x\)的函数，而只要把新变量\(t\)的上、下限分别代入\(\Phi(t)\)中然后相减就行了.
\end{enumerate}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P246 例1
计算\(\int_0^a \sqrt{a^2-x^2} \dd{x}\ (a > 0)\).
\begin{solution}
令\(x = a \sin t\ (-\frac\pi2 \leq t \leq \frac\pi2)\)，
则\begin{equation*}
	\dd{x} = a \cos t \dd{t}, \qquad
	\sqrt{a^2-x^2} = a \cos t.
\end{equation*}
当\(x = 0\)时，取\(t = 0\).
当\(x = a\)时，取\(t = \frac{\pi}{2}\).
那么有\begin{equation*}
	\int_0^a \sqrt{a^2-x^2} \dd{x}
	= \int_0^{\frac{\pi}{2}} a \cos t \cdot a \cos t \dd{t}
	= \frac{a^2}{2} \int_0^{\frac{\pi}{2}} (1+\cos 2 t) \dd{t}
	= \frac{\pi a^2}{4}.
\end{equation*}
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P246 例2
计算\(\int_0^{\frac\pi2} \cos^5 x \sin x \dd{x}\).
\begin{solution}
设\(t = \cos x\)，
则\(\dd{t} = -\sin x \dd{x}\).
当\(x=0\)时，有\(t=1\).
当\(x=\frac\pi2\)时，有\(t=0\).
于是\begin{equation*}
	\int_0^{\frac\pi2} \cos^5 x \sin x \dd{x}
	= -\int_1^0 t^5 \dd{t}
	= \int_0^1 t^5 \dd{t}
	= \eval{\frac{t^6}6}_0^1
	= \frac16.
\end{equation*}
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P246 例3
计算\(\int_0^\pi \sqrt{\sin^3 x - \sin^5 x} \dd{x}\).
\begin{solution}
由于\begin{equation*}
	\sqrt{\sin^3 x - \sin^5 x}
	= \sqrt{\sin^3 x (1 - \sin^2 x)}
	= \sin^{\frac32} x \cdot \abs{\cos x},
\end{equation*}
其中\begin{equation*}
	\abs{\cos x} = \left\{ \begin{array}{rl}
		\cos x, & 0 \leq x \leq \frac\pi2, \\
		-\cos x, & \frac\pi2 < x \leq \pi,
	\end{array} \right.
\end{equation*}
所以\begin{align*}
	\int_0^\pi \sqrt{\sin^3 x - \sin^5 x} \dd{x}
	&= \int_0^{\frac\pi2} \sin^{\frac32} x \cdot \cos x \dd{x}
		+ \int_{\frac\pi2}^\pi \sin^{\frac32} x \cdot (-\cos x) \dd{x} \\
	&= \int_0^{\frac\pi2} \sin^{\frac32} x \dd(\sin x)
		- \int_{\frac\pi2}^\pi \sin^{\frac32} x \dd(\sin x) \\
	&= \frac25 \eval{\sin^{\frac52} x}_0^{\frac\pi2}
		- \frac25 \eval{\sin^{\frac52} x}_{\frac\pi2}^\pi
	= \frac45.
\end{align*}
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P247 例4
计算\(\int_0^4 \frac{x+4}{\sqrt{2x+1}} \dd{x}\).
\begin{solution}
设\(\sqrt{2x+1}=t\)，
则\(x=\frac{t^2-1}2\)且\(\dd{x}=t\dd{t}\).
当\(x=0\)时，有\(t=1\).
当\(x=4\)时，有\(t=3\).
于是\begin{align*}
	\int_0^4 \frac{x+2}{\sqrt{2x+1}} \dd{x}
	&= \int_1^3 \left(\frac{t^2-1}2+2\right) \dd{t} \\
	&= \frac12 \int_1^3 (t^2+3) \dd{t} \\
	&= \frac12 \eval{\left(\frac13 t^3 + 3t\right)}_1^3
	= \frac{22}3.
\end{align*}
\end{solution}
\end{example}

\begin{example}
%@see: https://www.bilibili.com/video/BV1TK411k7t6/
计算\(\int_0^1 \floor{e^x+1} \dd{x}\).
\begin{solution}
令\(t = e^x+1\)，
得\(x = \ln(t-1),
\dd{x} = \frac{\dd{t}}{t-1}\).
当\(x=0\)时，\(t=2\)；
当\(x=1\)时，\(t=e+1\).
于是\begin{equation*}
	I = \int_0^1 \floor{e^x+1} \dd{x}
	= \int_2^{e+1} \floor{t} \cdot \frac{\dd{t}}{t-1}.
\end{equation*}
由于\(2<e<3\)，
所以\begin{align*}
	I &= \left( \int_2^3 + \int_3^{e+1} \right) \floor{t} \cdot \frac{\dd{t}}{t-1} \\
	&= \int_2^3 2 \cdot \frac{\dd{t}}{t-1}
	+ \int_3^{e+1} 3 \cdot \frac{\dd{t}}{t-1} \\
	&= 2 \eval{\ln(t-1)}_2^3 + 3 \eval{\ln(t-1)}_3^{e+1}
	= 3 - \ln2.
\end{align*}
\end{solution}
\end{example}
\begin{example}
%@see: https://www.bilibili.com/video/BV16M411V7Ni/
计算\(\int_{1/6}^6 \frac1x \floor*{\frac1{\sqrt{x}}} \dd{x}\).
\begin{solution}
令\(t = 1/\sqrt{x}\)，
得\(x = t^{-2},
\dd{x} = -2 t^{-3} \dd{t}\).
当\(x=1/6\)时，\(t=\sqrt6\)；
当\(x=6\)时，\(t=1/\sqrt6\).
于是\begin{equation*}
	I = \int_{1/6}^6 \frac1x \floor*{\frac1{\sqrt{x}}} \dd{x}
	= \int_{\sqrt6}^{1/\sqrt6} t^2 \floor{t} \cdot (-2) t^{-3} \dd{t}
	= 2 \int_{1/\sqrt6}^{\sqrt6} \frac{\floor{t}}{t} \dd{t}.
\end{equation*}
由于\(2 = \sqrt4 < \sqrt6 < \sqrt9 = 3,
0 < 1/\sqrt6 < 1/2 < 1\)，
所以\begin{align*}
	I &= 2 \left( \int_{1/\sqrt6}^1 + \int_1^2 + \int_2^{\sqrt6} \right) \frac{\floor{t}}{t} \dd{t} \\
	&= 2 \left( \int_{1/\sqrt6}^1 \frac0t \dd{t} + \int_1^2 \frac1t \dd{t} + \int_2^{\sqrt6} \frac2t \dd{t} \right) \\
	&= 2 \left( 0 + \eval{\ln t}_1^2 + 2 \eval{\ln t}_2^{\sqrt6} \right)
	= 2 \ln3.
\end{align*}
\end{solution}
%@Mathematica: Integrate[1/x Floor[1/Sqrt[x]], {x, 1/6, 6}] // FullSimplify
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P254 习题5-3 6.
证明：\begin{itemize}
	\item 若\(f\)是连续的奇函数，则\(\int_0^x f(t) \dd{t}\)是偶函数.
	\item 若\(f\)是连续的偶函数，则\(\int_0^x f(t) \dd{t}\)是奇函数.
\end{itemize}
\begin{proof}
设\(F(x) = \int_0^x f(t) \dd{t}\)，
那么\begin{equation*}
	F(-x) = \int_0^{-x} f(t) \dd{t}
	\xlongequal{t=-u} \int_0^x f(-u) \dd(-u).
\end{equation*}
\begin{itemize}
	\item 若\(f\)是连续的奇函数，那么\(f(-u) = -f(u)\)，所以\begin{equation*}
		F(-x) = \int_0^x f(u) \dd{u} = F(x),
	\end{equation*}
	即\(F\)是偶函数；

	\item 若\(f\)是连续的偶函数，那么\(f(-u) = f(u)\)，所以\begin{equation*}
		F(-x) = -\int_0^x f(u) \dd{u} = -F(x),
	\end{equation*}
	即\(F\)是奇函数.
	\qedhere
\end{itemize}
\end{proof}
\end{example}

\begin{proposition}\label{theorem:定积分.利用对称性简化计算0}
设\(f \in R[-a,a]\)，
则\begin{equation}
	\int_{-a}^a f(x) \dd{x} = \int_0^a [f(x) + f(-x)] \dd{x}.
\end{equation}
\begin{proof}
由\cref{theorem:定积分.定积分性质3} 有\begin{equation*}
	\int_{-a}^a f(x) \dd{x}
	= \int_{-a}^0 f(x) \dd{x}
	+ \int_0^a f(x) \dd{x};
\end{equation*}
由\cref{equation:定积分.交换上下限改变定积分的符号} 有\begin{equation*}
	\int_{-a}^0 f(x) \dd{x}
	\xlongequal{x=-t} \int_a^0 f(-t) \dd(-t)
	= \int_0^a f(-t) \dd{t}
	= \int_0^a f(-x) \dd{x};
\end{equation*}
故由\cref{theorem:定积分.定积分性质1} 有\begin{equation*}
	\int_{-a}^a f(x) \dd{x}
	= \int_0^a f(-x) \dd{x} + \int_0^a f(x) \dd{x}
	= \int_0^a [f(-x) + f(x)] \dd{x}.
	\qedhere
\end{equation*}
\end{proof}
\end{proposition}

\begin{proposition}\label{theorem:定积分.利用对称性简化计算1}
%@see: 《高等数学（第六版 上册）》 P247 例5
%@see: 《数学分析（第二版 上册）》（陈纪修） P308 定理7.3.5
设\(f \in R[-a,a]\).
\begin{itemize}
	\item 若函数\(f\)在区间\([-a,a]\)上是偶函数，
	则\begin{equation*}
		\int_{-a}^a f(x) \dd{x} = 2 \int_0^a f(x) \dd{x}.
	\end{equation*}

	\item 若函数\(f\)在区间\([-a,a]\)上是奇函数，
	则\begin{equation*}
		\int_{-a}^a f(x) \dd{x} = 0.
	\end{equation*}
\end{itemize}
\begin{proof}
由\cref{theorem:定积分.利用对称性简化计算0} 有\begin{equation*}
	\int_{-a}^a f(x) \dd{x}
	= \int_0^a [f(-x) + f(x)] \dd{x}.
\end{equation*}

接下来我们对函数\(f\)分情况讨论.
\begin{itemize}
	\item 若\(f\)是偶函数，则\begin{equation*}
		f(x) + f(-x) = 2 f(x),
	\end{equation*}
	从而\begin{equation*}
		\int_{-a}^a f(x) \dd{x} = 2 \int_0^a f(x) \dd{x};
	\end{equation*}

	\item 若\(f\)是奇函数，则\begin{equation*}
		f(x) + f(-x) = 0,
	\end{equation*}
	从而\begin{equation*}
		\int_{-a}^a f(x) \dd{x} = 0.
		\qedhere
	\end{equation*}
\end{itemize}
\end{proof}
\end{proposition}
\begin{remark}
常用\cref{theorem:定积分.利用对称性简化计算1} 简化奇、偶函数在对称于原点的区间上的定积分.

当积分区间不是关于原点对称的区间时，
我们可以利用坐标变换公式，
对被积函数换元，
将积分区间平移，把它变成对称于原点的区间：\begin{equation}\label{equation:定积分.区间平移}
	\int_a^b f(x) \dd{x}
	\xlongequal{x=t+(a+b)/2}
	\int_{-\frac{b-a}2}^{\frac{b-a}2} f\left(t+\frac{a+b}2\right) \dd{t}.
\end{equation}

当我们处理非奇非偶函数函数\(f\)时，
可以利用我们从\cref{example:函数.任一函数可拆为奇偶函数之和} 得到的公式\begin{equation*}
	g(x) = \frac{f(x) + f(-x)}{2}, \qquad
	h(x) = \frac{f(x) - f(-x)}{2},
\end{equation*}
将\(f\)中的偶函数\(g\)和奇函数\(h\)分别抽离出，
再利用\cref{theorem:定积分.利用对称性简化计算1} 简化计算.
\end{remark}

\begin{example}
%@see: 《2018年全国硕士研究生入学统一考试（数学一）》一选择题/第4题
设\begin{equation*}
	M = \int_{-\frac\pi2}^{\frac\pi2} \frac{(1+x)^2}{1+x^2} \dd{x},
	\qquad
	N = \int_{-\frac\pi2}^{\frac\pi2} \frac{1+x}{e^x} \dd{x},
	\qquad
	K = \int_{-\frac\pi2}^{\frac\pi2} (1+\sqrt{\cos x}) \dd{x},
\end{equation*}
比较三个积分的大小.
\begin{solution}
%@see: https://www.bilibili.com/video/BV1no23Y4EFu/
注意到第一个定积分的被积函数\begin{equation*}
	\frac{(1+x)^2}{1+x^2}
	= \frac{1+2x+x^2}{1+x^2}
\end{equation*}含有一项关于\(x\)的奇函数\(\frac{x}{1+x^2}\)，而积分区间是对称的，
由\cref{theorem:定积分.利用对称性简化计算1} 可知\begin{equation*}
	M = \int_a^b 1 \dd{x}.
\end{equation*}
接下来比较三个定积分的被积函数的大小，可得\begin{equation*}
	\frac{1+x}{e^x} \leq 1 \leq 1 + \sqrt{\cos x},
\end{equation*}
那么由定积分\cref{theorem:定积分.定积分性质5推论1} 可知\begin{equation*}
	N < M < K.
\end{equation*}
\end{solution}
\end{example}

\begin{corollary}\label{theorem:定积分.积分上限函数的奇偶性}
设\(f \in R(-\infty,+\infty)\)，
积分上限函数\(g(x) = \int_0^x f(t) \dd{t}\).
\begin{itemize}
	\item 若\(f\)是偶函数，则\(g\)是奇函数；
	\item 若\(f\)是奇函数，则\(g\)是偶函数.
\end{itemize}
\begin{proof}
因为\begin{align*}
	g(-x) &= \int_0^{-x} f(t) \dd{t} \\
	&\xlongequal{t=-u}
	-\int_0^x f(-u) \dd{u},
\end{align*}
所以当\(f\)是偶函数，即\(f(x) = f(-x)\)时，
有\begin{equation*}
	g(-x) = -\int_0^x f(u) \dd{u} = -g(x),
\end{equation*}
即\(g\)是奇函数；
当\(f\)是奇函数，即\(f(-x) = -f(x)\)时，
有\begin{equation*}
	g(-x) = -\int_0^x (-f(u)) \dd{u} = g(x),
\end{equation*}
即\(g\)是偶函数.
\end{proof}
\end{corollary}

\begin{proposition}\label{theorem:定积分.具有轴对称图像的函数的积分}
%@see: 《数学分析（第二版 上册）》（陈纪修） P312 习题 12.
设函数\(f\)在\([a,b]\)上可积，图形\(y=f(x)\)关于\(x=T\)对称，则\begin{equation}
	\int_a^b f(x) \dd{x} = \int_a^{2T-b} f(x) \dd{x} + 2 \int_T^b f(x) \dd{x}.
\end{equation}
\begin{proof}
不妨设\(a < T < b\).
由\hyperref[theorem:定积分.定积分性质3]{区间可加性}有\begin{equation*}
	\int_a^b f(x) \dd{x}
	= \int_a^{2T-b} f(x) \dd{x}
	+ \int_{2T-b}^T f(x) \dd{x}
	+ \int_T^b f(x) \dd{x}.
\end{equation*}
因为\(y=f(x)\)关于\(x=T\)对称，
所以\(f(x) = f(2T-x)\)，
那么\begin{equation*}
	\int_{2T-b}^T f(x) \dd{x}
	\xlongequal{y=2T-x}
	\int_b^T f(2T-y) \dd(2T-y)
	= \int_T^b f(y) \dd{y},
\end{equation*}
于是\(\int_a^b f(x) \dd{x} = \int_a^{2T-b} f(x) \dd{x} + 2 \int_T^b f(x) \dd{x}\).
\end{proof}
\end{proposition}
\begin{remark}
根据\cref{theorem:定积分.具有轴对称图像的函数的积分} 的结论，
结合\cref{figure:定积分.具有轴对称图像的函数的积分} 可以看出：
如果一个函数的图像关于直线\(x=T\)对称，
那么对于对称轴两侧的任意两个区间\([p_1,q_1],[p_2,q_2]\)，
只要这两个区间也是关于对称轴\(x=T\)对称的，
即成立\(p_1 + q_2 = q_1 + p_2 = 2T\)，
那么对应的定积分\begin{equation*}
	\int_{p_1}^{q_1} f(x) \dd{x}
	\quad\text{和}\quad
	\int_{p_2}^{q_2} f(x) \dd{x}
\end{equation*}必定相等.
\end{remark}
\begin{figure}[hbt]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			xscale=2,
			xmin=4,xmax={3*pi+1},
			domain=5:{3*pi},
			ymin=0,ymax=2.2,
			axis x line=middle,
			axis y line=none,
			xtick={5,2*pi,2.5*pi,3*pi},
			xticklabels={$a\vphantom{T}$,$2T-b$,$T$,$b$},
		]
			\addplot[color=blue,samples=20,smooth]{.5*sin(deg(x))+.7};
			\begin{scope}[dashed]
				\draw(2.5*pi,0)--(2.5*pi,{.5*sin(deg(2.5*pi))+.7});
				\draw(2*pi,0)--(2*pi,.7);
				\draw(3*pi,0)--(3*pi,.7);
				\draw(5,0)--(5,{.7+.5*sin(deg(5))});
			\end{scope}
		\end{axis}
	\end{tikzpicture}
	\caption{}
	\label{figure:定积分.具有轴对称图像的函数的积分}
\end{figure}

\begin{example}
设\(f \in R[0,2a]\).
证明：\begin{equation}\label{equation:定积分.区间折半}
	\int_0^{2a} f(x) \dd{x} = \int_0^a [f(x) + f(2a-x)] \dd{x}.
\end{equation}
\begin{proof}
由\cref{theorem:定积分.定积分性质3} 有\begin{equation*}
	\int_0^{2a} f(x) \dd{x}
	= \int_0^a f(x) \dd{x} + \int_a^{2a} f(x) \dd{x};
\end{equation*}
由\cref{equation:定积分.交换上下限改变定积分的符号} 有\begin{equation*}
	\int_a^{2a} f(x) \dd{x}
	\xlongequal{x=2a-t} \int_a^0 f(2a-t) \dd(2a-t)
	= \int_0^a f(2a-t) \dd{t}
	= \int_0^a f(2a-x) \dd{x};
\end{equation*}
故由\cref{theorem:定积分.定积分性质1} 有\begin{equation*}
	\int_0^{2a} f(x) \dd{x}
	= \int_0^a f(x) \dd{x} + \int_0^a f(2a-x) \dd{x}
	= \int_0^a [f(x) + f(2a-x)] \dd{x}.
	\qedhere
\end{equation*}
\end{proof}
\end{example}

\begin{proposition}\label{theorem:定积分.区间再现}
%@see: 《高等数学（第六版 上册）》 P254 习题5-3 2.
设\(f \in C[a,b]\).
证明：\begin{equation}
	\int_a^b f(x) \dd{x}
	= \int_a^b f(a+b-x) \dd{x}.
\end{equation}
\begin{proof}
令\(x=a+b-t\)，
则\(\dd{x} = -\dd{t}\).
当\(x=a\)时，取\(t=b\).
当\(x=b\)时，取\(t=a\).
于是\begin{equation*}
	\int_a^b f(x) \dd{x}
	= \int_b^a f(a+b-t) \dd(-t)
	= \int_a^b f(a+b-t) \dd{t}.
	\qedhere
\end{equation*}
\end{proof}
\end{proposition}

\begin{example}\label{example:欧拉第一型积分.轮换对称性1}
%@see: 《高等数学（第六版 上册）》 P254 习题5-3 4.
证明：\begin{equation}
	\int_0^1 x^m (1-x)^n \dd{x}
	= \int_0^1 x^n (1-x)^m \dd{x}
	\quad(m,n\in\mathbb{N}).
\end{equation}
\begin{proof}
记\(f(x) = x^m (1-x)^n\)，
则\(f(1+0-x) = x^n (1-x)^m\).
由\cref{theorem:定积分.区间再现} 可知，上式显然成立.
\end{proof}
\end{example}

\begin{remark}
利用\cref{theorem:定积分.区间再现}，
我们可以便捷地换元，而不改变积分区间.
并且，如果换元前后的被积函数的线性组合\begin{equation*}
	k_1 f(x) + k_2 f(a+b-x)
\end{equation*}恒为一个常数，
即\begin{equation*}
	k_1 f(x) + k_2 f(a+b-x) = s,
\end{equation*}
其中\(s\)是常数，
就可以化简被积函数，
得到\begin{equation*}
	(k_1 + k_2) \int_a^b f(x) \dd{x}
	= \int_a^b [k_1 f(x) + k_2 f(a+b-x)] \dd{x}
	= s \int_a^b \dd{x} = s(b-a),
\end{equation*}
于是\begin{equation*}
	\int_a^b f(x) \dd{x}
	= \frac{s(b-a)}{k_1 + k_2}.
\end{equation*}
\end{remark}

\begin{example}
计算定积分\(\int_0^{\frac{\pi}{2}} \frac{\sin x}{\sin x + \cos x} \dd{x}\).
\begin{solution}
因为\begin{equation*}
	\frac{\sin x}{\sin x + \cos x}
	\xlongequal{x=0+\frac\pi2-t}
	\frac{\sin\left(\frac{\pi}{2}-t\right)}
		{\sin\left(\frac{\pi}{2}-t\right) + \cos\left(\frac{\pi}{2}-t\right)}
	= \frac{\cos t}{\cos t + \sin t},
\end{equation*}
而\begin{equation*}
	1 \cdot \frac{\sin x}{\sin x + \cos x}
	+ 1 \cdot \frac{\cos x}{\sin x + \cos x}
	= 1,
\end{equation*}
所以\begin{equation*}
	\int_0^{\frac{\pi}{2}} \frac{\sin x}{\sin x + \cos x} \dd{x}
	= \frac{1}{1+1}\left(\frac\pi2-0\right)
	= \frac\pi4.
\end{equation*}
\end{solution}
\end{example}

\begin{proposition}\label{theorem:定积分.正余弦函数的复合的积分1}
%@see: 《高等数学（第六版 上册）》 P248 例6
%@see: 《数学分析（第二版 上册）》（陈纪修） P311 习题 9. (1)
%@see: 《数学分析（第二版 上册）》（陈纪修） P312 习题 9. (2)
设\(f \in C[0,1]\)，
则\begin{gather}
	\int_0^{\frac\pi2} f(\sin x) \dd{x}
	= \int_0^{\frac\pi2} f(\cos x) \dd{x}, \\
	\int_0^\pi x f(\sin x) \dd{x}
	= \frac{\pi}{2} \int_0^\pi f(\sin x) \dd{x}.
\end{gather}
\begin{proof}
显然有\begin{align*}
	\int_0^{\frac\pi2} f(\sin x) \dd{x}
	&\xlongequal{x = \pi/2-t}
		\int_{\frac\pi2}^0 f\left[\sin(\frac{\pi}{2}-t)\right] \dd(\frac{\pi}{2}-t) \\
	&= \int_0^{\frac\pi2} f(\cos x) \dd{x}.
		\tag{\cref{equation:函数.三角函数.诱导公式10}}
\end{align*}

因为\begin{align*}
	\int_0^\pi x f(\sin x) \dd{x}
	&\xlongequal{x = \pi-t}
		\int_{\pi}^0 (\pi-t) f[\sin(\pi-t)] \dd(\pi-t) \\
	&= \int_0^\pi (\pi-x) f(\sin x) \dd{x}
		\tag{\cref{equation:函数.三角函数.诱导公式5}} \\
	&= \pi \int_0^\pi f(\sin x) \dd{x}
		- \int_0^\pi x f(\sin x) \dd{x},
\end{align*}
所以\begin{equation*}
	\int_0^\pi x f(\sin x) \dd{x}
	= \frac{\pi}{2} \int_0^\pi f(\sin x) \dd{x}.
	\qedhere
\end{equation*}
\end{proof}
\end{proposition}
\begin{example}
%@see: https://www.bilibili.com/video/BV1xUimYGE1C/
设\(f \in C[0,1]\).
证明：\begin{equation}
	\int_0^\pi f(\sin x) \dd{x}
	= 2 \int_0^{\frac\pi2} f(\sin x) \dd{x}.
\end{equation}
\begin{proof}
% 区间可加性
因为\(\int_0^\pi f(\sin x) \dd{x}
= \int_0^{\frac\pi2} f(\sin x) \dd{x}
+ \int_{\frac\pi2}^\pi f(\sin x) \dd{x}\)，
而\begin{equation*}
	\int_{\frac\pi2}^\pi f(\sin x) \dd{x}
	\xlongequal{x=\pi-t}% 换元
	\int_0^{\frac\pi2} f(\sin(\pi-t)) \dd{t},
\end{equation*}
%\cref{equation:函数.三角函数.诱导公式5}
并且\(\sin(\pi-t) = \sin t\)，
所以\(\int_{\frac\pi2}^\pi f(\sin x) \dd{x}
= \int_0^{\frac\pi2} f(\sin t) \dd{t}\)，
从而有\begin{equation*}
	\int_0^\pi f(\sin x) \dd{x}
	= 2 \int_0^{\frac\pi2} f(\sin x) \dd{x}.
\end{equation*}
\end{proof}
\end{example}
\begin{remark}
一般地，当\(f \in C[0,1]\)时，有\(\int_0^\pi f(\cos x) \dd{x}
\neq 2 \int_0^{\frac\pi2} f(\cos x) \dd{x}\).
\end{remark}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P249
计算\(\int_0^\pi \frac{x \sin x}{1 + \cos^2 x} \dd{x}\).
\begin{solution}
利用\cref{theorem:定积分.正余弦函数的复合的积分1} 得\begin{align*}
	\int_0^\pi \frac{x \sin x}{1 + \cos^2 x} \dd{x}
	&= \frac\pi2 \int_0^\pi \frac{\sin x}{1 + \cos^2 x} \dd{x} \\
	&= -\frac\pi2 \int_0^\pi \frac{\dd(\cos x)}{1 + \cos^2 x} \\
	&= -\frac\pi2 \eval{[\arctan(\cos x)]}_0^\pi \\
	&= \frac{\pi^2}4.
\end{align*}
\end{solution}
\end{example}

\begin{proposition}\label{theorem:定积分.周期函数的积分}
%@see: 《高等数学（第六版 上册）》 P249 例7
%@see: 《数学分析（第二版 上册）》（陈纪修） P309 定理7.3.6
%@see: 《数学分析教程（第3版 上册）》（史济怀） P259 例4
设函数\(f\)是以\(T\)为周期的黎曼可积函数.
证明：\begin{gather}
	\int_a^{a+T} f(x) \dd{x} = \int_0^T f(x) \dd{x}, \\
	\int_a^{a+nT} f(x) \dd{x} = n\int_0^T f(x) \dd{x}
	\quad(n\in\mathbb{N}).
\end{gather}
\begin{proof}
记\(\Phi(a) = \int_a^{a+T} f(x) \dd{x}\).
利用\cref{theorem:定积分.变限积分定理}，
对\(a\)求导得\begin{equation*}
	\dv{a} \Phi(a) = f(a+T) - f(a) = 0,
\end{equation*}
这就是说\(\Phi(a)\)与\(a\)无关，
于是\(\Phi(a) = \Phi(0)\)，即\begin{equation*}
	\int_a^{a+T} f(x) \dd{x} = \int_0^T f(x) \dd{x};
\end{equation*}
由此可得\begin{equation*}
	\int_a^{a+nT} f(x) \dd{x}
	= \sum_{k=0}^{n-1} \int_{a+kT}^{(a+kT)+T} f(x) \dd{x}
	= \sum_{k=0}^{n-1} \int_0^T f(x) \dd{x}
	= n \int_0^T f(x) \dd{x}.
	\qedhere
\end{equation*}
\end{proof}
%\cref{theorem:导数与微分.导函数的周期性}
\end{proposition}
\begin{remark}
\cref{theorem:定积分.周期函数的积分} 说明：
周期函数在长度是周期的整倍数的区间上的积分具有平移对称性.
\end{remark}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P249
计算\(\int_0^{n\pi} \sqrt{1 + \sin2x} \dd{x}\).
\begin{solution}
显然被积函数\(x \mapsto \sqrt{1 + \sin2x}\)是以\(\pi\)为周期的连续函数，
利用\cref{theorem:定积分.周期函数的积分} 得\begin{align*}
	\int_0^{n\pi} \sqrt{1 + \sin2x} \dd{x}
	&= n \int_0^\pi \sqrt{1 + \sin2x} \dd{x} \\
	&= n \int_0^\pi \abs{\sin x + \cos x} \dd{x} \\
	&= \sqrt2 n \int_0^\pi \abs{\sin\left(x + \frac\pi4\right)} \dd{x} \\
	&= \sqrt2 n \int_{\frac\pi4}^{\frac{5\pi}4} \abs{\sin t} \dd{t} \\
	&= \sqrt2 n \int_0^\pi \abs{\sin t} \dd{t} \\
	&= \sqrt2 n \int_0^\pi \sin t \dd{t} \\
	&= 2\sqrt2 n.
\end{align*}
\end{solution}
\end{example}

\begin{example}
%@see: 《数学分析（第二版 上册）》（陈纪修） P312 习题 17.
计算\(a_n = \int_0^{n\pi} x \abs{\sin x} \dd{x}\ (n=1,2,\dotsc)\).
\begin{solution}
%@see: https://www.bilibili.com/video/BV1eieAe1ERR
%@credit: https://space.bilibili.com/433361437
由\cref{theorem:定积分.区间再现} 可得\begin{align*}
	\int_0^{n\pi} x \abs{\sin x} \dd{x}
	&= \int_0^{n\pi} (n\pi-x) \abs{\sin(n\pi-x)} \dd{x} \\
	&= n\pi \int_0^{n\pi} \abs{\sin x} \dd{x}
		- \int_0^{n\pi} x \abs{\sin x} \dd{x}.
\end{align*}
因为\(x \mapsto \abs{\sin x}\)是以\(\pi\)为周期的连续函数，
所以由\cref{theorem:定积分.周期函数的积分} 可得\begin{equation*}
	\int_0^{n\pi} \abs{\sin x} \dd{x}
	= n \int_0^\pi \sin x \dd{x}
	= 2n.
\end{equation*}
于是\begin{equation*}
	a_n = \frac{n\pi}2 \int_0^{n\pi} \abs{\sin x} \dd{x}
	= \frac{n\pi}2 \cdot 2n
	= n^2\pi.
\end{equation*}
\end{solution}
\end{example}
\begin{example}
%@see: https://www.bilibili.com/video/BV1LRhSeMEFr/
计算\(\lim_{x\to+\infty} \frac1x \int_0^x \abs{\sin t} \dd{t}\).
\begin{solution}
对于\(\forall x\geq0\)，\(\exists n\in\mathbb{N}\)，
使得\(n\pi \leq x < (n+1)\pi\)，
或者\(\frac1{(n+1)\pi} < \frac1x \leq \frac1{n\pi}\)，
于是\begin{equation*}
	\frac1{(n+1)\pi} \int_0^{n\pi} \abs{\sin t} \dd{t}
	\leq \frac1x \int_0^x \abs{\sin t} \dd{t}
	\leq \frac1{n\pi} \int_0^{(n+1)\pi} \abs{\sin t} \dd{t}.
\end{equation*}
因为当\(n\to\infty\)时有\begin{gather*}
	\frac1{(n+1)\pi} \int_0^{n\pi} \abs{\sin t} \dd{t}
	= \frac{n}{(n+1)\pi} \int_0^\pi \abs{\sin t} \dd{t}
	= \frac{2n}{(n+1)\pi}
	\to \frac2\pi, \\
	\frac1{n\pi} \int_0^{(n+1)\pi} \abs{\sin t} \dd{t}
	= \frac{n+1}{n\pi} \int_0^\pi \abs{\sin t} \dd{t}
	= \frac{2(n+1)}{n\pi}
	\to \frac2\pi,
\end{gather*}
所以由\hyperref[theorem:函数极限.夹逼准则]{夹逼准则}可知\begin{equation*}
	\lim_{x\to+\infty} \frac1x \int_0^x \abs{\sin t} \dd{t}
	= \frac2\pi.
\end{equation*}
\end{solution}
\end{example}
\begin{example}
%@see: https://www.bilibili.com/video/BV1SC2wY5EtD/
计算\(\lim_{x\to+\infty} \frac1{x^2} \int_0^x t \abs{\sin t} \dd{t}\).
\begin{solution}
对于\(\forall x\geq0\)，\(\exists n\in\mathbb{N}\)，
使得\(n\pi \leq x < (n+1)\pi\)，
或者\(\frac1{(n+1)\pi} < \frac1x \leq \frac1{n\pi}\)，
于是\begin{equation*}
	\frac1{(n+1)^2\pi^2} \int_0^{n\pi} t \abs{\sin t} \dd{t}
	\leq \frac1{x^2} \int_0^x t \abs{\sin t} \dd{t}
	\leq \frac1{n^2\pi^2} \int_0^{(n+1)\pi} t \abs{\sin t} \dd{t}.
\end{equation*}
因为当\(n\to\infty\)时有\begin{gather*}
	\frac1{(n+1)^2\pi^2} \int_0^{n\pi} t \abs{\sin t} \dd{t}
	= \frac{n^2\pi}{(n+1)^2\pi^2}
	\to \frac1\pi, \\
	\frac1{n^2\pi^2} \int_0^{(n+1)\pi} t \abs{\sin t} \dd{t}
	= \frac{(n+1)^2\pi}{n^2\pi^2}
	\to \frac1\pi,
\end{gather*}
所以由\hyperref[theorem:函数极限.夹逼准则]{夹逼准则}可知\begin{equation*}
	\lim_{x\to+\infty} \frac1{x^2} \int_0^x t \abs{\sin t} \dd{t} = \frac1\pi.
\end{equation*}
\end{solution}
\end{example}

\begin{example}
%@see: 《数学分析中的典型问题与方法（第3版）》（裴礼文） P39 例1.3.20
设函数\(f\)是以\(T\)为周期的连续函数，
证明：\begin{equation}\label{equation:定积分.周期函数的平均值的极限}
	\lim_{x\to+\infty} \frac1x \int_0^x f(t) \dd{t}
	= \frac1T \int_0^T f(t) \dd{t}.
\end{equation}
\begin{proof}
首先假设\(f(x)\geq0\ (x\geq0)\)，
那么对于\(\forall x\geq0\)，\(\exists n\in\mathbb{N}\)，
使得\(nT \leq x < (n+1)T\)，
于是\begin{equation*}
	\frac1{(n+1)T} \int_0^{nT} f(t) \dd{t}
	\leq \frac1x \int_0^x f(t) \dd{t}
	\leq \frac1{nT} \int_0^{(n+1)T} f(t) \dd{t}.
\end{equation*}
因为当\(n\to\infty\)时有\begin{gather*}
	\frac1{(n+1)T} \int_0^{nT} f(t) \dd{t}
	= \frac{n}{(n+1)T} \int_0^T f(t) \dd{t}
	\to \frac1T \int_0^T f(t) \dd{t}, \\
	\frac1{nT} \int_0^{(n+1)T} f(t) \dd{t}
	= \frac{n+1}{nT} \int_0^T f(t) \dd{t}
	\to \frac1T \int_0^T f(t) \dd{t},
\end{gather*}
所以由\hyperref[theorem:函数极限.夹逼准则]{夹逼准则}可知\begin{equation*}
	\lim_{x\to+\infty} \frac1x \int_0^x f(t) \dd{t}
	= \frac1T \int_0^T f(t) \dd{t}.
\end{equation*}

对于一般情况（无法保证\(f(x)\geq0\ (x\geq0)\)成立），
由于连续周期函数必定有界，不妨设\(m\)是\(f\)在\([0,T]\)上的一个下界，
即\(f(x) \geq m\ (x\geq0)\)，
令\(g(x) \defeq f(x) - m\)，
则有\(g(x)\geq0\ (x\geq0)\)，
于是\begin{equation*}
	\lim_{x\to+\infty} \frac1x \int_0^x g(t) \dd{t}
	= \frac1T \int_0^T g(t) \dd{t},
\end{equation*}
其中\begin{align*}
	\lim_{x\to+\infty} \frac1x \int_0^x g(t) \dd{t}
	&= \lim_{x\to+\infty} \frac1x \int_0^x (f(t) - m) \dd{t} \\
	&= \lim_{x\to+\infty} \left[
		\frac1x \int_0^x f(t) \dd{t}
		- m \cdot \frac1x \int_0^x \dd{t}
	\right] \\
	&= \left[ \lim_{x\to+\infty} \frac1x \int_0^x f(t) \dd{t} \right] - m, \\
	\frac1T \int_0^T g(t) \dd{t}
	&= \frac1T \int_0^T (f(t) - m) \dd{t} \\
	&= \frac1T \left[
		\int_0^T f(t) \dd{t}
		- m \cdot \int_0^T \dd{t}
	\right] \\
	&= \left[ \frac1T \int_0^T f(t) \dd{t} \right] - m,
\end{align*}
因此\begin{equation*}
	\lim_{x\to+\infty} \frac1x \int_0^x f(t) \dd{t}
	= \frac1T \int_0^T f(t) \dd{t}.
	\qedhere
\end{equation*}
%@credit: {fff74d84-2e79-4c04-bec3-8c318cc2293c}
\end{proof}
\end{example}

\begin{proposition}\label{theorem:定积分.正余弦函数的复合的积分2}
%@see: 《高等数学（第六版 上册）》 P254 习题5-3 5.
设\(f \in C[0,1]\)，且\(n\in\mathbb{Z}\)，则\begin{equation}
	\int_{\frac{n}{2} \pi}^{\frac{n+1}{2} \pi} f(\abs{\sin x}) \dd{x}
	= \int_{\frac{n}{2} \pi}^{\frac{n+1}{2} \pi} f(\abs{\cos x}) \dd{x}
	= \int_0^{\frac{\pi}{2}} f(\sin x) \dd{x}.
\end{equation}
\def\arraystretch{1.5}
\begin{proof}
令\(x = n\pi+\frac{\pi}{2}-t\)，
则有\begin{align*}
	\int_{\frac{n}{2} \pi}^{\frac{n+1}{2} \pi} f(\abs{\sin x}) \dd{x}
	&= \int_{\frac{n+1}{2} \pi}^{\frac{n}{2} \pi} f\left[\abs{\pm\sin(\frac{\pi}{2}-t)}\right] \dd(\frac{2n+1}{2}\pi-t) \\
	&= \int_{\frac{n}{2} \pi}^{\frac{n+1}{2} \pi} f(\abs{\cos x}) \dd{x}.
\end{align*}

又令\(x=u+\frac{n}{2} \pi\)，
则有\begin{align*}
	\int_{\frac{n}{2} \pi}^{\frac{n+1}{2} \pi} f(\abs{\cos x}) \dd{x}
	&= \int_0^{\frac{1}{2}\pi} f\left[ \abs{\cos(u+\frac{\pi}{2})} \right] \dd(u+\frac{n}{2}\pi) \\
	&= \int_0^{\frac{1}{2}\pi} f\left( \abs{-\sin u} \right) \dd{u} \\
	&= \int_0^{\frac{1}{2}\pi} f(\sin x) \dd{x}.
	\qedhere
\end{align*}
\end{proof}
\end{proposition}

%@see: https://www.bilibili.com/video/BV1fN411y7z1/
\begin{example}\label{example:定积分.积分上限函数是周期函数的充分必要条件}
证明：如果对于某个实数\(a\)，
函数\(f\colon\mathbb{R}\to\mathbb{R}\)满足\begin{equation*}
	\int_a^{a+T} f(x) \dd{x} = 0,
\end{equation*}
则函数\(g(x) = \int_0^x f(t) \dd{t}\)是周期函数，且\(T\)是\(g\)的周期.
\begin{proof}
由\cref{theorem:定积分.周期函数的积分} 可知\begin{equation*}
	\int_a^{a+T} f(x) \dd{x} = \int_0^T f(x) \dd{x},
\end{equation*}
于是\begin{equation*}
	g(x+T)
	= \int_0^{x+T} f(t) \dd{t}
	= \int_0^x f(t) \dd{t} + \int_x^{x+T} f(t) \dd{t}
	= g(x) + \int_0^T f(x) \dd{x},
\end{equation*}
因此\begin{equation*}
	g(x+T) = g(x)
	\iff
	\int_0^T f(x) \dd{x} = 0
	\iff
	\int_a^{a+T} f(x) \dd{x} = 0.
	\qedhere
\end{equation*}
\end{proof}
\end{example}
\begin{example}
设函数\(f\colon\mathbb{R}\to\mathbb{R}\)是以\(T\)为周期的连续函数.
证明：函数\begin{equation*}
	g(x) = \int_0^x f(t) \dd{t} - \int_{-x}^0 f(t) \dd{t}
\end{equation*}也是以\(T\)为周期的函数.
\begin{proof}
令\(t=-u\)，则\begin{equation*}
	\int_{-x}^0 f(t) \dd{t}
	= \int_0^x f(-u) \dd{u},
\end{equation*}
于是\begin{equation*}
	g(x) = \int_0^x f(t) \dd{t} - \int_0^x f(-u) \dd{u}
	= \int_0^x (f(t) - f(-t)) \dd{t}.
\end{equation*}
记\(\phi(x) \defeq f(x) - f(-x)\)，
由于\begin{equation*}
	\phi(-x) + \phi(x)
	= f(-x) - f(x) + f(x) - f(-x)
	= 0,
\end{equation*}
即\(\phi\)是奇函数，
所以\begin{equation*}
	\int_{-T/2}^{T/2} (f(x) - f(-x)) \dd{x}
	= 0.
\end{equation*}
于是由\cref{example:定积分.积分上限函数是周期函数的充分必要条件} 可知
\(g\)是以\(T\)为周期的函数.
\end{proof}
\end{example}

\begin{example}
%@see: 《数学分析教程（第3版 上册）》（史济怀） P261 例7
设函数\(f \in C(a,b)\)，\(\alpha,\beta\in(a,b)\).
证明：\begin{equation*}
	\lim_{h\to0} \frac1h \int_\alpha^\beta (f(x+h) - f(x)) \dd{x}
	= f(\beta) - (\alpha).
\end{equation*}
\begin{proof}
令\(t = x + h\)，得\begin{equation*}
	\int_\alpha^\beta f(x+h) \dd{x}
	= \int_{\alpha + h}^{\beta + h} f(t) \dd{t}
	= \int_\alpha^\beta f(t) \dd{t}
	+ \int_\beta^{\beta + h} f(t) \dd{t}
	- \int_\alpha^{\alpha + h} f(t) \dd{t}.
\end{equation*}
由\hyperref[theorem:定积分.积分中值定理1推论2]{积分中值定理}得\begin{gather*}
	\int_\beta^{\beta + h} f(t) \dd{t}
	= f(\xi) h
	\quad(\text{$\xi$在$\beta$与$\beta+h$之间}), \\
	\int_\alpha^{\alpha + h} f(t) \dd{t}
	= f(\eta) h
	\quad(\text{$\eta$在$\alpha$与$\alpha+h$之间}).
\end{gather*}
因此\begin{equation*}
	\frac1h \int_\alpha^\beta (f(x + h) - f(x)) \dd{x}
	= f(\xi) - f(\eta).
\end{equation*}
令\(h\to0\)，由\(f\)的连续性，可知\begin{equation*}
	\lim_{h\to0} f(\xi) = f(\beta),
	\qquad
	\lim_{h\to0} f(\eta) = \alpha.
	\qedhere
\end{equation*}
\end{proof}
\end{example}
