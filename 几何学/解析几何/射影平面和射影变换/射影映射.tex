\section{射影映射和射影变换}
本章开头介绍了中心投影，这一节我们要来推广中心投影的概念.

\subsection{射影映射的定义和性质}
\begin{definition}
%@see: 《解析几何》（丘维声） P290 定义5.1
设\(\mathscr{P}_1,\mathscr{P}_2\)是两个射影平面，
\(f\colon \mathscr{P}_1 \to \mathscr{P}_2\)是一个双射.
如果\(f\)把共线三点映成共线三点，
则称\(f\)是一个\DefineConcept{射影映射}.
\end{definition}

\begin{definition}
设\(\mathscr{P}\)是一个射影平面，
\(f\colon \mathscr{P} \to \mathscr{P}\)是一个双射.
如果\(f\)把共线三点映成共线三点，
则称\(f\)是一个\DefineConcept{射影变换}（projective transformation）.
\end{definition}

\begin{example}
%@see: 《解析几何》（丘维声） P290
中心投影是射影映射.
\end{example}

由定义立即得到射影映射的下述性质.
\begin{property}
%@see: 《解析几何》（丘维声） P290 性质1
射影映射的乘积还是射影映射.
\end{property}

\begin{property}
%@see: 《解析几何》（丘维声） P290 性质2
射影映射把不共线三点映成不共线三点.
\end{property}

\begin{property}
%@see: 《解析几何》（丘维声） P291 性质3
射影映射都是可逆的，并且它的逆映射也是射影映射.
\end{property}

\begin{property}
%@see: 《解析几何》（丘维声） P291 性质4
射影映射把直线映成直线.
\end{property}

\begin{property}
%@see: 《解析几何》（丘维声） P291 性质5
射影映射把一般位置的四个点映成一般位置的四个点.
\end{property}

\begin{theorem}\label{theorem:解析几何.射影映射.射影映射基本定理1}
%@see: 《解析几何》（丘维声） P291 定理5.1（射影映射基本定理之一）
从射影平面\(\overline{\pi_0}\)到\(\overline{\pi_1}\)的射影映射\(\tau\)
把\(\overline{\pi_0}\)上的一般位置的四个点\(\AutoTuple{A}{3},E\)
映成\(\overline{\pi_1}\)上的一般位置的四个点\(\AutoTuple{A'}{3},E'\)，
并且\(\overline{\pi_0}\)上任意一点\(M\)在基底\([\AutoTuple{A}{3},E]\)中的射影坐标
等于\(M\)的像\(M'\)在基底\([\AutoTuple{A'}{3},E']\)中的射影坐标.
\end{theorem}

\begin{theorem}
%@see: 《解析几何》（丘维声） P293 定理5.2（射影映射基本定理之二）
设\(\AutoTuple{A}{3},E\)是射影平面\(\overline{\pi_0}\)上一般位置的四个点，
\(\AutoTuple{A'}{3},E'\)是射影平面\(\overline{\pi_1}\)上一般位置的四个点，
则存在从\(\overline{\pi_0}\)到\(\overline{\pi_1}\)的唯一的射影映射\(\tau\)
把\(\AutoTuple{A}{3},E\)分别映成\(\AutoTuple{A'}{3},E'\).
\end{theorem}

\begin{theorem}
%@see: 《解析几何》（丘维声） P293 定理5.3
设\(\tau\)是射影平面\(\overline{\pi_0}\)到\(\overline{\pi_1}\)的一个映射，
在\(\overline{\pi_0}\)、\(\overline{\pi_1}\)上
分别取基底 I \([\AutoTuple{A}{3},E]\)、II \([\AutoTuple{B}{3},F]\)，
\(\overline{\pi_0}\)上任意一点\(M\)在 I 中的射影坐标为\((x_1,x_2,x_3)\)，
\(\tau(M)\)在 II 中的射影坐标为\((x'_1,x'_2,x'_3)\).
\begin{itemize}
	\item
	如果\(\tau\)是射影映射，
	则存在非零常数\(\rho\)和非奇异矩阵\begin{equation*}
		T
		\defeq
		\begin{bmatrix}
			a_{11} & a_{12} & a_{13} \\
			a_{21} & a_{22} & a_{23} \\
			a_{31} & a_{32} & a_{33}
		\end{bmatrix}
	\end{equation*}
	使得\begin{equation}\label{equation:解析几何.射影映射.射影映射的基底变换公式}
	%@see: 《解析几何》（丘维声） P293 (5.5)
		\rho
		\begin{bmatrix}
			x'_1 \\ x'_2 \\ x'_3
		\end{bmatrix}
		= T
		\begin{bmatrix}
			x_1 \\ x_2 \\ x_3
		\end{bmatrix}.
	\end{equation}

	\item
	如果存在非零常数\(\rho\)和非奇异矩阵\begin{equation*}
		T
		\defeq
		\begin{bmatrix}
			a_{11} & a_{12} & a_{13} \\
			a_{21} & a_{22} & a_{23} \\
			a_{31} & a_{32} & a_{33}
		\end{bmatrix}
	\end{equation*}
	使得\cref{equation:解析几何.射影映射.射影映射的基底变换公式} 成立，
	则\(\tau\)一定是射影映射.
\end{itemize}
%TODO
% \begin{proof}
% 设\(\tau\)是从\(\overline{\pi_0}\)到\(\overline{\pi_1}\)的一个射影映射，
% 它把\(\AutoTuple{A}{3},E\)分别映成\(\AutoTuple{A'}{3},E'\)，
% 则\(\AutoTuple{A'}{3},E'\)是\(\overline{\pi_1}\)上的一般位置的四个点.
% 取基底 I' \([\AutoTuple{A'}{3},E']\).
% 根据\cref{theorem:解析几何.射影映射.射影映射基本定理1}，
% \(\tau(M)\)在 I' 中的射影坐标等于\(M\)在 I 中的射影坐标，
% II 到 I' 的射影坐标变换公式中的系数矩阵
% \end{proof}
\end{theorem}

我们把\cref{equation:解析几何.射影映射.射影映射的基底变换公式}
称为“射影映射\(\tau\)关于基底 I 和 II 的公式”.

\begin{property}
%@see: 《解析几何》（丘维声） P295 性质6
射影映射保持共线四点的交比不变.
\end{property}

\begin{property}
%@see: 《解析几何》（丘维声） P295 性质7
射影映射保持共点四线的交比不变.
\end{property}

\subsection{射影变换}
由于射影变换的乘积还是射影变换，恒等变换是射影变换，射影变换是可逆的，其逆变换仍是射影变换，
所以射影平面上所有的射影变换成为一个群，我们称之为\DefineConcept{射影变换群}.

上述关于射影映射的性质和定理，对于射影变换同样成立.
交比是射影不变量.

同样地，射影平面的一个射影点变换\(\sigma\)诱导了这个射影平面上所有直线组成的集合到自身的一个双射，
并且\(\sigma\)保持点与直线的关联性.

\begin{example}
%@see: 《解析几何》（丘维声） P296 例5.1
在射影平面上，
求把点\(
	A(1,0,1),
	B(2,1,1),
	C(3,-1,0),
	D(3,5,2)
\)分别映成点\(
	A'(-1,0,\allowbreak3),
	B'(1,1,3),
	C'(2,3,8),
	D'(2,1,-2)
\)的射影变换\(\sigma\)的公式.
\begin{solution}
设\(\sigma\)的公式为\begin{equation*}
	\lambda
	\begin{bmatrix}
		x'_1 \\ x'_2 \\ x'_3
	\end{bmatrix}
	= \begin{bmatrix}
		a_{11} & a_{12} & a_{13} \\
		a_{21} & a_{22} & a_{23} \\
		a_{31} & a_{32} & a_{33}
	\end{bmatrix}
	\begin{bmatrix}
		x_1 \\ x_2 \\ x_3
	\end{bmatrix}.
\end{equation*}
那么由题意有\begin{equation*}
	\begin{bmatrix}
		a_{11} & a_{12} & a_{13} \\
		a_{21} & a_{22} & a_{23} \\
		a_{31} & a_{32} & a_{33}
	\end{bmatrix}
	\begin{bmatrix}
		% \(A,B,C,D\)四个点的坐标，作为列向量，组成的矩阵
		1 & 2 & 3 & 3 \\
		0 & 1 & -1 & 5 \\
		1 & 1 & 0 & 2
	\end{bmatrix}
	= \begin{bmatrix}
		% \(A',B',C',D'\)四个点的坐标，作为列向量，组成的矩阵
		-1 & 1 & 2 & 2 \\
		0 & 1 & 3 & 1 \\
		3 & 3 & 8 & -2
	\end{bmatrix}
	\begin{bmatrix}
		% 四对点\((A,A'),(B,B'),(C,C'),(D,D')\)各有一个公式，取不同的\(\lambda\)
		\lambda_1 \\
		& \lambda_2 \\
		&& \lambda_3 \\
		&&& \lambda_4
	\end{bmatrix},
\end{equation*}
取转置得\begin{equation*}
	\begin{bmatrix}
		1 & 0 & 1 \\
		2 & 1 & 1 \\
		3 & -1 & 0 \\
		3 & 5 & 2
	\end{bmatrix}
	\begin{bmatrix}
		a_{11} & a_{21} & a_{31} \\
		a_{12} & a_{22} & a_{32} \\
		a_{13} & a_{23} & a_{33}
	\end{bmatrix}
	= \begin{bmatrix}
		-\lambda_1 & 0 & 3\lambda_1 \\
		\lambda_2 & \lambda_2 & 3\lambda_2 \\
		2\lambda_3 & 3\lambda_3 & 8\lambda_3 \\
		2\lambda_4 & \lambda_4 & -2\lambda_4
	\end{bmatrix}.
	\eqno(1)
\end{equation*}
写出矩阵方程(1)的增广矩阵，作初等行变换，得\begin{align*}
	&\begin{bmatrix}
		1 & 0 & 1 & -\lambda_1 & 0 & 3\lambda_1 \\
		2 & 1 & 1 & \lambda_2 & \lambda_2 & 3\lambda_2 \\
		3 & -1 & 0 & 2\lambda_3 & 3\lambda_3 & 8\lambda_3 \\
		3 & 5 & 2 & 2\lambda_4 & \lambda_4 & -2\lambda_4
	\end{bmatrix}
	\to
	\\
	&
	{\def\arraystretch{1.5}
	\begin{bmatrix}
		1 & 0 & 0
		& \frac14 \lambda_1 + \frac14 \lambda_2 + \frac12 \lambda_3
		& \frac14 \lambda_2 + \frac34 \lambda_3
		& -\frac34 \lambda_1 + \frac34 \lambda_2 + 2 \lambda_3 \\
		0 & 1 & 0
		& \frac34 \lambda_1 + \frac34 \lambda_2 - \frac12 \lambda_3
		& \frac34 \lambda_2 - \frac34 \lambda_3
		& -\frac94 \lambda_1 + \frac94 \lambda_2 - 2 \lambda_3 \\
		0 & 0 & 1
		& -\frac54 \lambda_1 - \frac14 \lambda_2 - \frac12 \lambda_3
		& -\frac14 \lambda_2 - \frac34 \lambda_3
		& \frac{15}4 \lambda_1 - \frac34 \lambda_2 - 2 \lambda_3 \\
		0 & 0 & 0
		& -2 \lambda_1 - 4 \lambda_2 + 2 \lambda_3 + 2 \lambda_4
		& -4 \lambda_2 + 3 \lambda_3 + \lambda_4
		& 6 \lambda_1 - 12 \lambda_2 + 8 \lambda_3 - 2 \lambda_4
	\end{bmatrix}}.
%@Mathematica: A = {{1, 0, 1, -a1, 0, 3 a1}, {2, 1, 1, a2, a2, 3 a2}, {3, -1, 0, 2 a3, 3 a3, 8 a3}, {3, 5, 2, 2 a4, a4, -2 a4}};
%@Mathematica: RowReduce[A[[1 ;; 3]]] // Expand // MatrixForm
\end{align*}
于是，要使矩阵方程(1)有解，上述行约化矩阵最后一行的所有元素都应该等于零，即\begin{equation*}
	\begin{cases}
		-2 \lambda_1 - 4 \lambda_2 + 2 \lambda_3 + 2 \lambda_4
		= 0, \\
		-4 \lambda_2 + 3 \lambda_3 + \lambda_4
		= 0, \\
		6 \lambda_1 - 12 \lambda_2 + 8 \lambda_3 - 2 \lambda_4
		= 0,
	\end{cases}
\end{equation*}
解得\begin{equation*}
	\lambda_1
	= \frac34 \lambda_4,
	\qquad
	\lambda_2
	= -\frac18 \lambda_4,
	\qquad
	\lambda_3
	= -\frac12 \lambda_4.
\end{equation*}
取\(\lambda_4 \defeq 32\)，
得\(
	\lambda_1 = 24,
	\lambda_2 = -4,
	\lambda_3 = -16
\).
代入上述行约化矩阵的前3行、后3列，可以求出\(a_{ij}\)，
于是\(\sigma\)的公式为\begin{equation*}
	\lambda
	\begin{bmatrix}
		x'_1 \\ x'_2 \\ x'_3
	\end{bmatrix}
	= \begin{bmatrix}
		-3 & 23 & -21 \\
		-13 & 9 & 13 \\
		-53 & -31 & 125
	\end{bmatrix}
	\begin{bmatrix}
		x_1 \\ x_2 \\ x_3
	\end{bmatrix}.
\end{equation*}
\end{solution}
\end{example}

\subsection{分式线性变换}
在射影平面上取定一个基底\([A_1,A_2,A_3,E]\).
设射影变换\(\sigma\)的公式为 \labelcref{equation:解析几何.射影映射.射影映射的基底变换公式}.
对于不在直线\(A_1 \allowbreak A_2\)上，并且不在直线\(a_{31} x_1 + a_{32} x_2 + a_{33} x_3 = 0\)上的点\(M(x_1,x_2,x_3)\)，
设它的非齐次射影坐标为\((x,y)\)，
它在\(\sigma\)下的像\(M'(x'_1,x'_2,x'_3)\)的非齐次射影坐标为\((x',y')\).
由于根据非齐次射影坐标的定义有\begin{equation*}
	x' = \frac{x'_1}{x'_3},
	\qquad
	y' = \frac{x'_2}{x'_3},
	\qquad
	x_1 = x x_3,
	\qquad
	x_2 = y x_3,
\end{equation*}
因此由\cref{equation:解析几何.射影映射.射影映射的基底变换公式}
得\begin{gather}
	\rho x'_1 = a_{11} x_1 + a_{12} x_2 + a_{13} x_3,
		\label{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤1} \\
	\rho x'_2 = a_{21} x_1 + a_{22} x_2 + a_{23} x_3,
		\label{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤2} \\
	\rho x'_3 = a_{31} x_1 + a_{32} x_2 + a_{33} x_3,
		\label{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤3}
\end{gather}
将\cref{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤1}
与\cref{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤3} 相除，
将\cref{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤2}
与\cref{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式.中间步骤3} 相除，
得\begin{equation*}
	x'
	= \frac{\rho x'_1}{\rho x'_3}
	= \frac{a_{11} x_1 + a_{12} x_2 + a_{13} x_3}{a_{21} x_1 + a_{22} x_2 + a_{23} x_3},
	\qquad
	y'
	= \frac{\rho x'_2}{\rho x'_3}
	= \frac{a_{21} x_1 + a_{22} x_2 + a_{23} x_3}{a_{31} x_1 + a_{32} x_2 + a_{33} x_3},
\end{equation*}
代入\(
	x_1 = x x_3,
	x_2 = y x_3,
\)得\begin{equation*}
	x'
	= \frac{a_{11} (x x_3) + a_{12} (y x_3) + a_{13} x_3}{a_{21} (x x_3) + a_{22} (y x_3) + a_{23} x_3},
	\qquad
	y'
	= \frac{a_{21} (x x_3) + a_{22} (y x_3) + a_{23} x_3}{a_{31} (x x_3) + a_{32} (y x_3) + a_{33} x_3},
\end{equation*}
消去\(x_3\)得\begin{equation}\label{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式}
%@see: 《解析几何》（丘维声） P298 (5.7)
	x' = \frac{a_{11} x + a_{12} y + a_{13}}{a_{31} x + a_{32} y + a_{33}},
	\qquad
	y' = \frac{a_{21} x + a_{22} y + a_{23}}{a_{31} x + a_{32} y + a_{33}}.
\end{equation}
\cref{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式} 是
射影变换\(\sigma\)在非齐次射影坐标中的表达式，
它是分式线性函数，
并且\begin{equation*}
%@see: 《解析几何》（丘维声） P298 (5.8)
	\begin{vmatrix}
		a_{11} & a_{12} & a_{13} \\
		a_{21} & a_{22} & a_{23} \\
		a_{31} & a_{32} & a_{33}
	\end{vmatrix}
	\neq 0.
\end{equation*}
由此可见，射影平面的射影变换用非齐次射影坐标表达时，是平面的分式线性变换.

\subsection{仿射 -- 射影变换}
考虑扩充欧氏平面\(\overline{\pi_0}\)上的、把无穷远直线映成无穷远直线的射影变换，
这样的射影变换称为\DefineConcept{仿射 -- 射影变换}.

取一个仿射 -- 射影变换\(\sigma\)，
在\(\overline{\pi_0}\)上取一个基底 I \([A_1,A_2,A_3,E]\)，
其中\(A_1,A_2\)是无穷远点.
这时点的齐次射影坐标也就是点的齐次仿射坐标，
点的非齐次射影坐标也就是点仿射坐标.
设\(\sigma\)在 I 中的公式仍是\cref{equation:解析几何.射影映射.射影映射的基底变换公式}.
由于无穷远直线\(l_\infty: x_3 = 0\)上的点均为无穷远点，
所以有\begin{equation*}
%@see: 《解析几何》（丘维声） P299 (5.9)
	\lambda
	\begin{bmatrix}
		x'_1 \\ x'_2 \\ 0
	\end{bmatrix}
	= \begin{bmatrix}
		a_{11} & a_{12} & a_{13} \\
		a_{21} & a_{22} & a_{23} \\
		a_{31} & a_{32} & a_{33}
	\end{bmatrix}
	\begin{bmatrix}
		x_1 \\ x_2 \\ 0
	\end{bmatrix}.
\end{equation*}

取\(
	x_1 = 1,
	x_2 = 0
\)，
得\begin{equation*}
	\begin{bmatrix}
		\lambda x'_1 \\ \lambda x'_2 \\ 0
	\end{bmatrix}
	= \begin{bmatrix}
		a_{11} \\
		a_{21} \\
		a_{31}
	\end{bmatrix},
\end{equation*}
从而有\(a_{31} = 0\).

取\(
	x_1 = 0,
	x_2 = 1
\)，
得\begin{equation*}
	\begin{bmatrix}
		\lambda x'_1 \\ \lambda x'_2 \\ 0
	\end{bmatrix}
	= \begin{bmatrix}
		a_{12} \\
		a_{22} \\
		a_{32}
	\end{bmatrix},
\end{equation*}
从而有\(a_{32} = 0\).

于是\(\sigma\)在 I 中的公式成为\begin{equation*}
%@see: 《解析几何》（丘维声） P299 (5.10)
	\lambda
	\begin{bmatrix}
		x'_1 \\ x'_2 \\ x'_3
	\end{bmatrix}
	= \begin{bmatrix}
		a_{11} & a_{12} & a_{13} \\
		a_{21} & a_{22} & a_{23} \\
		0 & 0 & a_{33}
	\end{bmatrix}
	\begin{bmatrix}
		x_1 \\ x_2 \\ x_3
	\end{bmatrix}.
\end{equation*}

由于\(\sigma\)的公式中系数矩阵应该是非奇异的，
因此有\begin{equation*}
	a_{33}
	\begin{vmatrix}
		a_{11} & a_{12} \\
		a_{21} & a_{22}
	\end{vmatrix}
	\neq 0,
\end{equation*}
从而\(a_{33} \neq 0\).

令\begin{equation*}
	\lambda'
	\defeq
	\frac{\lambda}{a_{33}}
	\qquad
	c_{ij}
	\defeq
	\frac{a_{ij}}{a_{33}}
	\quad(i,j=1,2,3),,
\end{equation*}
则\(\sigma\)在 I 中的公式又可以写成\begin{equation}\label{equation:解析几何.射影映射.仿射射影变换的公式}
%@see: 《解析几何》（丘维声） P299 (5.11)
	\lambda'
	\begin{bmatrix}
		x'_1 \\ x'_2 \\ x'_3
	\end{bmatrix}
	= \begin{bmatrix}
		c_{11} & c_{12} & c_{13} \\
		c_{21} & c_{22} & c_{23} \\
		0 & 0 & 1
	\end{bmatrix}
	\begin{bmatrix}
		x_1 \\ x_2 \\ x_3
	\end{bmatrix}.
\end{equation}
并且\begin{equation}\label{equation:解析几何.射影映射.仿射射影变换的公式的系数行列式不等于零}
%@see: 《解析几何》（丘维声） P299 (5.12)
	\begin{vmatrix}
		c_{11} & c_{12} \\
		c_{21} & c_{22}
	\end{vmatrix}
	\neq 0.
\end{equation}

现在考虑\(\overline{\pi_0}\)上的任意一个通常点\(M(x_1,x_2,x_3)\).
设它的仿射坐标为\((x,y)\)，
则\begin{equation*}
	x = \frac{x_1}{x_3},
	\qquad
	y = \frac{x_2}{x_3}.
\end{equation*}
设\(M\)在\(\sigma\)下的像\(M'\)（\(M'\)一定是通常点）的仿射坐标\((x',y')\).
由\(\sigma\)用非齐次射影坐标表达的\cref{equation:解析几何.射影映射.射影变换在非齐次射影坐标中的表达式}
得\begin{equation}\label{equation:解析几何.射影映射.射影平面上通常点在仿射射影变换下的像点的仿射坐标}
%@see: 《解析几何》（丘维声） P300 (5.13)
	\begin{cases}
		x'
		% = \frac{a_{11} x + a_{12} y + a_{13}}{a_{31} x + a_{32} y + a_{33}}
		% = \frac{a_{11} x + a_{12} y + a_{13}}{0 x + 0 y + a_{33}}
		= c_{11} x + c_{12} y + c_{13}, \\
		y'
		% = \frac{a_{21} x + a_{22} y + a_{23}}{a_{31} x + a_{32} y + a_{33}}
		% = \frac{a_{21} x + a_{22} y + a_{23}}{0 x + 0 y + a_{33}}
		= c_{21} x + c_{22} y + c_{23}.
	\end{cases}
\end{equation}
由\cref{equation:解析几何.射影映射.仿射射影变换的公式的系数行列式不等于零} 可知，
\cref{equation:解析几何.射影映射.射影平面上通常点在仿射射影变换下的像点的仿射坐标} 的系数矩阵是非奇异的.
这说明，射影平面\(\overline{\pi_0}\)上的仿射 -- 射影变换\(\sigma\)
在欧氏平面\(\pi_0\)上的限制
就是仿射变换 \labelcref{equation:解析几何.射影映射.射影平面上通常点在仿射射影变换下的像点的仿射坐标}.
在这个意义上，我们可以说：仿射变换是特殊的射影变换.
