\chapter{数列}
\section{数列的概念}
\begin{definition}\label{definition:数列.数列的定义}
一般地，如果\(D \subseteq \mathbb{Z}\)，
那么把映射\begin{equation*}
    f\colon D\to\mathbb{R}, n \mapsto a_n
\end{equation*}称为一个\DefineConcept{数列}（sequence，progression），
记作\(\{a_n\}\)，即\(\{a_n\} \defeq f\).

数列中的每一个数（例如\(\AutoTuple{a}{0}\)）叫做数列的\DefineConcept{项}（term）.

把表示第\(n\)个数\(a_n\)的公式称为“数列\(\{a_n\}\)的\DefineConcept{一般项}”.
\end{definition}

应该指出，如果我们说“数列\(\{x_n\}\)在数集\(X\)内”或\(\{x_n\} \subseteq X\)，
我们指的是：把数列\(\{x_n\}\)看作一个映射\(f\)时，
这个映射的值域\(\ran f\)是\(X\)的子集，即\(\ran f \subseteq X\).

\begin{definition}
如果数列\(\{x_n\}\)满足条件\begin{equation*}
	x_n \leq x_{n+1}, \quad n=1,2,\dotsc,
\end{equation*}
就称“数列\(\{x_n\}\)是\DefineConcept{单调增加的}（monotonically increasing）”.

如果数列\(\{x_n\}\)满足条件\begin{equation*}
	x_n \geq x_{n+1}, \quad n=1,2,\dotsc,
\end{equation*}
就称“数列\(\{x_n\}\)是\DefineConcept{单调减少的}（monotonically decreasing）”.

单调增加数列和单调减少数列统称为\DefineConcept{单调数列}.
如果数列\(\{x_n\}\)是单调数列，则称“\(\{x_n\}\)具有单调性”.
\end{definition}

\begin{definition}
如果数列\(\{x_n\}\)满足\begin{equation*}
	(\forall n \geq N)[x_n \leq x_{n+1}],
\end{equation*}
则称“数列\(\{x_n\}\)从第\(N\)项起单调增加”.

如果数列\(\{x_n\}\)满足\begin{equation*}
	(\forall n \geq N)[x_n \geq x_{n+1}],
\end{equation*}
则称“数列\(\{x_n\}\)从第\(N\)项起单调减少”.
\end{definition}

\begin{proposition}
设数列\(\{x_n\}\)满足\begin{equation*}
	(x_{n+1}-x_n)(x_n-x_{n-1})>0
	\quad(n=2,3,\dotsc),
\end{equation*}
则\(\{x_n\}\)具有单调性.
\end{proposition}

\begin{definition}[数列的有界性]
设数列\(\{x_n\}\).

如果\begin{equation*}
	(\exists M>0)
	(\forall n\in\mathbb{N})
	[\abs{x_n} \leq M],
\end{equation*}
那么称“数列\(\{x_n\}\)是\DefineConcept{有界的}”.

如果这样的正数\(M\)不存在，即\begin{equation*}
	(\forall M>0)
	(\exists n\in\mathbb{N})
	[\abs{x_n} > M],
\end{equation*}
那么称“数列\(\{x_n\}\)是\DefineConcept{无界的}”.
\end{definition}

例如，数列\(x_n = \frac{n}{n+1}\ (n=1,2,\dotsc)\)是有界的，
因为可取\(M=1\)，而使\begin{equation*}
	\abs{\frac{n}{n+1}} \leq 1
\end{equation*}对于一切正整数\(n\)都成立.

数列\(x_n = 2^n\ (n=1,2,\dotsc)\)是无界的，因为当\(n\)无限增加时，\(2^n\)可超过任何正数.

\begin{definition}
%@see: 《数学分析（第二版 上册）》（陈纪修） P62 定义2.4.2
设\(\{a_n\}\)是数列，
我们把\(\{a_n\}\)的子集称为“\(\{a_n\}\)的\DefineConcept{子列}”.
\end{definition}
我们常把数列\(\{a_n\}\)的子列记作\(\{a_{n_k}\}\)，
这里下标\(n_k\)表示子列中的第\(k\)项恰好是原数列\(\{a_n\}\)中的第\(n_k\)项.
应该注意到，由于子列下标\(n_k\)是严格单调增加的，
所以\begin{equation*}
	(\forall k\in\mathbb{N}^+)
	[n_k \geq k],
\end{equation*}
且\begin{equation*}
	(\forall i,j\in\mathbb{N}^+)
	[i \geq j \implies n_i \geq n_j].
\end{equation*}

\section{数列的连加与连乘}
\subsection{数列的连加}
\begin{definition}[连加]
定义\DefineConcept{连续求和}：\begin{equation*}
	\sum_{i=m}^n a_i
	\defeq
	a_m + a_{m+1} + \dotsb + a_{n-1} + a_n
	\quad(m \leq n),
\end{equation*}
其中符号\(\sum\)称作\DefineConcept{连加号}，
符号\(i\)称为\DefineConcept{求和指标}（index of summation），
整数\(m\)称为\DefineConcept{求和下限}（lower bound），
整数\(n\)称为\DefineConcept{求和上限}（upper bound），
符号\(a_i\)称为\DefineConcept{求和通项}（summand）.
\end{definition}

\begin{figure}[htb]
	\centering
	\begin{tikzpicture}
		\draw(0,0)node{$\sum_{
			{\textcolor{red}i}
			=
			{\textcolor{blue}m}
		}^{\textcolor{yellow-green}n} x_i$};
		\draw(-.2,1)node{\textcolor{yellow-green}{求和上限}};
		\draw(-1.5,-.5)node{\textcolor{red}{求和指标}};
		\draw(1.1,-.5)node{\textcolor{blue}{求和下限}};
	\end{tikzpicture}
	\caption{}
\end{figure}

有时候也把\(\sum_{i=m}^n\)%
写作\(\sum_{m \leq i \leq n}\).

使用双重连加号求和时，如果两个求和指标独立取值，则连加号\(\sum\)的顺序可以交换.

在不引起误解的情况下，可以省略不写求和指标，
例如用\(\sum a_n\)表示\(\sum_{k=1}^n a_k\).

\subsection{数列的连乘}
\begin{definition}[连乘]
定义\DefineConcept{连续求积}：\begin{equation*}
	\prod_{i=m}^n a_i
	\defeq
	a_m \times a_{m+1} \times \dotsb \times a_{n-1} \times a_n
	\quad(m \leq n),
\end{equation*}
其中符号\(\prod\)称作\DefineConcept{连乘号}，
整数\(i\)称为\DefineConcept{求积指标}.
\end{definition}

同样地，有时候也把\(\prod_{i=m}^n\)%
写作\(\prod_{m \leq i \leq n}\).

\begin{definition}\label{definition:数列.阶乘的定义}
给定一个正整数\(n\)，
称所有小于或等于\(n\)的正整数的积为“\(n\)的\DefineConcept{阶乘}（factorial）”，
记作\(n!\)，即
\begin{equation}
	n!
	\defeq
	\prod_{k=1}^n k
	=
	n \times (n-1) \times (n-2) \times \dotsm \times 2 \times 1.
\end{equation}
特别地，规定\(0! = 1\).
\end{definition}

\begin{table}[htb]
	\centering
	\begin{subtable}[ht]{.3\textwidth}
		\centering
		\begin{tblr}{rcr}
			\hline
			0! & = & 1 \\
			1! & = & 1 \\
			2! & = & 2 \\
			3! & = & 6 \\
			4! & = & 24 \\
			5! & = & 120 \\
			6! & = & 720 \\
			7! & = & 5~040 \\
			8! & = & 40~320 \\
			9! & = & 362~880 \\
			\hline
		\end{tblr}
		\caption{}
	\end{subtable}~\begin{subtable}[ht]{.6\textwidth}
		\centering
		\begin{tblr}{rcr|rcr}
			\hline
			0!! & = & 1 & 1!! & = & 1 \\
			2!! & = & 2 & 3!! & = & 3 \\
			4!! & = & 8 & 5!! & = & 15 \\
			6!! & = & 48 & 7!! & = & 105 \\
			8!! & = & 384 & 9!! & = & 945 \\
			10!! & = & 3~840 & 11!! & = & 10~395 \\
			12!! & = & 46~080 & 13!! & = & 135~135 \\
			14!! & = & 645~120 & 15!! & = & 2~027~025 \\
			16!! & = & 10~321~920 & 17!! & = & 34~459~425 \\
			18!! & = & 185~794~560 & 19!! & = & 654~729~075 \\
			\hline
		\end{tblr}
		\caption{}
	\end{subtable}
	\caption{}
%@Mathematica: Table[{n, n!}, {n, 0, 9}]
%@Mathematica: Table[{n, n!!}, {n, 0, 20, 2}]
%@Mathematica: Table[{n, n!!}, {n, 1, 20, 2}]
\end{table}

\begin{definition}
给定一个正整数\(n\)，
称小于或等于\(n\)且与之同奇偶的所有正整数的积为“\(n\)的\DefineConcept{双阶乘}”，
记作\(n!!\)，即
\begin{equation}
	n!!
	\defeq
	\begin{cases}
		n \times (n-2) \times (n-4) \times \dotsm \times 3 \times 1, & n\text{是奇数}, \\
		n \times (n-2) \times (n-4) \times \dotsm \times 4 \times 2, & n\text{是偶数}.
	\end{cases}
\end{equation}
特别地，规定\(0!! = 1\).
\end{definition}

需要注意的是，通常来说双阶乘\(n!!\)并不等于“阶乘的阶乘”\((n!)!\)，
实际上，\(3!! = 3\)而\((3!)! = 6! = 720\).

\section{等差数列}
一般地，如果一个数列从第2项起，每一项与它的前一项的差等于同一个常数，
这个数列就叫做\DefineConcept{等差数列}（arithmetical progression），
这个常数叫做等差数列的\DefineConcept{公差}（common difference）.

如果数列\(\{a_n\}\)是等差数列，它的公差是\(d\)，那么\begin{align*}
    a_2 &= a_1 + d, \\
    a_3 &= a_2 + d = (a_1 + d) + d = a_1 + 2d, \\
    a_4 &= a_3 + d = (a_1 + 2d) + d = a_1 + d3.
\end{align*}
以此类推，可知等差数列\(\{a_n\}\)的\DefineConcept{通项公式}是\begin{equation}
    a_n = a_1 + (n-1) d.
\end{equation}

将等差数列中任意两项\begin{equation*}
    a_m = a_1 + (m-1) d
    \quad\text{与}\quad
    a_n = a_1 + (n-1) d
\end{equation*}相减，得到\begin{equation*}
    a_m - a_n = (m-n) d.
\end{equation*}
由此我们也可得到%
等差数列的\DefineConcept{递推公式}：\begin{equation}
    a_{n+1} - a_n = d.
\end{equation}

\begin{theorem}
设\(\{a_n\}\)是以\(d\)为公差的等差数列，
则\begin{gather*}
	\text{$\{a_n\}$是单调增加数列}
	\iff
	d > 0, \\
	\text{$\{a_n\}$是单调减少数列}
	\iff
	d < 0, \\
	\text{$\{a_n\}$是常数列}
	\iff
	d = 0.
\end{gather*}
\end{theorem}

\begin{property}
设数列\(\{a_n\}\)是等差数列，
则\begin{gather}
	a_1 + a_{2k} = a_k + a_{k+1}, \\
	a_1 + a_{2k-1} = 2 a_k.
\end{gather}
\end{property}

\begin{property}[等差数列求和]
设数列\(\{a_n\}\)为等差数列，它的通项公式为\begin{equation*}
    a_n = a_1 + (n-1) d,
\end{equation*}
那么它的前\(n\)项和为\begin{equation}\label{equation:数列.等差数列的前n项和1}
    S_n = \frac{n(a_1 + a_n)}{2},
\end{equation}
或\begin{equation}\label{equation:数列.等差数列的前n项和2}
    S_n = n a_1 + \frac{n(n-1)}{2} d.
\end{equation}
\begin{proof}
将\begin{equation*}
	a_1 = a_1,
	a_2 = a_1 + d,
	\dotsc,
	a_{n-1} = a_1 + (n-2)d,
	a_n = a_1 + (n-1)d
\end{equation*}
相加得\begin{equation*}
    S_n = a_1 + (a_1 + d) + \dotsb + [a_1 + (n-2)d] + [a_1 + (n-1)d].
	\eqno(1)
\end{equation*}

将\begin{equation*}
	a_n = a_n,
	a_{n-1} = a_n - d,
	\dotsc,
	a_2 = a_n - (n-2)d,
	a_1 = a_n - (n-1)d
\end{equation*}
相加得\begin{equation*}
    S_n = a_n + (a_n - d) + \dotsb + [a_n - (n-2)d] + [a_n - (n-1)d].
	\eqno(2)
\end{equation*}

将(1)(2)两式相加得\begin{align*}
    2 S_n
	&= (a_1 + a_n)
		+ (a_1 + d + a_n - d)
		+ \dotsb \\
	&\hspace{20pt}
		+ [a_1 + (n-2)d + a_n - (n-2)d]
		+ [a_1 + (n-1)d + a_n - (n-1)d] \\
	&= \underbrace{(a_1 + a_n) + (a_1 + a_n) + \dotsb + (a_1 + a_n) + (a_1 + a_n)}_{\text{$n$个}} \\
	&= n(a_1 + a_n).
\end{align*}
于是\begin{equation*}
    S_n
	= \frac{n(a_1 + a_n)}{2}.
	\eqno(3)
\end{equation*}
把\(a_n = a_1 + (n-1)d\)代入(3)式，
便得\begin{equation*}
	S_n
	= n a_1 + \frac{n(n-1)}{2} d
    \qedhere
\end{equation*}
\end{proof}
\end{property}

根据\hyperref[equation:数列.等差数列的前n项和1]{等差数列的前\(n\)项和公式}，立即有如下结论：
\begin{equation}
    \sum_{k=1}^n k = \frac{1}{2} n(n+1).
\end{equation}

\begin{property}
设数列\(\{a_n\}\)是以\(d\)为公差的等差数列，
\(b\)是常数，
则\(\{b + a_n\}\)也是以\(d\)为公差的等差数列.
\end{property}

\begin{property}
设数列\(\{a_n\}\)是以\(d\)为公差的等差数列，
\(b\)是常数，
则\(\{b \cdot a_n\}\)是以\(b d\)为公差的等差数列.
\end{property}

\begin{example}
设\(\{a_n\}\)是等差数列.
证明：如果正整数\(m,n,p,q\)满足\(m+n=p+q\)，
则\begin{equation*}
	a_m+a_n=a_p+a_q.
\end{equation*}
\begin{proof}
设\(\{a_n\}\)的公差是\(d\)，
则\(a_m-a_p = (m-p)d\).
由\(m+n=p+q\)
移项得\(m-p=q-n\)，
于是\(a_m-a_p = a_q-a_n\)，
因此\(a_m+a_n=a_p+a_q\).
\end{proof}
\end{example}

\begin{example}
设\(\{a_n\}\)是公差为\(d\)的等差数列.
证明：\(S_k,S_{2k}-S_k,S_{3k}-S_{2k},\dotsc\)成为等差数列，
它的公差为\(k^2 d\).
\begin{proof}
既然\(S_n = n a_1 + \frac12 n(n-1) d\ (n=1,2,\dotsc)\)，
那么\begin{align*}
	&\hspace{-20pt}
	(S_{2k}-S_k) - S_k
	= S_{2k} - 2 S_k \\
	&= 2k a_1 + \frac12 (2k)(2k-1) d
	- 2 k a_1 - k(k-1) d \\
	&= k^2 d, \\
	&\hspace{-20pt}
	[S_{(m+1)k}-S_{mk}] - [S_{mk}-S_{(m-1)k}]
	= S_{(m+1)k} - 2 S_{mk} + S_{(m-1)k} \\
	&= (mk+k) a_1 + \frac12 (mk+k)(mk+k-1) d \\
	&\hspace{20pt}
	- 2 mk a_1 - mk (mk-1) d \\
	&\hspace{20pt}
	+ (mk-k) a_1 + \frac12 (mk-k)(mk-k-1) d \\
	&= k^2 d.
	\qedhere
\end{align*}
\end{proof}
\end{example}

\begin{example}
设数列\(\{a_n\}\)的前\(n\)项和为\(S_n\).
证明：\(\left\{\frac{S_n}{n}\right\}\)是等差数列.
\begin{proof}
设\(\{a_n\}\)的公差是\(d\).
因为\(S_n=\frac{n}2(a_1+a_n)\)，
所以\(\frac{S_n}{n}=\frac12(a_1+a_n)\)，
从而\begin{equation*}
	\frac{S_{n+1}}{n+1}-\frac{S_n}{n}
	= \frac12(a_1+a_{n+1})-\frac12(a_1+a_n)
	= \frac12(a_{n+1}-a_n)
	= \frac{d}2.
\end{equation*}
这就说明\(\left\{\frac{S_n}{n}\right\}\)是公差为\(\frac{d}2\)的等差数列.
\end{proof}
\end{example}

\begin{example}
设数列\(\{a_n\}\)的前\(n\)项和\(S_n = a_1 + a_2 + \dotsb + a_n\)满足\begin{equation*}
	S_n = A n^2 + B n + C,
\end{equation*}
其中\(A,B,C\)是常数.
证明：\begin{itemize}
	\item 若\(C = 0\)，则\(\{a_n\}\)是等差数列.
	\item 若\(C \neq 0\)，则\(\{a_n\}\)从第二项起成为等差数列.
\end{itemize}
\begin{proof}
首先\begin{equation*}
	a_1 = S_1 = A + B + C, \qquad
	a_n = 2A n + (B-A), \quad n=2,3,\dotsc,
\end{equation*}
于是\begin{equation*}
	a_2 - a_1
	= 2A - C, \qquad
	a_{n+1} - a_n
	= 2A, \quad n=2,3,\dotsc.
\end{equation*}
因此\begin{equation*}
	\text{\(\{a_n\}\)是等差数列}
	\iff
	a_2 - a_1 = a_3 - a_2
	\iff
	2A - C = 2A
	\iff
	C = 0.
	\qedhere
\end{equation*}
\end{proof}
\end{example}

\begin{example}
设\(\{a_n\},\{b_n\}\)都是等差数列.
证明：\(\{a_{b_n}\}\)也是等差数列.
\begin{proof}
设\(\{a_n\},\{b_n\}\)的公差分别为\(d_1,d_2\)，
则\begin{equation*}
	a_{b_{n+1}}-a_{b_n}
	=(b_{n+1}-b_n)d_1
	=d_1 d_2,
\end{equation*}
这就说明\(\{a_{b_n}\}\)是公差为\(d_1 d_2\)的等差数列.
\end{proof}
\end{example}

\begin{example}
设\(\{a_n\},\{b_n\}\)都是等差数列.
证明：\(\{p a_n + q b_n\}\)也是等差数列，其中\(p,q\)是常数.
\begin{proof}
设\(\{a_n\},\{b_n\}\)的公差分别为\(d_1,d_2\)，
则\begin{equation*}
	(p a_{n+1} + q b_{n+1})
	- (p a_n + q b_n)
	= p (a_{n+1} - a_n)
	+ q (b_{n+1} - b_n)
	= p d_1 + q d_2,
\end{equation*}
这就说明\(\{a_{b_n}\}\)是公差为\(p d_1 + q d_2\)的等差数列.
\end{proof}
\end{example}

\section{平方数列}
如果数列\(\{a_n\}\)的通项公式是\begin{equation*}
a_n = n^2,
\end{equation*}那么称其为\DefineConcept{平方数列}.

由立方差公式可知
\begin{equation*}\begin{aligned}
n^3 - (n-1)^3
&= [n - (n-1)] \cdot [n^2 + n(n-1) + (n-1)^2] \\
&= 2n^2 + (n-1)^2 - n.
\end{aligned}\end{equation*}于是将\begin{equation*}
\begin{array}{l}
2^3 - 1^3 = 2\times2^2+1^2-2, \\
3^3 - 2^3 = 2\times3^2+2^2-3, \\
\hdotsfor{1} \\
n^3 - (n-1)^3 = 2n^2 + (n-1)^2 - n,
\end{array}
\end{equation*}相加便得\begin{equation*}\begin{aligned}
n^3 - 1^3
&= 2(2^2+3^2+\dotsb+n^2) + [1^2+2^2+\dotsb+(n-1)^2] - (2+3+\dotsb+n) \\
&= 2\left(\sum_{k=1}^n k^2 - 1\right)
    + \left(\sum_{k=1}^n k^2 - n^2\right)
    - \left(\sum_{k=1}^n k - 1\right) \\
&= 3\sum_{k=1}^n k^2 - 2 - n^2 - \frac{n(n+1)}{2} + 1 \\
&= 3\sum_{k=1}^n k^2 - \frac{3}{2} n^2 - \frac{1}{2} n - 1,
\end{aligned}\end{equation*}
移项，得\begin{equation*}
3 \sum_{k=1}^n k^2
= n^3 + \frac{3}{2} n^2 + \frac{1}{2} n
= \frac{1}{2} n (n+1) (2n+1).
\end{equation*}
因此，平方数列的前\(n\)项之和为
\begin{equation}
	\sum_{k=1}^n a_n
	= \sum_{k=1}^n k^2
	= \frac{1}{6} n(n+1)(2n+1).
\end{equation}

\begin{example}
求在正方形底上排成完整棱锥体的小球个数.
\begin{solution}
设底部每边有\(n\)个小球，则最底层小球的个数为\(n^2\)个；
从下往上数，第二层有\((n-1)^2\)个小球，
第三层有\((n-2)^2\)个小球，
以此类推，直至顶层只有一个小球.
因此，棱锥体的小球个数为\begin{equation*}
    S = n^2+(n-1)^2+(n-2)^2+\dotsb+1
    = \frac{n(n+1)(2n+1)}{6}.
\end{equation*}
\end{solution}
\end{example}

\begin{example}
求在等边三角形底上排成完整棱锥体的小球个数.
\begin{solution}
设底部每边有\(n\)个小球，则最底层小球的个数为\begin{equation*}
    n+(n-1)+(n-2)+\dotsb+1
    = \frac{n(n+1)}{2}
    = \frac{1}{2}(n^2+n).
\end{equation*}
在上式中以\((n-1),(n-2),\dotsc\)替代\(n\)，
就得到了从下往上数从第二层开始直至最顶层的小球个数.
因此，棱锥体的小球个数为\begin{equation*}
    S = \frac{1}{2} (\sum n^2 + \sum n)
    = \frac{n(n+1)(n+2)}{6}.
\end{equation*}
\end{solution}
\end{example}

\section{立方数列}
如果数列\(\{a_n\}\)的通项公式是\begin{equation*}
a_n = n^3,
\end{equation*}那么称其为\DefineConcept{立方数列}.

由平方差公式可知
\begin{equation*}\begin{aligned}
n^4 - (n-1)^4
&= [n^2 - (n-1)^2] [n^2 + (n-1)^2] \\
&= [n - (n-1)] [n + (n-1)] [n^2 + (n-1)^2] \\
&= (2n-1) (2n^2 - 2n + 1) \\
&= 4n^3 - 6n^2 + 4n - 1.
\end{aligned}\end{equation*}
于是\begin{equation*}
\sum_{k=1}^n [k^4 - (k-1)^4]
= \sum_{k=1}^n (4k^3 - 6k^2 + 4k - 1),
\end{equation*}即\begin{equation*}\begin{aligned}
n^4
&= 4 \sum_{k=1}^n k^3 - 6 \sum_{k=1}^n k^2 + 4 \sum_{k=1}^n k - n \\
&= 4 \sum_{k=1}^n k^3 - n(n+1)(2n+1) + 2n(n+1) - n,
\end{aligned}\end{equation*}
移项，得\begin{equation*}
4 \sum_{k=1}^n k^3
= n^4 + n(n+1)(2n+1) - 2n(n+1) + n
= n^4 + 2n^3 + n^2
= n^2(n+1)^2.
\end{equation*}
因此，立方数列的前\(n\)项之和为
\begin{equation}
\sum_{k=1}^n a_n
= \sum_{k=1}^n k^3
= \left[\frac{n(n+1)}{2}\right]^2.
\end{equation}

\section{等比数列}
\begin{definition}
如果数列\(\{a_n\}\)满足\begin{equation*}
	a_n = a q^{n-1} \quad(a\neq0,q\neq1),
\end{equation*}
则称该数列为\DefineConcept{等比数列}
或\DefineConcept{几何数列}（geometrical progression），
其中\(q\)称作\DefineConcept{公比}.

等比数列的递推公式为\(\frac{a_n}{a_{n-1}} = q\ (n \geq 2)\).
\end{definition}

将等比数列中任意两项\begin{equation*}
    a_m = a_1 q^{m-1}
    \quad\text{与}\quad
    a_n = a_1 q^{n-1}
\end{equation*}相除，
得到\begin{equation*}
    \frac{a_m}{a_n} = q^{m-n}.
\end{equation*}
由此我们也可得到等比数列的\DefineConcept{递推公式}：
\begin{equation}
	a_{n+1} = a_n q.
\end{equation}

\begin{property}[等比数列求和]\label{theorem:等比数列.前n项和}
设数列\(\{a_n\}\)是等比数列，
\(a_n = a q^{n-1}\ (n=1,2,\dotsc)\)，
则有\begin{equation}
	\sum_{i=1}^n a_i
	= \left\{ \begin{array}{cl}
		\frac{a (q^n-1)}{q-1}, & q \neq 1, \\
		na, & q = 1.
	\end{array} \right.
\end{equation}
\begin{proof}
记\(S_n = \sum_{k=1}^n a_k
= a + aq + aq^2 + \dotsb + aq^{n-1}\)，
于是\begin{equation*}
	S_{n+1} - S_n = aq^n.
	\eqno(1)
\end{equation*}

当\(q = 1\)时，显然有\(S_n = na\).

当\(q \neq 1\)时，有\begin{equation*}
	q S_n
	= aq+aq^2+aq^3+\dotsb+aq^n,
	\eqno(2)
\end{equation*}\begin{equation*}
	S_{n+1}
	= a+aq+aq^2+\dotsb+aq^{n-1}+aq^n,
	\eqno(3)
\end{equation*}
用(3)式减去(2)式便得\begin{equation*}
	S_{n+1} - q S_n
	= a.
	\eqno(4)
\end{equation*}
联立(1)(4)两式，得到关于\(S_n,S_{n+1}\)的二元一次方程组，
解得\begin{equation*}
	S_n = \frac{
		\begin{vmatrix}
			1 & a \\
			1 & a q^n
		\end{vmatrix}
	}{
		\begin{vmatrix}
			1 & -q \\
			1 & -1
		\end{vmatrix}
	}
	= \frac{a(q^n - 1)}{q-1}.
	\qedhere
\end{equation*}
\end{proof}
\end{property}

\begin{property}
设数列\(\{a_n\}\)是以\(d\)为公差的等差数列，
\(b\)是非零常数，
则\(\{b^{a_n}\}\)是等比数列.
\begin{proof}
易见\begin{equation*}
	\frac{b^{a_{n+1}}}{b^{a_n}}
	= b^{a_{n+1}-a_n}
	= b^d,
\end{equation*}
这就说明\(\{b^{a_n}\}\)是以\(b^d\)为公比的等比数列.
\end{proof}
\end{property}

\begin{example}
设\(\{a_n\}\)是等比数列.
证明：如果正整数\(m,n,p,q\)满足\(m+n=p+q\)，
则\begin{equation*}
	a_m \cdot a_n = a_p \cdot a_q.
\end{equation*}
\begin{proof}
设\(\{a_n\}\)的公比是\(q\)，
则\(a_m / a_p = q^{m-p}\).
由\(m+n=p+q\)
移项得\(m-p=q-n\)，
于是\(a_m / a_p = a_q / a_n\)，
因此\(a_m \cdot a_n=a_p \cdot a_q\).
\end{proof}
\end{example}

\begin{property}
设数列\(\{a_n\}\)为等比数列，\(b\)为常数，则：
\begin{itemize}
    \item \(\{b \cdot a_n\}\)为等比数列，它的公比与\(\{a_n\}\)的一样；
    \item \(\{b / a_n\}\)为等比数列，它的公比是\(\{a_n\}\)的公比的倒数；
    \item \(\{\log_b a_n\}\)为等差数列.
\end{itemize}
\end{property}

\begin{example}
求级数\begin{equation*}
    a,(a+d)r,(a+2d)r^2,(a+3d)r^3,\dotsc
\end{equation*}的前\(n\)项之和.
\begin{solution}
设所求级数的前\(n\)项之和为\begin{equation*}
    S_n = \sum_{k=0}^{n-1} (a+kd) r^k.
    \eqno(1)
\end{equation*}
那么\begin{equation*}
    r S_n = \sum_{k=0}^{n-1} (a+kd) r^{k+1}.
    \eqno(2)
\end{equation*}
将(1)式与(2)式相减，得\begin{align*}
    S_n(1-r) &= a + (dr + dr^2 + \dotsb + dr^{n-1}) - [a+(n-1)d] r^n \\
    &= a + \frac{dr(1-r^{n-1})}{1-r} - [a+(n-1)d] r^n.
\end{align*}
于是\begin{equation*}
    S_n = \frac{a}{1-r} + \frac{dr(1-r^{n-1})}{(1-r)^2} - \frac{[a+(n-1)d] r^n}{1-r}.
\end{equation*}
\end{solution}
\end{example}

\section{调和数列}
若数列\(\{a_n\}\)每相邻三项满足\begin{equation*}
    \frac{a_{n+1}}{a_{n-1}}
    = \frac{a_{n+1}-a_n}{a_n-a_{n-1}},
\end{equation*}
则称其为\DefineConcept{调和数列}（harmonical progression）\footnote{%
人们对调和数列有兴趣的主要原因是它在几何学与声学中有其重要性.
调和数列的若干项求和无一般公式可循.
通常来说，涉及调和数列的问题的解法都是将它的各项倒转，再利用对应的等差数列的性质.
}；
称\(a_n\)为“\(a_{n-1}\)和\(a_{n+1}\)的\DefineConcept{调和中项}或\DefineConcept{调和平均数}”.

\begin{property}\label{theorem:数列.调和数列的性质}
调和数列\(\{a_n\}\)各项的倒数组成的数列\(\{1/a_n\}\)是等差数列.
\begin{proof}
根据调和数列的定义可知，\begin{equation*}
    \frac{a_{n+1}}{a_{n-1}}
    = \frac{a_{n+1}-a_n}{a_n-a_{n-1}},
\end{equation*}整理得\begin{equation*}
    a_{n+1} (a_n - a_{n-1})
    = a_{n-1} (a_{n+1} - a_n),
\end{equation*}再同除以\((a_{n+1} \cdot a_n \cdot a_{n-1})\)，得\begin{equation*}
    \frac{1}{a_{n-1}} - \frac{1}{a_n}
    = \frac{1}{a_n} - \frac{1}{a_{n+1}}.
    \qedhere
\end{equation*}
\end{proof}
\end{property}

\begin{example}
求\(a\)与\(b\)的调和平均数.
\begin{solution}
设\(a\)与\(b\)的调和平均数为\(h\).
由\cref{theorem:数列.调和数列的性质} 有\begin{equation*}
    \frac{1}{h} - \frac{1}{a}
    = \frac{1}{b} - \frac{1}{h},
\end{equation*}\begin{equation*}
    \frac{2}{h} = \frac{1}{a} + \frac{1}{b}
    = \frac{a+b}{ab},
\end{equation*}\begin{equation*}
    h = \frac{2ab}{a+b}.
\end{equation*}
\end{solution}
\end{example}

我们知道，两个数\(x\)与\(y\)的算术平均数、几何平均数、调和平均数分别为\begin{equation*}
    A = \frac{x+y}{2}, \qquad
    G = \sqrt{xy}, \qquad
    H = \frac{2xy}{x+y}.
\end{equation*}
由于\begin{equation*}
    A \cdot H = \frac{x+y}{2} \cdot \frac{2xy}{x+y}
    = ab = G^2,
\end{equation*}
所以\(G\)又是\(A\)与\(H\)的几何平均数.
我们还注意到，当\(x,y>0\)且\(x \neq y\)时，\begin{equation*}
    A - G = \frac{x+y}{2} - \sqrt{xy}
    = \frac{x+y-2\sqrt{xy}}{2}
    = \left(\frac{\sqrt{x}-\sqrt{y}}{\sqrt{2}}\right)^2
    > 0,
\end{equation*}
因此我们可以说：
两个正数的算术平均数总大于它们的几何平均数，即\(A > G\).
再考虑到\(G^2 = A H\)，\(G\)是介于\(A\)与\(H\)之间的，于是必有\(G > H\).
综上所述，两个正数的算术平均数、几何平均数、调和平均数的大小依次递减，即\(A > G > H\).

\section{斐波那契数列}
如果数列\(\{a_n\}\)满足\(a_1=a_2=1\)，且\begin{equation*}
a_n = a_{n-1} + a_{n-2} \quad(n\geq3),
\end{equation*}则称该数列为\DefineConcept{斐波那契数列}.

\section{计算部分和的方法}
\subsection{裂项相消法}
\begin{gather}
	\frac1{n(n+k)}
	= \frac1k \left( \frac1n - \frac1{n+k} \right), \\
	\frac1{\sqrt{n}+\sqrt{n+k}}
	= \frac1k \left( \sqrt{n+k} - \sqrt{n} \right), \\
	\frac1{(2n-1)(2n+1)}
	= \frac12 \left( \frac1{2n-1} - \frac1{2n+1} \right), \\
	\frac1{n(n+1)(n+2)}
	= \frac12 \left[ \frac1{n(n+1)} - \frac1{(n+1)(n+2)} \right], \\
	C_n^{m-1} = C_{n+1}^m - C_n^m, \\
	n \cdot n! = (n+1)! - n!.
\end{gather}

\section{已知递推公式求解通项公式的方法}
\subsection{\texorpdfstring{形如\(a_{n+2}=p a_{n+1} + q a_n\ (q\neq0)\)的递推公式}{第一类递推公式}}
对于形如\(a_{n+2}=p a_{n+1} + q a_n\ (q\neq0)\)的递推公式，
我们可以令\begin{equation*}
	\vb{X}_n
	\defeq \begin{bmatrix}
		a_{n+1} \\
		a_n
	\end{bmatrix},
	\qquad
	\vb{A}
	\defeq \begin{bmatrix}
		p & q \\
		1 & 0
	\end{bmatrix},
\end{equation*}
则\(\vb{X}_{n+1} = \vb{A} \vb{X}_n\)，
从而\(\vb{X}_n = \vb{A}^{n-1} \vb{X}_1\).
这样就可以求出通项公式.

现在我们来求\(\vb{A}\)的幂.
此时\(\vb{A}\)的特征多项式为\begin{equation*}
	f(x)
	= \begin{vmatrix}
		x-p & -q \\
		-1 & x
	\end{vmatrix}
	= x^2 - px - q.
\end{equation*}
我们也称这个多项式为递推公式的特征方程.

假设我们求得该方程的两个复根为\(\alpha,\beta\)，
则由韦达定理可知\(p=\alpha+\beta, q=-\alpha\beta\).
注意到\begin{equation*}
	\left\{ \begin{array}{l}
		a_{n+2} - \alpha a_{n+1} = \beta(a_{n+1}-\alpha a_n), \\
		a_{n+2} - \beta a_{n+1} = \alpha(a_{n+1}-\beta a_n),
	\end{array} \right.
\end{equation*}
从而\begin{equation*}
	\left\{ \begin{array}{l}
		a_{n+1} - \alpha a_n = \beta^{n-1} (a_2 - \alpha a_1), \\
		a_{n+1} - \beta a_n = \alpha^{n-1} (a_2 - \beta a_1).
	\end{array} \right.
\end{equation*}

若\(\alpha\neq\beta\)，
解关于\(a_{n+1},a_n\)的线性方程组可得\begin{equation*}
	a_n
	= \frac
		{
			\begin{vmatrix}
				1 & \beta^{n-1}(a_2 - \alpha a_1) \\
				1 & \alpha^{n-1}(a_2 - \beta a_1)
			\end{vmatrix}
		}
		{
			\begin{vmatrix}
				1 & -\alpha \\
				1 & -\beta
			\end{vmatrix}
		}
	= \frac{\beta^{n-1} (a_2 - \alpha a_1) - a^{n-1} (a_2 - \beta a_1)}{\beta-\alpha}.
\end{equation*}

若\(\alpha=\beta\)，
%@credit: {6c42b037-2b65-4e75-9fd2-304c33588bcc} 帮忙找出了以下笔误
则\(a_{n+1} - \alpha a_n = \alpha^{n-1} (a_2 - \alpha a_1)\)，
再由\(q\neq0\)可知\(\alpha,\beta\neq0\)，
进而\begin{equation*}
	\frac{a_{n+1}}{\alpha^{n+1}} - \frac{a_n}{\alpha^n}
	= \frac{1}{\alpha^2}(a_2-\alpha a_1),
\end{equation*}
显然\(\{a_n/\alpha^n\}\)是一个等差数列，
最后得到\begin{equation*}
	a_n = (2-n)\alpha^{n-1} a_1 + (n-1) \alpha^{n-2} a_2.
\end{equation*}

利用上述结论可以求出斐波那契数列的通项公式为\begin{equation*}
	a_n = \frac{1}{\sqrt{5}} \left[
		\left(\frac{1+\sqrt{5}}{2}\right)^n
		-\left(\frac{1-\sqrt{5}}{2}\right)^n
	\right].
\end{equation*}

\subsection{\texorpdfstring{形如\(a_{n+1} = \frac{a a_n + b}{c a_n + d}\ (ad-bc\neq0)\)的递推公式}{第二类递推公式}}
对于形如\(a_{n+1} = \frac{a a_n + b}{c a_n + d}\ (ad-bc\neq0)\)的递推公式\footnote{
	这里\(ad-bc\neq0\)确保分式不可能恒为常数（即分式不能约分）.
}，
首先考虑特征方程\begin{equation*}
	x = \frac{ax+b}{cx+d},
\end{equation*}
整理得\begin{equation*}
	cx^2+(d-a)x-b=0,
\end{equation*}
解得\begin{equation*}
	\alpha=\frac{(a-d)-\sqrt{(d-a)^2+4bc}}{2c}, \qquad
	\beta=\frac{(a-d)+\sqrt{(d-a)^2+4bc}}{2c}.
\end{equation*}
由韦达定理，
有\begin{equation*}
	\alpha+\beta=\frac{a-d}{c}, \qquad
	\alpha\beta=-\frac{b}{c};
\end{equation*}
因此\begin{equation*}
	a_{n+1} = \frac{\left(\alpha+\beta+\frac{d}{c}\right) a_n - \alpha\beta}{a_n + \frac{d}{c}}.
\end{equation*}

接下来分成两种情况讨论：\begin{enumerate}
	\item 若\(\alpha\neq\beta\)，
	则\begin{equation*}
		\frac{a_{n+1}-\alpha}{a_{n+1}-\beta}
		= \frac
			{
				\left(\alpha+\beta+\frac{d}{c}\right) a_n - \alpha\beta - \alpha \left(a_n + \frac{d}{c}\right)
			}
			{
				\left(\alpha+\beta+\frac{d}{c}\right) a_n - \alpha\beta - \beta \left(a_n + \frac{d}{c}\right)
			}
		= \frac{c\beta+d}{c\alpha+d} \frac{a_n-\alpha}{a_n-\beta}.
	\end{equation*}
	记\(b_n = \frac{a_n-\alpha}{a_n-\beta}\)，
	则\(b_{n+1} = \frac{c\beta+d}{c\alpha+d} b_n\).

	\item 若\(\alpha=\beta=\frac{a-d}{2c}\)，
	则\begin{equation*}
		a_{n+1} = \frac{\left(2\alpha+\frac{d}{c}\right) a_n - \alpha^2}{a_n + \frac{d}{c}}
		= \frac{(2c\alpha+d)a_n-c\alpha^2}{c a_n+d},
	\end{equation*}
	进而有\begin{equation*}
		\frac{1}{a_{n+1}-\alpha}=\frac{1}{a_n-\alpha}+\frac{1}{\alpha+\frac{d}{c}}.
	\end{equation*}
	记\(b_n = \frac{1}{a_n-\alpha}\)，
	则\(b_{n+1} = b_n + \frac{1}{\alpha+\frac{d}{c}}\).
\end{enumerate}
