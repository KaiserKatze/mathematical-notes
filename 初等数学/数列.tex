\chapter{数列}
\section{数列的概念}
\begin{definition}\label{definition.数列.数列的定义}
一般地，如果\(D \subseteq \mathbb{Z}\)，%
那么称映射\[
    f\colon D\to\mathbb{R}, n \mapsto a_n
\]为一个\DefineConcept{数列}（sequence，progression），
记作\(\{a_n\}\)，即\(\{a_n\} \defeq f\).

数列中的每一个数（例如\(\AutoTuple{a}{0}\)）叫做数列的\DefineConcept{项}（term）.
表示第\(n\)个数的公式叫做数列的\DefineConcept{一般项}.
\end{definition}

应该指出，如果我们说“数列\(\{x_n\}\)在数集\(X\)内”或\(\{x_n\} \subseteq X\)，
我们指的是：把数列\(\{x_n\}\)看作一个映射\(f\)时，
这个映射的值域是\(X\)的子集，即\(\ran f \subseteq X\).

\begin{definition}
如果数列\(\{x_n\}\)满足条件\[
x_n \leqslant x_{n+1}, \quad n=1,2,\dotsc,
\]就称“数列\(\{x_n\}\)是\DefineConcept{单调增加的}”；
如果数列\(\{x_n\}\)满足条件\[
x_n \geqslant x_{n+1}, \quad n=1,2,\dotsc,
\]就称“数列\(\{x_n\}\)是\DefineConcept{单调减少的}”.

单调增加数列和单调减少数列统称为\DefineConcept{单调数列}.
\end{definition}

\section{数列的连加与连乘}
\subsection{数列的连加}
\begin{definition}[连加]
定义\DefineConcept{连续求和}：\[
\sum\limits_{i=m}^n a_i
\defeq
a_m + a_{m+1} + \dotsb + a_{n-1} + a_n
\quad(m \leqslant n),
\]其中符号\(\sum\)称作\DefineConcept{连加号}，%
整数\(i\)称为\DefineConcept{求和指标}（index of summation）.
\end{definition}

有时候也把\(\sum\limits_{i=m}^n\)%
写作\(\sum\limits_{m \leqslant i \leqslant n}\).

使用双重连加号求和时，如果两个求和指标独立取值，则连加号\(\sum\)的顺序可以交换.

在不引起误解的情况下，可以省略不写求和指标，
例如用\(\sum a_n\)表示\(\sum\limits_{k=1}^n a_k\).

\subsection{数列的连乘}
\begin{definition}[连乘]
定义\DefineConcept{连续求积}：\[
\prod\limits_{i=m}^n a_i
\defeq
a_m \times a_{m+1} \times \dotsb \times a_{n-1} \times a_n
\quad(m \leqslant n),
\]其中符号\(\prod\)称作\DefineConcept{连乘号}，整数\(i\)称为\DefineConcept{求积指标}.
\end{definition}

同样地，有时候也把\(\prod\limits_{i=m}^n\)%
写作\(\prod\limits_{m \leqslant i \leqslant n}\).

\begin{definition}\label{definition:数列.阶乘的定义}
给定一个正整数\(n\)，%
称所有小于或等于\(n\)的正整数的积为“\(n\)的\DefineConcept{阶乘}（factorial）”，%
记作\(n!\)，即
\begin{equation}
n!
\defeq
\prod\limits_{k=1}^n k
=
n \times (n-1) \times (n-2) \times \dotsm \times 2 \times 1.
\end{equation}
特别地，规定\(0! = 1\).
\end{definition}

\begin{definition}
给定一个正整数\(n\)，%
称小于或等于\(n\)且与之同奇偶的所有正整数的积为“\(n\)的\DefineConcept{双阶乘}”，%
记作\(n!!\)，即
\begin{equation}
n!!
\defeq
\begin{cases}
n \times (n-2) \times (n-4) \times \dotsm \times 3 \times 1, & n\text{是奇数}, \\
n \times (n-2) \times (n-4) \times \dotsm \times 4 \times 2, & n\text{是偶数}.
\end{cases}
\end{equation}
特别地，规定\(0!! = 1\).
\end{definition}

需要注意的是，通常来说双阶乘\(n!!\)并不等于“阶乘的阶乘”\((n!)!\)，%
实际上，\(3!! = 3\)而\((3!)! = 6! = 720\).

称\(\sum\limits_{k=1}^n a_k\)为数列\(\{a_n\}\)的\DefineConcept{前\(n\)项和}.

\section{等差数列}
一般地，如果一个数列从第2项起，每一项与它的前一项的差等于同一个常数，
这个数列就叫做\DefineConcept{等差数列}（arithmetical progression），
这个常数叫做等差数列的\DefineConcept{公差}（common difference）.

如果数列\(\{a_n\}\)是等差数列，它的公差是\(d\)，那么\begin{align*}
    a_2 &= a_1 + d, \\
    a_3 &= a_2 + d = (a_1 + d) + d = a_1 + 2d, \\
    a_4 &= a_3 + d = (a_1 + 2d) + d = a_1 + d3.
\end{align*}
以此类推，可知等差数列\(\{a_n\}\)的\DefineConcept{通项公式}是\begin{equation}
    a_n = a_1 + (n-1) d.
\end{equation}

将等差数列中任意两项\[
    a_m = a_1 + (m-1) d
    \quad\text{与}\quad
    a_n = a_1 + (n-1) d
\]相减，得到\[
    a_m - a_n = (m-n) d.
\]
由此我们也可得到%
等差数列的\DefineConcept{递推公式}：\begin{equation}
    a_{n+1} - a_n = d.
\end{equation}

\begin{property}[等差数列求和]
设数列\(\{a_n\}\)为等差数列，它的通项公式为\[
    a_n = a_1 + (n-1) d,
\]
那么它的前\(n\)项和为\begin{equation}\label{equation:数列.等差数列的前n项和1}
    S_n = \frac{n(a_1 + a_n)}{2},
\end{equation}
或\begin{equation}\label{equation:数列.等差数列的前n项和2}
    S_n = n a_1 + \frac{n(n-1)}{2} d.
\end{equation}
\begin{proof}
由\[
    S_n = a_1 + (a_1 + d) + \dotsb + [a_1 + (n-2)d] + [a_1 + (n-1)d],
\]\[
    S_n = [a_n - (n-1)d] + [a_n - (n-2)d] + \dotsb + (a_n - d) + a_n,
\]相加得\[
    2 S_n = n(a_1 + a_n),
\]最终可得\[
    S_n = \frac{n(a_1 + a_n)}{2} = n a_1 + \frac{n(n-1)}{2} d.
    \qedhere
\]
\end{proof}
\end{property}

根据\hyperref[equation:数列.等差数列的前n项和1]{等差数列的前\(n\)项和公式}，立即有如下结论：
\begin{equation}
    \sum\limits_{k=1}^n k = \frac{1}{2} n(n+1).
\end{equation}

\section{平方数列}
如果数列\(\{a_n\}\)的通项公式是\[
a_n = n^2,
\]那么称其为\DefineConcept{平方数列}.

由立方差公式可知
\[\begin{aligned}
n^3 - (n-1)^3
&= [n - (n-1)] \cdot [n^2 + n(n-1) + (n-1)^2] \\
&= 2n^2 + (n-1)^2 - n.
\end{aligned}\]于是将\[
\begin{array}{l}
2^3 - 1^3 = 2\times2^2+1^2-2, \\
3^3 - 2^3 = 2\times3^2+2^2-3, \\
\hdotsfor{1} \\
n^3 - (n-1)^3 = 2n^2 + (n-1)^2 - n,
\end{array}
\]相加便得\[\begin{aligned}
n^3 - 1^3
&= 2(2^2+3^2+\dotsb+n^2) + [1^2+2^2+\dotsb+(n-1)^2] - (2+3+\dotsb+n) \\
&= 2\left(\sum\limits_{k=1}^n k^2 - 1\right)
    + \left(\sum\limits_{k=1}^n k^2 - n^2\right)
    - \left(\sum\limits_{k=1}^n k - 1\right) \\
&= 3\sum\limits_{k=1}^n k^2 - 2 - n^2 - \frac{n(n+1)}{2} + 1 \\
&= 3\sum\limits_{k=1}^n k^2 - \frac{3}{2} n^2 - \frac{1}{2} n - 1,
\end{aligned}\]
移项，得\[
3 \sum\limits_{k=1}^n k^2
= n^3 + \frac{3}{2} n^2 + \frac{1}{2} n
= \frac{1}{2} n (n+1) (2n+1).
\]
因此，平方数列的前\(n\)项之和为
\begin{equation}
\sum\limits_{k=1}^n a_n
= \sum\limits_{k=1}^n k^2
= \frac{1}{6} n(n+1)(2n+1).
\end{equation}

\begin{example}
求在正方形底上排成完整棱锥体的小球个数.
\begin{solution}
设底部每边有\(n\)个小球，则最底层小球的个数为\(n^2\)个；
从下往上数，第二层有\((n-1)^2\)个小球，
第三层有\((n-2)^2\)个小球，
以此类推，直至顶层只有一个小球.
因此，棱锥体的小球个数为\[
    S = n^2+(n-1)^2+(n-2)^2+\dotsb+1
    = \frac{n(n+1)(2n+1)}{6}.
\]
\end{solution}
\end{example}

\begin{example}
求在等边三角形底上排成完整棱锥体的小球个数.
\begin{solution}
设底部每边有\(n\)个小球，则最底层小球的个数为\[
    n+(n-1)+(n-2)+\dotsb+1
    = \frac{n(n+1)}{2}
    = \frac{1}{2}(n^2+n).
\]
在上式中以\((n-1),(n-2),\dotsc\)替代\(n\)，
就得到了从下往上数从第二层开始直至最顶层的小球个数.
因此，棱锥体的小球个数为\[
    S = \frac{1}{2} (\sum n^2 + \sum n)
    = \frac{n(n+1)(n+2)}{6}.
\]
\end{solution}
\end{example}

\section{立方数列}
如果数列\(\{a_n\}\)的通项公式是\[
a_n = n^3,
\]那么称其为\DefineConcept{立方数列}.

由平方差公式可知
\[\begin{aligned}
n^4 - (n-1)^4
&= [n^2 - (n-1)^2] [n^2 + (n-1)^2] \\
&= [n - (n-1)] [n + (n-1)] [n^2 + (n-1)^2] \\
&= (2n-1) (2n^2 - 2n + 1) \\
&= 4n^3 - 6n^2 + 4n - 1.
\end{aligned}\]
于是\[
\sum\limits_{k=1}^n [k^4 - (k-1)^4]
= \sum\limits_{k=1}^n (4k^3 - 6k^2 + 4k - 1),
\]即\[\begin{aligned}
n^4
&= 4 \sum\limits_{k=1}^n k^3 - 6 \sum\limits_{k=1}^n k^2 + 4 \sum\limits_{k=1}^n k - n \\
&= 4 \sum\limits_{k=1}^n k^3 - n(n+1)(2n+1) + 2n(n+1) - n,
\end{aligned}\]
移项，得\[
4 \sum\limits_{k=1}^n k^3
= n^4 + n(n+1)(2n+1) - 2n(n+1) + n
= n^4 + 2n^3 + n^2
= n^2(n+1)^2.
\]
因此，立方数列的前\(n\)项之和为
\begin{equation}
\sum\limits_{k=1}^n a_n
= \sum\limits_{k=1}^n k^3
= \left[\frac{n(n+1)}{2}\right]^2.
\end{equation}

\section{等比数列}
\begin{definition}
如果数列\(\{a_n\}\)满足\[
a_n = a_1 q^{n-1} \quad(q\neq1),
\]则称该数列为\DefineConcept{等比数列}或\DefineConcept{几何数列}（geometrical progression），
其中\(q\)称作\DefineConcept{公比}.

等比数列的递推公式为\(\frac{a_n}{a_{n-1}} = q\)（\(n \geqslant 2\)）.
\end{definition}

\begin{property}[等比数列求和]
设数列\(\{a_n\}\)为等比数列\[
a_n = a_1 q^{n-1} \qquad (q \neq 1)
\]则有\[
S_n = \sum\limits_{i=1}^n a_i
= \left\{ \begin{array}{cl}
\frac{a_1 (q^n-1)}{q-1}, & q \neq 1, \\
na, & q = 1.
\end{array} \right.
\]
\begin{proof}
当\(q = 1\)时，显然有\(S_n = na\).
当\(q \neq 1\)时，有\[
q S_n = aq+aq^2+aq^3+\dotsb+aq^n,
\]\[
S_{n+1} = a+aq+aq^2+\dotsb+aq^{n-1}+aq^n,
\]因此\[
S_{n+1} - q S_n = a.
\]又因为\(S_{n+1} - S_n = aq^n\)，所以\[
(q-1) S_n = (S_{n+1} - S_n) - (S_{n+1} - q S_n) = aq^n - a = a(q^n - 1),
\]\[
S_n = \frac{a(q^n - 1)}{q-1}.
\qedhere
\]
\end{proof}
\end{property}

\begin{property}
设数列\(\{a_n\}\)为等差数列，\(b\)为常数，则：
\begin{enumerate}
    \item \(\{b + a_n\}\)为等差数列，它的公差与\(\{a_n\}\)的一样；
    \item \(\{b \cdot a_n\}\)为等差数列，它的公差是\(\{a_n\}\)的\(b\)倍；
    \item \(\{b^{a_n}\}\)为等比数列.
\end{enumerate}
\end{property}

\begin{property}
设数列\(\{a_n\}\)为等比数列，\(b\)为常数，则：
\begin{enumerate}
    \item \(\{b \cdot a_n\}\)为等比数列，它的公比与\(\{a_n\}\)的一样；
    \item \(\{b / a_n\}\)为等比数列，它的公比是\(\{a_n\}\)的公比的倒数；
    \item \(\{\log_b a_n\}\)为等差数列.
\end{enumerate}
\end{property}

\begin{example}
求级数\[
    a,(a+d)r,(a+2d)r^2,(a+3d)r^3,\dotsc
\]的前\(n\)项之和.
\begin{solution}
设所求级数的前\(n\)项之和为\[
    S_n = \sum\limits_{k=0}^{n-1} (a+kd) r^k.
    \eqno(1)
\]
那么\[
    r S_n = \sum\limits_{k=0}^{n-1} (a+kd) r^{k+1}.
    \eqno(2)
\]
将(1)式与(2)式相减，得\begin{align*}
    S_n(1-r) &= a + (dr + dr^2 + \dotsb + dr^{n-1}) - [a+(n-1)d] r^n \\
    &= a + \frac{dr(1-r^{n-1})}{1-r} - [a+(n-1)d] r^n.
\end{align*}
于是\[
    S_n = \frac{a}{1-r} + \frac{dr(1-r^{n-1})}{(1-r)^2} - \frac{[a+(n-1)d] r^n}{1-r}.
\]
\end{solution}
\end{example}

\section{调和数列}
若数列\(\{a_n\}\)每相邻三项满足\[
    \frac{a_{n+1}}{a_{n-1}}
    = \frac{a_{n+1}-a_n}{a_n-a_{n-1}},
\]
则称其为\DefineConcept{调和数列}（harmonical progression）\footnote{%
人们对调和数列有兴趣的主要原因是它在几何学与声学中有其重要性.
调和数列的若干项求和无一般公式可循.
通常来说，涉及调和数列的问题的解法都是将它的各项倒转，再利用对应的等差数列的性质.
}；
称\(a_n\)为“\(a_{n-1}\)和\(a_{n+1}\)的\DefineConcept{调和中项}或\DefineConcept{调和平均数}”.

\begin{property}\label{theorem:数列.调和数列的性质}
调和数列\(\{a_n\}\)各项的倒数组成的数列\(\{1/a_n\}\)是等差数列.
\begin{proof}
根据调和数列的定义可知，\[
    \frac{a_{n+1}}{a_{n-1}}
    = \frac{a_{n+1}-a_n}{a_n-a_{n-1}},
\]整理得\[
    a_{n+1} (a_n - a_{n-1})
    = a_{n-1} (a_{n+1} - a_n),
\]再同除以\((a_{n+1} \cdot a_n \cdot a_{n-1})\)，得\[
    \frac{1}{a_{n-1}} - \frac{1}{a_n}
    = \frac{1}{a_n} - \frac{1}{a_{n+1}}.
    \qedhere
\]
\end{proof}
\end{property}

\begin{example}
求\(a\)与\(b\)的调和平均数.
\begin{solution}
设\(a\)与\(b\)的调和平均数为\(h\).
由\cref{theorem:数列.调和数列的性质} 有\[
    \frac{1}{h} - \frac{1}{a}
    = \frac{1}{b} - \frac{1}{h},
\]\[
    \frac{2}{h} = \frac{1}{a} + \frac{1}{b}
    = \frac{a+b}{ab},
\]\[
    h = \frac{2ab}{a+b}.
\]
\end{solution}
\end{example}

我们知道，两个数\(x\)与\(y\)的算术平均数、几何平均数、调和平均数分别为\[
    A = \frac{x+y}{2}, \qquad
    G = \sqrt{xy}, \qquad
    H = \frac{2xy}{x+y}.
\]
由于\[
    A \cdot H = \frac{x+y}{2} \cdot \frac{2xy}{x+y}
    = ab = G^2,
\]
所以\(G\)又是\(A\)与\(H\)的几何平均数.
我们还注意到，当\(x,y>0\)且\(x \neq y\)时，\[
    A - G = \frac{x+y}{2} - \sqrt{xy}
    = \frac{x+y-2\sqrt{xy}}{2}
    = \left(\frac{\sqrt{x}-\sqrt{y}}{\sqrt{2}}\right)^2
    > 0,
\]
因此我们可以说：
两个正数的算术平均数总大于它们的几何平均数，即\(A > G\).
再考虑到\(G^2 = A H\)，\(G\)是介于\(A\)与\(H\)之间的，于是必有\(G > H\).
综上所述，两个正数的算术平均数、几何平均数、调和平均数的大小依次递减，即\(A > G > H\).

\section{斐波那契数列}
如果数列\(\{a_n\}\)满足\(a_1=a_2=1\)，且\[
a_n = a_{n-1} + a_{n-2} \quad(n\geqslant3),
\]则称该数列为\DefineConcept{斐波那契数列}.

\section{已知递推公式求解通项公式的方法}
\subsection{\texorpdfstring{形如\(a_{n+2}=p a_{n+1} + q a_n\ (q\neq0)\)的递推公式}{第一类递推公式}}
对于形如\(a_{n+2}=p a_{n+1} + q a_n\ (q\neq0)\)的递推公式，我们可以令\[
\mat{X}_n = \begin{bmatrix}
a_{n+1} \\
a_n
\end{bmatrix},
\qquad
\mat{A} = \begin{bmatrix}
p & q \\
1 & 0
\end{bmatrix},
\]则\(\mat{X}_{n+1} = \mat{A} \mat{X}_n\)，从而\(\mat{X}_n = \mat{A}^{n-1} \mat{X}_1\).
这样就可以求出通项公式.

现在我们来求\(\mat{A}\)的幂.
此时\(\mat{A}\)的特征多项式为\[
f(x) = \begin{vmatrix}
x-p & -q \\
-1 & x
\end{vmatrix} = x^2 - px - q,
\]我们也称这个多项式为递推公式的特征方程.

假设我们求得该方程的两个复根为\(\alpha,\beta\)，则由韦达定理可知\(p=\alpha+\beta, q=-\alpha\beta\).
注意到\[
\left\{ \begin{array}{l}
a_{n+2} - \alpha a_{n+1} = \beta(a_{n+1}-\alpha a_n), \\
a_{n+2} - \beta a_{n+1} = \alpha(a_{n+1}-\beta a_n)
\end{array} \right.,
\]从而\[
\left\{ \begin{array}{l}
a_{n+1} - \alpha a_n = \beta^{n-1} (a_2 - \alpha a_1), \\
a_{n+1} - \beta a_n = \alpha^{n-1} (a_2 - \beta a_1)
\end{array} \right.,
\]

若\(\alpha\neq\beta\)，解关于\(a_{n+1},a_n\)的线性方程组可得\[
a_n = \frac{\beta^{n-1} (a_2 - \alpha a_1) - a^{n-1} (a_2 - \beta a_1)}{\beta-\alpha};
\]
若\(\alpha=\beta\)，则\(\alpha=\beta\neq0\)，从而\(a_{n+1} = \alpha a_n = \alpha^{n-1} (a_2 - \alpha a_1)\)，进而\[
\frac{a_{n+1}}{\alpha^{n+1}} - \frac{a_n}{\alpha^n} = \frac{1}{\alpha^2}(a_2-\alpha a_1),
\]最后得到\[
a_n = (2-n)\alpha^{n-1} a_1 + (n-1) \alpha^{n-2} a_2.
\]

利用上述结论可以求出斐波那契数列的通项公式为\[
a_n = \frac{1}{\sqrt{5}} \left[
\left(\frac{1+\sqrt{5}}{2}\right)^n
-\left(\frac{1-\sqrt{5}}{2}\right)^n
\right].
\]

\subsection{\texorpdfstring{形如\(a_{n+1} = \frac{a a_n + b}{c a_n + d}\ (ad-bc\neq0)\)的递推公式}{第二类递推公式}}
对于形如\(a_{n+1} = \frac{a a_n + b}{c a_n + d}\ (ad-bc\neq0)\)的递推公式\footnote{这里\(ad-bc\neq0\)确保分式不可能恒为常数（即分式不能约分）.}，首先考虑特征方程\[
x = \frac{ax+b}{cx+d},
\]整理得\[
cx^2+(d-a)x-b=0,
\]解得\[
\alpha=\frac{(a-d)-\sqrt{(d-a)^2+4bc}}{2c}, \qquad
\beta=\frac{(a-d)+\sqrt{(d-a)^2+4bc}}{2c}.
\]由韦达定理，有\[
\alpha+\beta=\frac{a-d}{c}, \qquad
\alpha\beta=-\frac{b}{c};
\]因此\[
a_{n+1} = \frac{\left(\alpha+\beta+\frac{d}{c}\right) a_n - \alpha\beta}{a_n + \frac{d}{c}}.
\]

接下来分成两种情况讨论：\begin{enumerate}
\item 若\(\alpha\neq\beta\)，则\[
\frac{a_{n+1}-\alpha}{a_{n+1}-\beta}
= \frac{\left(\alpha+\beta+\frac{d}{c}\right) a_n - \alpha\beta - \alpha \left(a_n + \frac{d}{c}\right)}{\left(\alpha+\beta+\frac{d}{c}\right) a_n - \alpha\beta - \beta \left(a_n + \frac{d}{c}\right)}
= \frac{c\beta+d}{c\alpha+d} \frac{a_n-\alpha}{a_n-\beta}.
\]记\(b_n = \frac{a_n-\alpha}{a_n-\beta}\)，则\(b_{n+1} = \frac{c\beta+d}{c\alpha+d} b_n\).

\item 若\(\alpha=\beta=\frac{a-d}{2c}\)，则\[
a_{n+1} = \frac{\left(2\alpha+\frac{d}{c}\right) a_n - \alpha^2}{a_n + \frac{d}{c}}
= \frac{(2c\alpha+d)a_n-c\alpha^2}{c a_n+d},
\]进而有\[
\frac{1}{a_{n+1}-\alpha}=\frac{1}{a_n-\alpha}+\frac{1}{\alpha+\frac{d}{c}}.
\]记\(b_n = \frac{1}{a_n-\alpha}\)，则\(b_{n+1} = b_n + \frac{1}{\alpha+\frac{d}{c}}\).
\end{enumerate}
